<!DOCTYPE html><html><head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
        <meta name="description">
        <meta name="keywords" content="static content generator,static site generator,static site,HTML,web development,.NET,C#,Razor,Markdown,YAML">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="/animancer/v4-0/assets/img/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/animancer/v4-0/assets/img/favicon.ico" type="image/x-icon">
        <title>Animancer - 04 Directional Blending</title>
        <link href="/animancer/v4-0/assets/css/highlight.css" rel="stylesheet">
        <link href="/animancer/v4-0/assets/css/bootstrap/bootstrap.css" rel="stylesheet">
        <link href="/animancer/v4-0/assets/css/adminlte/AdminLTE.css" rel="stylesheet">
        <link href="/animancer/v4-0/assets/css/theme/theme.css" rel="stylesheet">
        <link href="//fonts.googleapis.com/css?family=Roboto+Mono:400,700|Roboto:400,400i,700,700i" rel="stylesheet">
        <link href="/animancer/v4-0/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href="/animancer/v4-0/assets/css/override.css" rel="stylesheet">
        <script src="/animancer/v4-0/assets/js/jquery-2.2.3.min.js"></script>
        <script src="/animancer/v4-0/assets/js/bootstrap.min.js"></script>        
        <script src="/animancer/v4-0/assets/js/app.min.js"></script>         
        <script src="/animancer/v4-0/assets/js/highlight.pack.js"></script>   
        <script src="/animancer/v4-0/assets/js/jquery.slimscroll.min.js"></script>
        <script src="/animancer/v4-0/assets/js/jquery.sticky-kit.min.js"></script>
        <script src="/animancer/v4-0/assets/js/mermaid.min.js"></script>
        <script src="/animancer/v4-0/assets/js/svg-pan-zoom.min.js"></script>
        <!--[if lt IE 9]>
        <script src="/animancer/v4-0/assets/js/html5shiv.min.js"></script>
        <script src="/animancer/v4-0/assets/js/respond.min.js"></script>
        <![endif]-->  

        
    </head>
    <body class="hold-transition wyam layout-boxed  ">    
        <div class="top-banner"></div>
        <div class="wrapper with-container">
            <!-- Header -->
            <header class="main-header">   
                     
                <a href="/animancer/v4-0/" class="logo">
                            <span>Animancer</span>
                </a>   
                         
                <nav class="navbar navbar-static-top" role="navigation">
                    <!-- Sidebar toggle button-->
                        <a href="#" class="sidebar-toggle visible-xs-block" data-toggle="offcanvas" role="button">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-right"></i>
                        </a>
                                        
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-down"></i>
                        </button>
                    </div>
            
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                        <ul class="nav navbar-nav">                            
                                    <li class="active"><a href="/animancer/v4-0/docs"><img src="/animancer/v4-0/images/docs.png" height="20" style="position:relative; left:-5px; top:-1px;"> Docs</a></li>
        <li><a href="/animancer/v4-0/docs/help"><img src="/animancer/v4-0/images/help.png" height="20" style="position:relative; left:-4px; top:-1px;"> Help</a></li>
        <li><a href="/animancer/v4-0/api/Animancer/AnimancerComponent"><img src="/animancer/v4-0/images/api.png" height="20" style="position:relative; left:-3px; top:-1px;"> API v4.0</a></li>
        <li><a href="/animancer/lite"><img src="/animancer/v4-0/images/unity-logo.png" height="20" style="position:relative; left:-4px; top:-1px;"> Try</a></li>
        <li><a href="/animancer/pro"><img src="/animancer/v4-0/images/unity-logo.png" height="20" style="position:relative; left:-4px; top:-1px;"> Buy</a></li>
        <li><a href="https://kybernetikgames.github.io/kailas-dierk/unity-assets"><img src="/animancer/v4-0/images/kybernetik.png" height="20" style="position:relative; left:-2px; top:-1px;"> Other Assets</a></li>
 
                        </ul>       
                    </div>
                    <!-- /.navbar-collapse -->
                
                    <!-- Navbar Right Menu -->
                </nav>
<a href="/animancer" style="font-size:1.42em; color:white">This is the <strong>Animancer v4.0 Beta</strong> Documentation. Click Here to return to the v3.1 Documentation.</a>
            </header>
            
            <!-- Left side column. contains the logo and sidebar -->
            <aside class="main-sidebar ">
                <section class="infobar" data-spy="affix" data-offset-top="60" data-offset-bottom="200"> 
                    	
    <div id="infobar-headings"><h6>On This Page</h6><p><a href="#fields">Fields</a></p>
<p><a href="#abstractions">Abstractions</a></p>
<p><a href="#initialisation">Initialisation</a></p>
<p><a href="#input">Input</a></p>
<p><a href="#update">Update</a></p>
<p><a href="#fixed-update">Fixed Update</a></p>
<hr class="infobar-hidden">
</div>

                </section>
                <section class="sidebar">    
                                     
                    

                    <ul class="sidebar-menu">
                        

                <li><a href="/animancer/v4-0/docs/help">Help and FAQ</a></li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/introduction">Introduction</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer">Mecanim vs. Animancer</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer/why-replace-mecanim">Why Replace Mecanim?</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer/playing">Playing</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer/waiting">Waiting</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer/speed-and-time">Speed and Time</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer/weapon-animations">Weapon Animations</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer/performance">Performance</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/v4-0/docs/introduction/features">Features</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/glossary">Glossary</a></li>

                    </ul>
                </li>
                <li class="treeview active">
                    <a href="/animancer/v4-0/docs/examples">Examples</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/basics">01 Basics</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/basics/basic-scene-setup">Basic Scene Setup</a></li>
                <li><a href="/animancer/v4-0/docs/examples/basics/quick-play">01 Quick Play</a></li>
                <li><a href="/animancer/v4-0/docs/examples/basics/playing-and-fading">02 Playing and Fading</a></li>
                <li><a href="/animancer/v4-0/docs/examples/basics/sequence-coroutine">03 Sequence Coroutine</a></li>
                <li><a href="/animancer/v4-0/docs/examples/basics/named-animations">04 Named Animations</a></li>
                <li><a href="/animancer/v4-0/docs/examples/basics/hybrid">05 Hybrid Basics</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/fine-control">02 Fine Control</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/fine-control/spider-bot">01 Spider Bot</a></li>
                <li><a href="/animancer/v4-0/docs/examples/fine-control/doors">02 Doors</a></li>
                <li><a href="/animancer/v4-0/docs/examples/fine-control/solo-animation">03 Solo Animation</a></li>

                    </ul>
                </li>
                <li class="treeview active">
                    <a href="/animancer/v4-0/docs/examples/locomotion">03 Locomotion</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/locomotion/walk-and-run">01 Walk and Run</a></li>
                <li><a href="/animancer/v4-0/docs/examples/locomotion/root-motion">02 Root Motion</a></li>
                <li><a href="/animancer/v4-0/docs/examples/locomotion/linear-blending">03 Linear Blending</a></li>
                <li class="selected"><a href="/animancer/v4-0/docs/examples/locomotion/directional-blending">04 Directional Blending</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/directional-sprites">04 Directional Sprites</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/directional-sprites/basic-movement">01 Basic Movement</a></li>
                <li><a href="/animancer/v4-0/docs/examples/directional-sprites/character-controller">02 Character Controller</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/animation-events">05 Animation Events</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/animation-events/simple-and-end-events">01 Simple and End Events</a></li>
                <li><a href="/animancer/v4-0/docs/examples/animation-events/other-events">02 Other Events</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/state-machines">06 State Machines</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/state-machines/creatures">01 Creatures</a></li>
                <li><a href="/animancer/v4-0/docs/examples/state-machines/interrupt-management">02 Interrupt Management</a></li>
                <li><a href="/animancer/v4-0/docs/examples/state-machines/brains">03 Brains</a></li>
                <li><a href="/animancer/v4-0/docs/examples/state-machines/more-brains">04 More Brains</a></li>
                <li><a href="/animancer/v4-0/docs/examples/state-machines/platformer">05 Platformer</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/v4-0/docs/examples/layers">07 Layers</a></li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/inverse-kinematics">08 Inverse Kinematics</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/inverse-kinematics/puppet">01 Puppet</a></li>
                <li><a href="/animancer/v4-0/docs/examples/inverse-kinematics/uneven-ground">02 Uneven Ground</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/animator-controllers">09 Animator Controllers</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/hybrid">01 Hybrid</a></li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit">02 3D Game Kit</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/problems">Problems with the Original</a></li>
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/respawn">Respawn</a></li>
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/idle">Idle</a></li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/locomotion">Locomotion</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/locomotion/movement">Movement</a></li>
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/locomotion/turning">Turning</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/airborne">Airborne</a></li>
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/landing">Landing</a></li>
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/attack">Attack</a></li>

                    </ul>
                </li>

                    </ul>
                </li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/manual">User Manual</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/manual/playing">Playing Animations</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/manual/playing/states">States</a></li>
                <li><a href="/animancer/v4-0/docs/manual/playing/inspector">Inspector</a></li>
                <li><a href="/animancer/v4-0/docs/manual/playing/component-types">Component Types</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/manual/transitions">Transitions</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/manual/transitions/types">Transition Types</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/manual/blending">Blending</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/manual/blending/fading">Fading</a></li>
                <li><a href="/animancer/v4-0/docs/manual/blending/layers">Layers</a></li>
                <li><a href="/animancer/v4-0/docs/manual/blending/mixers">Mixers</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/manual/events">Events</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/manual/events/animation">Animation Events</a></li>
                <li><a href="/animancer/v4-0/docs/manual/events/animancer">Animancer Events</a></li>
                <li><a href="/animancer/v4-0/docs/manual/events/end">End Events</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/v4-0/docs/manual/finite-state-machines">Finite State Machines</a></li>
                <li><a href="/animancer/v4-0/docs/manual/animator-controllers">Animator Controllers</a></li>
                <li><a href="/animancer/v4-0/docs/manual/inverse-kinematics">Inverse Kinematics</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/bugs">Unity Bugs</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/bugs/inconsistent-timing">Inconsistent Timing</a></li>
                <li><a href="/animancer/v4-0/docs/bugs/paused-skinned-mesh-update">Paused Skinned Mesh Update</a></li>
                <li><a href="/animancer/v4-0/docs/bugs/resetting-animated-values">Resetting Animated Values</a></li>
                <li><a href="/animancer/v4-0/docs/bugs/root-motion-interpolation">Root Motion Interpolation</a></li>
                <li><a href="/animancer/v4-0/docs/bugs/unused-graph-destroy-warning">Unused Graph Destroy Warning</a></li>
                <li><a href="/animancer/v4-0/docs/bugs/update-modes">Update Modes</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/source">Source Code</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/source/dlls">DLLs</a></li>
                <li><a href="/animancer/v4-0/docs/source/creating-custom-states">Creating Custom States</a></li>
                <li><a href="/animancer/v4-0/docs/source/graph-structure">Graph Structure</a></li>
                <li><a href="/animancer/v4-0/docs/source/asset-sources">Asset Sources</a></li>
                <li><a href="/animancer/v4-0/docs/source/coding-standard">Coding Standard</a></li>
                <li><a href="/animancer/v4-0/docs/source/default-script-template">Default Script Template</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/changes">Change Log</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/changes/animancer-v4-0-beta">Beta Test v4.0</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v4-0">Progress of v4.0</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v3-1">Animancer v3.1</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v3-0">Animancer v3.0</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v2-0">Animancer v2.0</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v1-3">Animancer v1.3</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v1-2">Animancer v1.2</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v1-1">Animancer v1.1</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v1-0">Animancer v1.0</a></li>

                    </ul>
                </li>

                    </ul>
                            
                </section>                
            </aside>
            
            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                



		<section class="content-header">
			<h1>04 Directional Blending</h1>
		</section>
	<section class="content">
		<blockquote class="blockquote">
<p><strong>Difficulty</strong>: <a href="../../../introduction/glossary#example-difficulty">Intermediate</a></p>
<p><strong>Location</strong>: <em>Assets/Plugins/Animancer/Examples/03 Locomotion/04 Directional Blending</em></p>
<p><strong>Namespace</strong>: <a href="../../../../api/Animancer.Examples.Locomotion"><code>Animancer.Examples.Locomotion</code></a></p>
</blockquote>
<p>This example expands upon the <a href="../../fine-control/spider-bot">Spider Bot</a> example with a 2D <a href="../../../manual/blending/mixers">Mixer</a> to allow movement in any direction and a <code>Rigidbody</code> so that the bot can follow the mouse cursor around.</p>
<p><em><a href="../../../introduction/features"><strong>Pro-Only Features</strong></a> are used in this example: <a href="../../../manual/blending/mixers">Mixers</a>. Animancer Lite allows you to try out these features in the Unity Editor, but they are not available in runtime builds unless you purchase <a href="/animancer/pro">Animancer Pro</a>.</em></p>
<p><img src="spider-bot.gif" class="img-responsive"></p>
<p></p><details><summary>This example is implemented by the <code><a href="/animancer/v4-0/api/Animancer.Examples.Locomotion/SpiderBotAdvanced">SpiderBotAdvanced</a></code> script which looks like this (with the comments removed since we are about to explain how it works):</summary><p>
</p><pre><code class="language-cs">using Animancer;
using UnityEngine;

public sealed class <a href="/animancer/v4-0/api/Animancer.Examples.Locomotion/SpiderBotAdvanced">SpiderBotAdvanced</a> : <a href="/animancer/v4-0/api/Animancer.Examples.FineControl/SpiderBot">SpiderBot</a>
{
    [SerializeField] private Rigidbody _Body;
    [SerializeField] private float _TurnSpeed = 60;
    [SerializeField] private float _MovementSpeed = 1.5f;
    [SerializeField] private float _SprintMultiplier = 2;

    [SerializeField]
    private <a href="/animancer/v4-0/api/Animancer/Transition2D">MixerState.Transition2D</a> _Move;

    protected override <a href="/animancer/v4-0/api/Animancer/IAnimancerTransition">IAnimancerTransition</a> MovementAnimation
    {
        get { return _Move; }
    }

    private Vector3 _MovementDirection;

    protected override bool IsMoving
    {
        get { return _MovementDirection != Vector3.zero; }
    }

    protected override void Awake()
    {
        base.Awake();
        Animancer.States.GetOrCreate(_Move);
    }

    protected override void Update()
    {
        _MovementDirection = GetMovementDirection();
        base.Update();

        if (_Move.State.IsActive)
        {
            var eulerAngles = transform.eulerAngles;
            var targetEulerY = Camera.main.transform.eulerAngles.y;
            eulerAngles.y = Mathf.MoveTowardsAngle(eulerAngles.y, targetEulerY, _TurnSpeed * Time.deltaTime);
            transform.eulerAngles = eulerAngles;

            _Move.State.Parameter = new Vector2(
                Vector3.Dot(transform.right, _MovementDirection),
                Vector3.Dot(transform.forward, _MovementDirection));

            var isSprinting = Input.GetMouseButton(0);
            _Move.State.Speed = isSprinting ? _SprintMultiplier : 1;
        }
        else
        {
            _Move.State.Parameter = Vector2.zero;
            _Move.State.Speed = 0;
        }
    }

    private Vector3 GetMovementDirection()
    {
        var ray = Camera.main.ScreenPointToRay(Input.mousePosition);

        RaycastHit raycastHit;
        if (!Physics.Raycast(ray, out raycastHit))
            return Vector3.zero;

        var direction = raycastHit.point - transform.position;
        direction.y = 0;

        var distance = direction.magnitude;
        if (distance &lt; _MovementSpeed * Time.fixedDeltaTime)
        {
            return Vector3.zero;
        }
        else
        {
            return direction / distance;
        }
    }

    private void FixedUpdate()
    {
        _Body.velocity = _MovementDirection * _Move.State.Speed * _MovementSpeed;
    }
}
</code></pre>
<p></p></details><p></p>
<h1 id="fields">Fields</h1>
<table class="table">
  <thead>
    <tr><th style="width:50%">Code</th>
    <th style="width:50%">Inspector</th>
  </tr></thead>
  <tbody>
    <tr>
      <td>
<pre><code class="language-cs">class <a href="/animancer/v4-0/api/Animancer.Examples.Locomotion/SpiderBotAdvanced">SpiderBotAdvanced</a> : <a href="/animancer/v4-0/api/Animancer.Examples.FineControl/SpiderBot">SpiderBot</a>
{
    [SerializeField]
    private Rigidbody _Body;

    [SerializeField]
    private float _TurnSpeed = 60;

    [SerializeField]
    private float _MovementSpeed = 1.5f;

    [SerializeField]
    private float _SprintMultiplier = 2;

    [SerializeField]
    private <a href="/animancer/v4-0/api/Animancer/Transition2D">MixerState.Transition2D</a> _Move;
}
</code></pre>
<p>Inheriting from <code><a href="/animancer/v4-0/api/Animancer.Examples.FineControl/SpiderBot">SpiderBot</a></code> gives us the same base fields as in the <a href="../../fine-control/spider-bot">Spider Bot</a> example and allows us to add more. Notably, instead of a <code><a href="/animancer/v4-0/api/Animancer/Transition">ClipState.Transition</a></code> like <code><a href="/animancer/v4-0/api/Animancer.Examples.FineControl/SpiderBotSimple">SpiderBotSimple</a></code> used to play a single <code>AnimationClip</code>, this time we are using a <code><a href="/animancer/v4-0/api/Animancer/Transition2D">MixerState.Transition2D</a></code> to allow blending between multiple animations on two axes (forward/back and left/right). See <a href="../../../manual/blending/mixers#choosing-a-mixer">Mixers</a> for more information about their different types.</p>
</td>
      <td><img src="inspector.png" class="img-responsive"></td>
    </tr>
  </tbody>
</table>
<h1 id="abstractions">Abstractions</h1>
<p>This time we <code>override</code> the <code>MovementAnimation</code> to return the <code><a href="/animancer/v4-0/api/Animancer/Transition2D">MixerState.Transition2D</a></code> and we have a <code>private Vector3 _MovementDirection</code> which will be set in the <code>Update</code> method so that <code>IsMoving</code> can determine if it currently wants to move:</p>
<pre><code class="language-cs">[SerializeField]
private <a href="/animancer/v4-0/api/Animancer/Transition2D">MixerState.Transition2D</a> _Move;

protected override <a href="/animancer/v4-0/api/Animancer/IAnimancerTransition">IAnimancerTransition</a> MovementAnimation
{
    get { return _Move; }
}

private Vector3 _MovementDirection;

protected override bool IsMoving
{
    get { return _MovementDirection != Vector3.zero; }
}
</code></pre>
<h1 id="initialisation">Initialisation</h1>
<p>The <code>Update</code> and <code>FixedUpdate</code> methods are going to be accessing the <code>_Move.State</code>, so we need to ensure that the state is created on startup even though it is not used yet:</p>
<pre><code class="language-cs">protected override void Awake()
{
    base.Awake();
    Animancer.States.GetOrCreate(_Move);
}
</code></pre>
<p>Note that the base <code>SpiderBot.Awake</code> method is <code>virtual</code> and has its own implementation which we still want to use, so we call <code>base.Awake()</code> in our <code>override</code>.</p>
<h1 id="input">Input</h1>
<p>Rather than using keyboard input to control the bot, we are having it follow the mouse cursor to demonstrate movement in any direction.</p>
<ol>
<li>Get a ray from the main camera in the direction of the mouse cursor:</li>
</ol>
<pre><code class="language-cs">private Vector3 GetMovementDirection()
{
    var ray = Camera.main.ScreenPointToRay(Input.mousePosition);
</code></pre>
<ol start="2">
<li>Do a raycast with it and stop trying to move if the ray does not hit anything. Note that the bot is set to the Ignore Raycast layer so that the raycast will not hit it:</li>
</ol>
<pre><code class="language-cs">    RaycastHit raycastHit;
    if (!Physics.Raycast(ray, out raycastHit))
        return Vector3.zero;
</code></pre>
<ol start="3">
<li>If the ray did hit something, calculate the horizontal direction from the bot to that point:</li>
</ol>
<pre><code class="language-cs">    var direction = raycastHit.point - transform.position;
    direction.y = 0;
</code></pre>
<ol start="4">
<li>If it is already close to the destination, stop moving. Note that <code>Time.deltaTime</code> is the same as <code>Time.fixedDeltaTime</code> during a <code>FixedUpdate</code>, but since this method is called by <code>Update</code> we want to make sure that it compares against the distance it would move during the next physics update rather than during this rendered frame:</li>
</ol>
<pre><code class="language-cs">    var distance = direction.magnitude;
    if (distance &lt; _MovementSpeed * Time.fixedDeltaTime)
    {
        return Vector3.zero;
    }
</code></pre>
<ol start="5">
<li>Otherwise normalize the direction so that we do not change speed based on distance. Calling <code>direction.Normalize()</code> would do the same thing, but that would need to calculate the magnitude again so this is simply more efficient:</li>
</ol>
<pre><code class="language-cs">    else
    {
        return direction = distance;
    }
}
</code></pre>
<h1 id="update">Update</h1>
<p>Like with <code>Awake</code>, we want to <code>override</code> the base <code>SpiderBot.Update</code> method to add some additional code.</p>
<ol>
<li>Determine the direction we want to move and store it in the <code>_MovementDirection</code> field so that <code>IsMoving</code> can also check it:</li>
</ol>
<pre><code class="language-cs">protected override void Update()
{
    _MovementDirection = GetMovementDirection();
</code></pre>
<ol start="2">
<li>Call the base <code>SpiderBot.Update</code> method to wake up or go to sleep if necessary:</li>
</ol>
<pre><code class="language-cs">    base.Update();
</code></pre>
<ol start="3">
<li>If the movement state is playing and not fading out, then we are allowed to move. This prevents movement while asleep and during the wake up animation:</li>
</ol>
<pre><code class="language-cs">    if (_Move.State.IsActive)
    {
</code></pre>
<ol start="4">
<li>Rotate towards the same Y angle as the camera:</li>
</ol>
<pre><code class="language-cs">        var eulerAngles = transform.eulerAngles;
        var targetEulerY = Camera.main.transform.eulerAngles.y;
        eulerAngles.y = Mathf.MoveTowardsAngle(eulerAngles.y, targetEulerY, _TurnSpeed * Time.deltaTime);
        transform.eulerAngles = eulerAngles;
</code></pre>
<ol start="5">
<li>The movement direction is in world space, so we need to convert it to local space to be appropriate for the current rotation by using dot-products to determine how much of that direction lies along each axis (this would be unnecessary if we did not rotate at all):</li>
</ol>
<pre><code class="language-cs">        _Move.State.Parameter = new Vector2(
            Vector3.Dot(transform.right, _MovementDirection),
            Vector3.Dot(transform.forward, _MovementDirection));
</code></pre>
<ol start="6">
<li>Set its speed depending on whether you are sprinting or not:</li>
</ol>
<pre><code class="language-cs">        var isSprinting = Input.GetMouseButton(0);
        _Move.State.Speed = isSprinting ? _SprintMultiplier : 1;
    }
</code></pre>
<ol start="7">
<li>Otherwise if the movement state is not playing or is fading out, stop moving:</li>
</ol>
<pre><code class="language-cs">    else
    {
        _Move.State.Parameter = Vector2.zero;
        _Move.State.Speed = 0;
    }
}
</code></pre>
<h1 id="fixed-update">Fixed Update</h1>
<p>The actual movement implementation in <code>FixedUpdate</code> is simple for the sake of keeping the script short, but manipulating the <code>Rigidbody.velocity</code> directly is not generally recommended. A proper implementation would usually use <code>AddForce</code>:</p>
<pre><code class="language-cs">private void FixedUpdate()
{
    _Body.velocity = _MovementDirection * _Move.State.Speed * _MovementSpeed;
}
</code></pre>
<p>This all combines to give us a bot that can chase the mouse cursor around the scene:</p>
<p><img src="spider-bot.gif" class="img-responsive"></p>

	</section>
                
            </div>           
            
            <!-- Footer -->
            <footer class="main-footer">
            </footer>
            
        </div>
        <div class="wrapper bottom-wrapper">
            <footer class="bottom-footer">
                Generated by <a href="https://wyam.io">Wyam</a>
            </footer>
        </div>
        <a href="javascript:" id="return-to-top"><i class="fa fa-chevron-up"></i></a>
        
        <script>           
            // Close the sidebar if we select an anchor link
            $(".main-sidebar a[href^='#']:not('.expand')").click(function(){
                $(document.body).removeClass('sidebar-open');
            });
            
            $(document).ready(function() {
                mermaid.initialize(
                {
                    flowchart:
                    {
                        useMaxWidth: false
                    },
					startOnLoad: false,
					cloneCssStyles: false
                });     
                mermaid.init(undefined, ".mermaid");

                // Remove the max-width setting that Mermaid sets
                var mermaidSvg = $('.mermaid svg');
                mermaidSvg.addClass('img-responsive');
                mermaidSvg.css('max-width', '');

                // Make it scrollable
				var target = document.querySelector(".mermaid svg");
				if(target !== null)
				{
					var panZoom = window.panZoom = svgPanZoom(target, {
						zoomEnabled: true,
						controlIconsEnabled: true,
						fit: true,
						center: true,
                        maxZoom: 20,
                        zoomScaleSensitivity: 0.6
					});			                          

                    // Do the reset once right away to fit the diagram
                    panZoom.resize();
                    panZoom.fit();
                    panZoom.center();
                    
                    $(window).resize(function(){
                        panZoom.resize();
                        panZoom.fit();
                        panZoom.center();
                    });
				}
                
                $('pre code').each(function(i, block) {
                    hljs.highlightBlock(block);
                });  
            });

            hljs.initHighlightingOnLoad();

            // Back to top
            $(window).scroll(function() {
                if ($(this).scrollTop() >= 200) {        // If page is scrolled more than 50px
                    $('#return-to-top').fadeIn(1000);    // Fade in the arrow
                } else {
                    $('#return-to-top').fadeOut(1000);   // Else fade out the arrow
                }
            });
            $('#return-to-top').click(function() {      // When arrow is clicked
                $('body,html').animate({
                    scrollTop : 0                       // Scroll to top of body
                }, 500);
            });
        </script>
    
</body></html>