<!DOCTYPE html><html><head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
        <meta name="description">
        <meta name="keywords" content="static content generator,static site generator,static site,HTML,web development,.NET,C#,Razor,Markdown,YAML">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="/animancer/v4-0/assets/img/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/animancer/v4-0/assets/img/favicon.ico" type="image/x-icon">
        <title>Animancer - 01 Creatures</title>
        <link href="/animancer/v4-0/assets/css/highlight.css" rel="stylesheet">
        <link href="/animancer/v4-0/assets/css/bootstrap/bootstrap.css" rel="stylesheet">
        <link href="/animancer/v4-0/assets/css/adminlte/AdminLTE.css" rel="stylesheet">
        <link href="/animancer/v4-0/assets/css/theme/theme.css" rel="stylesheet">
        <link href="//fonts.googleapis.com/css?family=Roboto+Mono:400,700|Roboto:400,400i,700,700i" rel="stylesheet">
        <link href="/animancer/v4-0/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href="/animancer/v4-0/assets/css/override.css" rel="stylesheet">
        <script src="/animancer/v4-0/assets/js/jquery-2.2.3.min.js"></script>
        <script src="/animancer/v4-0/assets/js/bootstrap.min.js"></script>        
        <script src="/animancer/v4-0/assets/js/app.min.js"></script>         
        <script src="/animancer/v4-0/assets/js/highlight.pack.js"></script>   
        <script src="/animancer/v4-0/assets/js/jquery.slimscroll.min.js"></script>
        <script src="/animancer/v4-0/assets/js/jquery.sticky-kit.min.js"></script>
        <script src="/animancer/v4-0/assets/js/mermaid.min.js"></script>
        <script src="/animancer/v4-0/assets/js/svg-pan-zoom.min.js"></script>
        <!--[if lt IE 9]>
        <script src="/animancer/v4-0/assets/js/html5shiv.min.js"></script>
        <script src="/animancer/v4-0/assets/js/respond.min.js"></script>
        <![endif]-->  

        
    </head>
    <body class="hold-transition wyam layout-boxed  ">    
        <div class="top-banner"></div>
        <div class="wrapper with-container">
            <!-- Header -->
            <header class="main-header">   
                     
                <a href="/animancer/v4-0/" class="logo">
                            <span>Animancer</span>
                </a>   
                         
                <nav class="navbar navbar-static-top" role="navigation">
                    <!-- Sidebar toggle button-->
                        <a href="#" class="sidebar-toggle visible-xs-block" data-toggle="offcanvas" role="button">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-right"></i>
                        </a>
                                        
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-down"></i>
                        </button>
                    </div>
            
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                        <ul class="nav navbar-nav">                            
                                    <li class="active"><a href="/animancer/v4-0/docs"><img src="/animancer/v4-0/images/docs.png" height="20" style="position:relative; left:-5px; top:-1px;"> Docs</a></li>
        <li><a href="/animancer/v4-0/faq"><img src="/animancer/v4-0/images/faq.png" height="20" style="position:relative; left:-4px; top:-1px;"> FAQ</a></li>
        <li><a href="/animancer/v4-0/api/Animancer/AnimancerComponent"><img src="/animancer/v4-0/images/api.png" height="20" style="position:relative; left:-3px; top:-1px;"> API v4.0</a></li>
        <li><a href="/animancer/forum"><img src="/animancer/v4-0/images/forum.png" height="20" style="position:relative; left:-4px; top:-1px;"> Forum</a></li>
        <li><a href="mailto:AnimancerUnityPlugin@gmail.com?subject=Animancer"><img src="/animancer/v4-0/images/contact.png" height="20" style="position:relative; left:-4px; top:-1px;"> Contact</a></li>
        <li><a href="/animancer/lite"><img src="/animancer/v4-0/images/unity-logo.png" height="20" style="position:relative; left:-4px; top:-1px;"> Try</a></li>
        <li><a href="/animancer/pro"><img src="/animancer/v4-0/images/unity-logo.png" height="20" style="position:relative; left:-4px; top:-1px;"> Buy</a></li>
        <li><a href="https://kybernetikgames.github.io/kailas-dierk/unity-assets"><img src="/animancer/v4-0/images/kybernetik.png" height="20" style="position:relative; left:-2px; top:-1px;"> Other Assets</a></li>
 
                        </ul>       
                    </div>
                    <!-- /.navbar-collapse -->
                
                    <!-- Navbar Right Menu -->
                </nav>
<a href="/animancer" style="font-size:1.42em; color:white">This is the <strong>Animancer v4.0 Beta</strong> Documentation. Click Here to return to the v3.1 Documentation.</a>
            </header>
            
            <!-- Left side column. contains the logo and sidebar -->
            <aside class="main-sidebar ">
                <section class="infobar" data-spy="affix" data-offset-top="60" data-offset-bottom="200"> 
                    	
    <div id="infobar-headings"><h6>On This Page</h6><p><a href="#creatures">Creatures</a></p>
<p><a href="#state-machine">State Machine</a></p>
<p><a href="#actions">Actions</a></p>
<p><a href="#returning-to-idle">Returning to Idle</a></p>
<p><a href="#current-state-display">Current State Display</a></p>
<p><a href="#states">States</a></p>
<p><a href="#walk-and-run">Walk and Run</a></p>
<hr class="infobar-hidden">
</div>

                </section>
                <section class="sidebar">    
                                     
                    

                    <ul class="sidebar-menu">
                        

                <li class="treeview">
                    <a href="/animancer/v4-0/docs/introduction">Introduction</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer">Mecanim vs. Animancer</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer/why-replace-mecanim">Why Replace Mecanim?</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer/playing">Playing</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer/waiting">Waiting</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer/speed-and-time">Speed and Time</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer/weapon-animations">Weapon Animations</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer/performance">Performance</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/v4-0/docs/introduction/features">Features</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/glossary">Glossary</a></li>

                    </ul>
                </li>
                <li class="treeview active">
                    <a href="/animancer/v4-0/docs/examples">Examples</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/basics">01 Basics</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/basics/basic-scene-setup">Basic Scene Setup</a></li>
                <li><a href="/animancer/v4-0/docs/examples/basics/quick-play">01 Quick Play</a></li>
                <li><a href="/animancer/v4-0/docs/examples/basics/playing-and-fading">02 Playing and Fading</a></li>
                <li><a href="/animancer/v4-0/docs/examples/basics/sequence-coroutine">03 Sequence Coroutine</a></li>
                <li><a href="/animancer/v4-0/docs/examples/basics/named-animations">04 Named Animations</a></li>
                <li><a href="/animancer/v4-0/docs/examples/basics/hybrid-system">05 Hybrid System</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/fine-control">02 Fine Control</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/fine-control/spider-bot">01 Spider Bot</a></li>
                <li><a href="/animancer/v4-0/docs/examples/fine-control/doors">02 Doors</a></li>
                <li><a href="/animancer/v4-0/docs/examples/fine-control/solo-animation">03 Solo Animation</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/locomotion">03 Locomotion</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/locomotion/walk-and-run">01 Walk and Run</a></li>
                <li><a href="/animancer/v4-0/docs/examples/locomotion/root-motion">02 Root Motion</a></li>
                <li><a href="/animancer/v4-0/docs/examples/locomotion/linear-blending">03 Linear Blending</a></li>
                <li><a href="/animancer/v4-0/docs/examples/locomotion/directional-blending">04 Directional Blending</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/directional-sprites">04 Directional Sprites</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/directional-sprites/basic-movement">01 Basic Movement</a></li>
                <li><a href="/animancer/v4-0/docs/examples/directional-sprites/character-controller">02 Character Controller</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/animation-events">05 Animation Events</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/animation-events/simple-and-end-events">01 Simple and End Events</a></li>
                <li><a href="/animancer/v4-0/docs/examples/animation-events/other-events">02 Other Events</a></li>

                    </ul>
                </li>
                <li class="treeview active">
                    <a href="/animancer/v4-0/docs/examples/state-machines">06 State Machines</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li class="selected"><a href="/animancer/v4-0/docs/examples/state-machines/creatures">01 Creatures</a></li>
                <li><a href="/animancer/v4-0/docs/examples/state-machines/interrupt-management">02 Interrupt Management</a></li>
                <li><a href="/animancer/v4-0/docs/examples/state-machines/brains">03 Brains</a></li>
                <li><a href="/animancer/v4-0/docs/examples/state-machines/more-brains">04 More Brains</a></li>
                <li><a href="/animancer/v4-0/docs/examples/state-machines/platformer">05 Platformer</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/v4-0/docs/examples/layers">07 Layers</a></li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/inverse-kinematics">08 Inverse Kinematics</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/inverse-kinematics/puppet">01 Puppet</a></li>
                <li><a href="/animancer/v4-0/docs/examples/inverse-kinematics/uneven-ground">02 Uneven Ground</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/animator-controllers">09 Animator Controllers</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/hybrid">01 Hybrid</a></li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit">02 3D Game Kit</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/problems">Problems with the Original</a></li>
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/respawn">Respawn</a></li>
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/idle">Idle</a></li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/locomotion">Locomotion</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/locomotion/movement">Movement</a></li>
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/locomotion/turning">Turning</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/airborne">Airborne</a></li>
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/landing">Landing</a></li>
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/attack">Attack</a></li>

                    </ul>
                </li>

                    </ul>
                </li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/manual">User Manual</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/manual/playing-animations">Playing Animations</a></li>
                <li><a href="/animancer/v4-0/docs/manual/states">States</a></li>
                <li><a href="/animancer/v4-0/docs/manual/waiting-for-animations">Waiting for Animations</a></li>
                <li><a href="/animancer/v4-0/docs/manual/inspector">Inspector</a></li>
                <li><a href="/animancer/v4-0/docs/manual/component-types">Component Types</a></li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/manual/blending">Blending</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/manual/blending/fading">Fading</a></li>
                <li><a href="/animancer/v4-0/docs/manual/blending/layers">Layers</a></li>
                <li><a href="/animancer/v4-0/docs/manual/blending/mixers">Mixers</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/v4-0/docs/manual/finite-state-machines">Finite State Machines</a></li>
                <li><a href="/animancer/v4-0/docs/manual/transitions">Transitions</a></li>
                <li><a href="/animancer/v4-0/docs/manual/animator-controllers">Animator Controllers</a></li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/manual/events">Events</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/manual/events/animation">Animation Events</a></li>
                <li><a href="/animancer/v4-0/docs/manual/events/animancer">Animancer Events</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/v4-0/docs/manual/inverse-kinematics">Inverse Kinematics</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/bugs">Unity Bugs</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/bugs/inconsistent-timing">Inconsistent Timing</a></li>
                <li><a href="/animancer/v4-0/docs/bugs/paused-skinned-mesh-update">Paused Skinned Mesh Update</a></li>
                <li><a href="/animancer/v4-0/docs/bugs/resetting-animated-values">Resetting Animated Values</a></li>
                <li><a href="/animancer/v4-0/docs/bugs/root-motion-interpolation">Root Motion Interpolation</a></li>
                <li><a href="/animancer/v4-0/docs/bugs/unused-graph-destroy-warning">Unused Graph Destroy Warning</a></li>
                <li><a href="/animancer/v4-0/docs/bugs/update-modes">Update Modes</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/source">Source Code</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/source/creating-custom-states">Creating Custom States</a></li>
                <li><a href="/animancer/v4-0/docs/source/graph-structure">Graph Structure</a></li>
                <li><a href="/animancer/v4-0/docs/source/asset-sources">Asset Sources</a></li>
                <li><a href="/animancer/v4-0/docs/source/coding-standard">Coding Standard</a></li>
                <li><a href="/animancer/v4-0/docs/source/default-script-template">Default Script Template</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/changes">Change Log</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/changes/animancer-v4-0-beta">Beta Test v4.0</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v4-0">Progress of v4.0</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v3-1">Animancer v3.1</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v3-0">Animancer v3.0</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v2-0">Animancer v2.0</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v1-3">Animancer v1.3</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v1-2">Animancer v1.2</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v1-1">Animancer v1.1</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v1-0">Animancer v1.0</a></li>

                    </ul>
                </li>

                    </ul>
                            
                </section>                
            </aside>
            
            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                



		<section class="content-header">
			<h1>01 Creatures</h1>
		</section>
	<section class="content">
		<blockquote class="blockquote">
<p><strong>Location</strong>: <em>Assets/Plugins/Animancer/Examples/06 State Machines/01 Creatures</em></p>
<p><strong>Namespace</strong>: <a href="../../../../api/Animancer.Examples.StateMachines.Creatures"><code>Animancer.Examples.StateMachines.Creatures</code></a></p>
</blockquote>
<p>A common mistake made by inexperienced developers is to write classes with names like <code>Player</code> and <code>Enemy</code> which end up having a significant amount of identical code. This is not always the case, but in a lot of games the enemies follow the same general structure and rules as the player: everything has a model (or sprite) that can be animated, they have a health pool, a state machine with the various actions they can perform, and so on. The main difference is the way they are controlled: the player character responds to input from a controller/keyboard/mouse/etc. while an enemy decides what to do using AI algorithms. In a multiplayer game, player characters might act according to messages sent across the network rather than local input. The point is that they all follow the same rules for <em>how</em> they can move, they simply differ in the mechanism used to <em>decide which direction</em> they will move.</p>
<p>This example demonstrates how you can organise the structure of a <code>Creature</code> and use Animancer's <a href="../../../manual/finite-state-machines">Finite State Machine</a> system to divide the various actions it can perform into separate scripts known as states.</p>
<ul>
<li>The <a href="../interrupt-management">Interrupt Management</a> example introduces some simple ways to determine which states are allowed to interrupt each other.</li>
<li>The <a href="../brains">Brains</a> example shows how you can properly control a creature and the <a href="../more-brains">More Brains</a> example expands that idea further to show how creatures can be controlled differently while still sharing the majority of their code.</li>
</ul>
<p><img src="basic-creature.gif" class="img-responsive"></p>
<p>There are two scripts in this example:</p>
<p></p><details><summary><code>Creature</code> is the core of any character which holds references to their other components.</summary><p>
</p><pre><code class="language-cs">using Animancer;
using Animancer.FSM;
using System;
using UnityEngine;

public sealed class Creature : MonoBehaviour, IAnimancerClipSource
{
    [SerializeField]
    private <a href="/animancer/v4-0/api/Animancer/AnimancerComponent">AnimancerComponent</a> _Animancer;
    public <a href="/animancer/v4-0/api/Animancer/AnimancerComponent">AnimancerComponent</a> Animancer { get { return _Animancer; } }

    [SerializeField]
    private CreatureState _Idle;
    public CreatureState Idle { get { return _Idle; } }

    public StateMachine&lt;CreatureState&gt; StateMachine { get; private set; }

    public Action ForceIdleState { get; private set; }

    private void Awake()
    {
        ForceIdleState = () =&gt; StateMachine.ForceSetState(_Idle);

        StateMachine = new StateMachine&lt;CreatureState&gt;(_Idle);
    }

    public void TrySetState(CreatureState state)
    {
        StateMachine.TrySetState(state);
    }
}
</code></pre>
<p></p></details><p></p>
<p></p><details><summary><code>CreatureState</code> is a very simple state that can be used by a <code>Creature</code>.</summary><p>
</p><pre><code class="language-cs">using Animancer;
using Animancer.FSM;
using UnityEngine;

public sealed class CreatureState : StateBehaviour&lt;CreatureState&gt;, IAnimancerClipSource
{
    [SerializeField] private Creature _Creature;
    [SerializeField] private AnimationClip _Animation;

    private void OnEnable()
    {
        var state = _Creature.Animancer.CrossFade(_Animation);
        if (!_Animation.isLooping)
            state.OnEnd = _Creature.ForceEnterIdleState;
    }

    public <a href="/animancer/v4-0/api/Animancer/AnimancerComponent">AnimancerComponent</a> Animancer { get { return _Creature.Animancer; } }
}
</code></pre>
<p></p></details><p></p>
<h1 id="creatures">Creatures</h1>
<p>The <code>Creature</code> component is the core of any character, whether it be a player, enemy, NPC, person, animal, monster, or robot. A different term may be more suitable depending on the type of game you are making - for example, a strategy game might use "Unit" while a space game might use "Ship" - but the idea is always the same: all of the game's characters share the same core script which holds references to each of its other components:</p>
<ul>
<li>The animation system (an <code><a href="/animancer/v4-0/api/Animancer/AnimancerComponent">AnimancerComponent</a></code> if you use Animancer, but otherwise it might just be an <code>Animator</code>).</li>
<li>A state machine (this example uses Animancer's <a href="../../../manual/finite-state-machines">Finite State Machine</a> system, but you can use any system you like).</li>
<li>The default <em>Idle</em> state for other states to return to.</li>
<li>Any other details such as a <code>Rigidbody</code>, character attributes, health pool, and so on.</li>
</ul>
<p>Anything that wants to access one or more of a creature's components can do so via the core <code>Creature</code> component. So rather than a <code>Locomotion</code> state having a reference to the <code><a href="/animancer/v4-0/api/Animancer/AnimancerComponent">AnimancerComponent</a></code> (to play animations) and <code>Rigidbody</code> (to apply force) and <code>CreatureStats</code> (to determine how fast it can move), every state just references the <code>Creature</code> and accesses the parts it needs through that reference.</p>
<h1 id="state-machine">State Machine</h1>
<p>This is the first example which demonstrates Animancer's <a href="../../../manual/finite-state-machines">Finite State Machine</a> system.</p>
<p>First we make a read-only property (public get, private set) so anything can access it and try to change its state, but other scripts can't set it to <code>null</code> or assign a different state machine to it by accident.</p>
<pre><code class="language-cs">public StateMachine&lt;CreatureState&gt; StateMachine { get; private set; }
</code></pre>
<p>Then we just initialise it with the desired default state on startup:</p>
<pre><code class="language-cs">private void Awake()
{
    StateMachine = new StateMachine&lt;CreatureState&gt;(_Idle);
}
</code></pre>
<p>Since we are using <code>CreatureState</code> as the <code>TState</code> generic parameter, this state machine will be able to use any instance of the <code>CreatureState</code> class or anything that inherits from it (though for this example we don't want anything to inherit from it so we made the class <code>sealed</code>).</p>
<h1 id="actions">Actions</h1>
<p>Much like how Animancer itself allows animations to come from anywhere instead of needing them to all be defined upfront, this state machine system also allows states to come from anywhere. For this example, we want to control the state machine using UI buttons so we also need a <code>TrySetState</code> method for their <code>UnityEvent</code>s to call (where other scripts would normally just call <code>creature.StateMachine.TrySetState</code> directly):</p>
<pre><code class="language-cs">public void TrySetState(CreatureState state)
{
    StateMachine.TrySetState(state);
}
</code></pre>
<p>This means that each state can be attached to the button that triggers it instead of making them all part of the creature.</p>
<p><img src="walk-button.png" class="img-responsive"></p>
<p>The <a href="../brains">Brains</a> example goes into more detail about controlling creature actions.</p>
<h1 id="returning-to-idle">Returning to Idle</h1>
<p>As was explained in the <a href="../../fine-control/spider-bot#caching-delegates">Fine Control/Spider Bot</a> example, creating a new delegate for the <code>AnimancerState.OnEnd</code> callback creates garbage which is bad for performance. So rather than having every state create garbage every time they want to return to the idle state after an animation finishes, the core <code>Creature</code> class is a good place to cache that delegate.</p>
<pre><code class="language-cs">public Action ForceIdleState { get; private set; }

private void Awake()
{
    ForceIdleState = () =&gt; StateMachine.ForceSetState(_Idle);
}
</code></pre>
<p>The <a href="../interrupt-management#states">Interrupt Management</a> example explains why we are using <code>ForceSetState</code> instead of <code>TrySetState</code>.</p>
<h1 id="current-state-display">Current State Display</h1>
<p>The <code>Creature</code> script also contains a method to display the current state in the Inspector if you have <a href="https://kybernetikgames.github.io/inspector-gadgets/pro">Inspector Gadgets Pro</a>:</p>
<p></p><table>
  <thead><tr>
  <td style="text-align:center">Edit Mode</td>
  <td style="text-align:center">Play Mode</td>
  </tr></thead>
  <tbody><tr>
  <td><img src="current-state-hidden.png" class="img-responsive"></td>
  <td><img src="current-state-shown.png" class="img-responsive"></td>
  </tr>
</tbody></table><p></p>
<p><a href="https://kybernetikgames.github.io/inspector-gadgets/pro">Inspector Gadgets Pro</a> adds a variety of enhancements to the Inspector for your scripts, one of which is the ability to write a method called <code>AfterInspectorGUI</code> which it will call after drawing the regular Inspector GUI of that script (or <code>OnInspectorGUI</code> if you want to replace the regular GUI entirely). We use this feature to draw the current state while in Play Mode, but if you don't have Inspector Gadgets Pro the method will simply never get called.</p>
<pre><code class="language-cs">#if UNITY_EDITOR
private void AfterInspectorGUI()
{
    if (UnityEditor.EditorApplication.isPlaying)
    {
        GUI.enabled = false;
        UnityEditor.EditorGUILayout.ObjectField("Current State", StateMachine.CurrentState, typeof(CreatureState), true);
    }
}
#endif
</code></pre>
<p>Note that the <code>#if UNITY_EDITOR</code> isn't always necessary to use <code>AfterInspectorGUI</code>, but in this case we need it because we are using classes in the <code>UnityEditor</code> namespace which don't exist in runtime builds.</p>
<h1 id="states">States</h1>
<p>Normally the base <code>CreatureState</code> would be an <code>abstract</code> class which defines common logic for all states to inherit when they implement their behaviour, but for this example all we want each state to do is play an animation so we use this one script for all of them.</p>
<p>The purpose of inheriting from <code>StateBehaviour</code> is described on the <a href="../../../manual/finite-state-machines">Finite State Machine</a> page. Basically, it gives our states basic functionality as components which are disabled by default and only get enabled when the state is entered. It doesn't really achieve anything useful in this example since the states don't do anything more than play an animation on entry, but in more complex systems this makes it easier to implement states that need <code>Update</code> or <code>FixedUpdate</code> methods to be called while that particular state is the current one.</p>
<p>The purpose of implementing <code>IAnimancerClipSource</code> (and the <code>public <a href="/animancer/v4-0/api/Animancer/AnimancerComponent">AnimancerComponent</a> Animancer</code> property) is explained in its API documentation page.</p>
<h1 id="walk-and-run">Walk and Run</h1>
<p>The base <code>CreatureState</code> class would normally not even have an <code>_Animation</code> field because some states might have no animation or even multiple animations. For example, <em>Walk</em> and <em>Run</em> might both be handled by a single <code>Locomotion</code> state which has references to both animations so that it can synchronise their walk cycles as described in the <a href="../../locomotion/walk-and-run">Locomotion/Walk and Run</a> example. Such a state would simply choose which animation to play depending on whether the creature's <a href="../brains">Brain</a> says it should be running.</p>
<hr>
<p>The <a href="../brains">Brains</a> example expands this system by implementing different ways of controlling creatures.</p>

	</section>
                
            </div>           
            
            <!-- Footer -->
            <footer class="main-footer">
            </footer>
            
        </div>
        <div class="wrapper bottom-wrapper">
            <footer class="bottom-footer">
                Generated by <a href="https://wyam.io">Wyam</a>
            </footer>
        </div>
        <a href="javascript:" id="return-to-top"><i class="fa fa-chevron-up"></i></a>
        
        <script>           
            // Close the sidebar if we select an anchor link
            $(".main-sidebar a[href^='#']:not('.expand')").click(function(){
                $(document.body).removeClass('sidebar-open');
            });
            
            $(document).ready(function() {
                mermaid.initialize(
                {
                    flowchart:
                    {
                        useMaxWidth: false
                    },
					startOnLoad: false,
					cloneCssStyles: false
                });     
                mermaid.init(undefined, ".mermaid");

                // Remove the max-width setting that Mermaid sets
                var mermaidSvg = $('.mermaid svg');
                mermaidSvg.addClass('img-responsive');
                mermaidSvg.css('max-width', '');

                // Make it scrollable
				var target = document.querySelector(".mermaid svg");
				if(target !== null)
				{
					var panZoom = window.panZoom = svgPanZoom(target, {
						zoomEnabled: true,
						controlIconsEnabled: true,
						fit: true,
						center: true,
                        maxZoom: 20,
                        zoomScaleSensitivity: 0.6
					});			                          

                    // Do the reset once right away to fit the diagram
                    panZoom.resize();
                    panZoom.fit();
                    panZoom.center();
                    
                    $(window).resize(function(){
                        panZoom.resize();
                        panZoom.fit();
                        panZoom.center();
                    });
				}
                
                $('pre code').each(function(i, block) {
                    hljs.highlightBlock(block);
                });  
            });

            hljs.initHighlightingOnLoad();

            // Back to top
            $(window).scroll(function() {
                if ($(this).scrollTop() >= 200) {        // If page is scrolled more than 50px
                    $('#return-to-top').fadeIn(1000);    // Fade in the arrow
                } else {
                    $('#return-to-top').fadeOut(1000);   // Else fade out the arrow
                }
            });
            $('#return-to-top').click(function() {      // When arrow is clicked
                $('body,html').animate({
                    scrollTop : 0                       // Scroll to top of body
                }, 500);
            });
        </script>
    
</body></html>