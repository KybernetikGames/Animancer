<!DOCTYPE html><html><head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
        <meta name="description">
        <meta name="keywords" content="static content generator,static site generator,static site,HTML,web development,.NET,C#,Razor,Markdown,YAML">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="/animancer/v4-0/assets/img/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/animancer/v4-0/assets/img/favicon.ico" type="image/x-icon">
        <title>Animancer - 02 Golf Events</title>
        <link href="/animancer/v4-0/assets/css/highlight.css" rel="stylesheet">
        <link href="/animancer/v4-0/assets/css/bootstrap/bootstrap.css" rel="stylesheet">
        <link href="/animancer/v4-0/assets/css/adminlte/AdminLTE.css" rel="stylesheet">
        <link href="/animancer/v4-0/assets/css/theme/theme.css" rel="stylesheet">
        <link href="//fonts.googleapis.com/css?family=Roboto+Mono:400,700|Roboto:400,400i,700,700i" rel="stylesheet">
        <link href="/animancer/v4-0/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href="/animancer/v4-0/assets/css/override.css" rel="stylesheet">
        <script src="/animancer/v4-0/assets/js/jquery-2.2.3.min.js"></script>
        <script src="/animancer/v4-0/assets/js/bootstrap.min.js"></script>        
        <script src="/animancer/v4-0/assets/js/app.min.js"></script>         
        <script src="/animancer/v4-0/assets/js/highlight.pack.js"></script>   
        <script src="/animancer/v4-0/assets/js/jquery.slimscroll.min.js"></script>
        <script src="/animancer/v4-0/assets/js/jquery.sticky-kit.min.js"></script>
        <script src="/animancer/v4-0/assets/js/mermaid.min.js"></script>
        <script src="/animancer/v4-0/assets/js/svg-pan-zoom.min.js"></script>
        <!--[if lt IE 9]>
        <script src="/animancer/v4-0/assets/js/html5shiv.min.js"></script>
        <script src="/animancer/v4-0/assets/js/respond.min.js"></script>
        <![endif]-->  

        
    </head>
    <body class="hold-transition wyam layout-boxed  ">    
        <div class="top-banner"></div>
        <div class="wrapper with-container">
            <!-- Header -->
            <header class="main-header">   
                     
                <a href="/animancer/v4-0/" class="logo">
                            <span>Animancer</span>
                </a>   
                         
                <nav class="navbar navbar-static-top" role="navigation">
                    <!-- Sidebar toggle button-->
                        <a href="#" class="sidebar-toggle visible-xs-block" data-toggle="offcanvas" role="button">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-right"></i>
                        </a>
                                        
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-down"></i>
                        </button>
                    </div>
            
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                        <ul class="nav navbar-nav">                            
                                    <li class="active"><a href="/animancer/v4-0/docs"><img src="/animancer/v4-0/images/docs.png" height="20" style="position:relative; left:-5px; top:-1px;"> Docs</a></li>
        <li><a href="/animancer/v4-0/docs/help"><img src="/animancer/v4-0/images/help.png" height="20" style="position:relative; left:-4px; top:-1px;"> Help</a></li>
        <li><a href="/animancer/v4-0/api/Animancer/AnimancerComponent"><img src="/animancer/v4-0/images/api.png" height="20" style="position:relative; left:-3px; top:-1px;"> API v4.0</a></li>
        <li><a href="/animancer/lite"><img src="/animancer/v4-0/images/unity-logo.png" height="20" style="position:relative; left:-4px; top:-1px;"> Try</a></li>
        <li><a href="/animancer/pro"><img src="/animancer/v4-0/images/unity-logo.png" height="20" style="position:relative; left:-4px; top:-1px;"> Buy</a></li>
        <li><a href="https://kybernetik.com.au/kailas-dierk/unity-assets"><img src="/animancer/v4-0/images/kybernetik.png" height="20" style="position:relative; left:-2px; top:-1px;"> Other Assets</a></li>
 
                        </ul>       
                    </div>
                    <!-- /.navbar-collapse -->
                
                    <!-- Navbar Right Menu -->
                </nav>
<a href="/animancer" style="font-size:1.42em; color:white">This is the <strong>Animancer v4.0 Beta</strong> Documentation. Click Here to return to the v3.1 Documentation.</a>
            </header>
            
            <!-- Left side column. contains the logo and sidebar -->
            <aside class="main-sidebar ">
                <section class="infobar" data-spy="affix" data-offset-top="60" data-offset-bottom="200"> 
                    	
    <div id="infobar-headings"><h6>On This Page</h6><p><a href="#base-script">Base Script</a></p>
<p><a href="#hit-events">Hit Events</a></p>
<p><a href="#end-events">End Events</a></p>
<hr class="infobar-hidden">
</div>

                </section>
                <section class="sidebar">    
                                     
                    

                    <ul class="sidebar-menu">
                        

                <li><a href="/animancer/v4-0/docs/help">Help and FAQ</a></li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/introduction">Introduction</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer">Mecanim vs. Animancer</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer/why-replace-mecanim">Why Replace Mecanim?</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer/playing">Playing</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer/waiting">Waiting</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer/speed-and-time">Speed and Time</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer/weapon-animations">Weapon Animations</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer/performance">Performance</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/v4-0/docs/introduction/features">Features</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/glossary">Glossary</a></li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/introduction/cs">C# in Unity</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/introduction/cs/overview">Scripting Overview</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/cs/organisation">Organisation</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/cs/variables">Variables</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/cs/methods">Methods</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/cs/inheritance">Inheritance</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/cs/vectors">Vectors</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/cs/other">Other Topics</a></li>

                    </ul>
                </li>

                    </ul>
                </li>
                <li class="treeview active">
                    <a href="/animancer/v4-0/docs/examples">Examples</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/basics">01 Basics</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/basics/scene-setup">Basic Scene Setup</a></li>
                <li><a href="/animancer/v4-0/docs/examples/basics/quick-play">01 Quick Play</a></li>
                <li><a href="/animancer/v4-0/docs/examples/basics/playing-and-fading">02 Playing and Fading</a></li>
                <li><a href="/animancer/v4-0/docs/examples/basics/sequence-coroutine">03 Sequence Coroutine</a></li>
                <li><a href="/animancer/v4-0/docs/examples/basics/named-animations">04 Named Animations</a></li>
                <li><a href="/animancer/v4-0/docs/examples/basics/hybrid">05 Hybrid Basics</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/fine-control">02 Fine Control</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/fine-control/spider-bot">01 Spider Bot</a></li>
                <li><a href="/animancer/v4-0/docs/examples/fine-control/doors">02 Doors</a></li>
                <li><a href="/animancer/v4-0/docs/examples/fine-control/solo-animation">03 Solo Animation</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/locomotion">03 Locomotion</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/locomotion/walk-and-run">01 Walk and Run</a></li>
                <li><a href="/animancer/v4-0/docs/examples/locomotion/root-motion">02 Root Motion</a></li>
                <li><a href="/animancer/v4-0/docs/examples/locomotion/linear-blending">03 Linear Blending</a></li>
                <li><a href="/animancer/v4-0/docs/examples/locomotion/directional-blending">04 Directional Blending</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/directional-sprites">04 Directional Sprites</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/directional-sprites/basic-movement">01 Basic Movement</a></li>
                <li><a href="/animancer/v4-0/docs/examples/directional-sprites/character-controller">02 Character Controller</a></li>

                    </ul>
                </li>
                <li class="treeview active">
                    <a href="/animancer/v4-0/docs/examples/events">05 Events</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/events/footstep-events">01 Footstep Events</a></li>
                <li class="selected"><a href="/animancer/v4-0/docs/examples/events/golf-events">02 Golf Events</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/fsm">06 State Machines</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/fsm/creatures">01 Creatures</a></li>
                <li><a href="/animancer/v4-0/docs/examples/fsm/interrupt-management">02 Interrupt Management</a></li>
                <li><a href="/animancer/v4-0/docs/examples/fsm/brains">03 Brains</a></li>
                <li><a href="/animancer/v4-0/docs/examples/fsm/more-brains">04 More Brains</a></li>
                <li><a href="/animancer/v4-0/docs/examples/fsm/platformer">05 Platformer</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/v4-0/docs/examples/layers">07 Layers</a></li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/inverse-kinematics">08 Inverse Kinematics</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/inverse-kinematics/puppet">01 Puppet</a></li>
                <li><a href="/animancer/v4-0/docs/examples/inverse-kinematics/uneven-ground">02 Uneven Ground</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/animator-controllers">09 Animator Controllers</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/hybrid">01 Hybrid Mini Game</a></li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit">02 3D Game Kit</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/problems">Problems with the Original</a></li>
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/respawn">Respawn</a></li>
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/idle">Idle</a></li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/locomotion">Locomotion</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/locomotion/movement">Movement</a></li>
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/locomotion/turning">Turning</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/airborne">Airborne</a></li>
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/landing">Landing</a></li>
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/attack">Attack</a></li>

                    </ul>
                </li>

                    </ul>
                </li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/manual">User Manual</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/manual/playing">Playing Animations</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/manual/playing/states">States</a></li>
                <li><a href="/animancer/v4-0/docs/manual/playing/inspector">Inspector</a></li>
                <li><a href="/animancer/v4-0/docs/manual/playing/component-types">Component Types</a></li>
                <li><a href="/animancer/v4-0/docs/manual/playing/directional-sets">Directional Animation Sets</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/manual/transitions">Transitions</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/manual/transitions/types">Transition Types</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/manual/blending">Blending</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/manual/blending/fading">Fading</a></li>
                <li><a href="/animancer/v4-0/docs/manual/blending/layers">Layers</a></li>
                <li><a href="/animancer/v4-0/docs/manual/blending/mixers">Mixers</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/manual/events">Events</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/manual/events/animation">Animation Events</a></li>
                <li><a href="/animancer/v4-0/docs/manual/events/animancer">Animancer Events</a></li>
                <li><a href="/animancer/v4-0/docs/manual/events/end">End Events</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/v4-0/docs/manual/fsm">Finite State Machines</a></li>
                <li><a href="/animancer/v4-0/docs/manual/animator-controllers">Animator Controllers</a></li>
                <li><a href="/animancer/v4-0/docs/manual/inverse-kinematics">Inverse Kinematics</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/bugs">Unity Bugs</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/bugs/inconsistent-timing">Inconsistent Timing</a></li>
                <li><a href="/animancer/v4-0/docs/bugs/paused-skinned-mesh-update">Paused Skinned Mesh Update</a></li>
                <li><a href="/animancer/v4-0/docs/bugs/resetting-animated-values">Resetting Animated Values</a></li>
                <li><a href="/animancer/v4-0/docs/bugs/unused-graph-destroy-warning">Unused Graph Destroy Warning</a></li>
                <li><a href="/animancer/v4-0/docs/bugs/update-modes">Update Modes</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/source">Source Code</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/source/dlls">DLLs</a></li>
                <li><a href="/animancer/v4-0/docs/source/creating-custom-states">Creating Custom States</a></li>
                <li><a href="/animancer/v4-0/docs/source/graph-structure">Graph Structure</a></li>
                <li><a href="/animancer/v4-0/docs/source/asset-sources">Asset Sources</a></li>
                <li><a href="/animancer/v4-0/docs/source/coding-standard">Coding Standard</a></li>
                <li><a href="/animancer/v4-0/docs/source/default-script-template">Default Script Template</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/changes">Change Log</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/changes/animancer-v4-0-beta">Beta Test v4.0</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v4-0">Progress of v4.0</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v3-1">Animancer v3.1</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v3-0">Animancer v3.0</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v2-0">Animancer v2.0</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v1-3">Animancer v1.3</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v1-2">Animancer v1.2</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v1-1">Animancer v1.1</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v1-0">Animancer v1.0</a></li>

                    </ul>
                </li>

                    </ul>
                            
                </section>                
            </aside>
            
            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                



		<section class="content-header">
			<h1>02 Golf Events</h1>
		</section>
	<section class="content">
		<blockquote class="blockquote">
<p><strong>Difficulty</strong>: <a href="../../../introduction/glossary#example-difficulty">Intermediate</a></p>
<p><strong>Location</strong>: <em>Assets/Plugins/Animancer/Examples/05 Events/02 Golf Events</em></p>
<p><strong>Namespace</strong>: <a href="../../../../api/Animancer.Examples.Events"><code>Animancer.Examples.Events</code></a></p>
</blockquote>
<p>This example expands upon the <a href="../../basics/quick-play">Quick Play</a> scene to demonstrate how you can utilise the various types of <a href="../../../manual/events">Events</a> supported by Animancer. It shows how you can have a character hit a ball at a specific time and adjust the end time of the animation to create a smoother transition. Both of these tasks are performed in several different ways using Unity's <a href="../../../manual/events/animation">Animation Events</a> and <a href="../../../manual/events/animancer">Animancer Events</a> so that you can compare the differences between those systems.</p>
<p><em><a href="../../../introduction/features"><strong>Pro-Only Features</strong></a> are used in this example: <a href="../../../manual/events/animancer">Animancer Events</a> and <a href="../../manual/blending/fading">Fading with a non-default duration.</a> Animancer Lite allows you to try out these features in the Unity Editor, but they are not available in runtime builds unless you purchase <a href="/animancer/pro">Animancer Pro</a>.</em></p>
<p><img src="golf-events.gif" class="img-responsive"></p>
<p></p><details><summary>The base <code><a href="/animancer/v4-0/api/Animancer.Examples.Events/GolfHitController">GolfHitController</a></code> script looks like this (with the comments removed since we are about to explain how it works):</summary><p>
</p><pre><code class="language-cs">using Animancer;
using System;
using UnityEngine;

public abstract class <a href="/animancer/v4-0/api/Animancer.Examples.Events/GolfHitController">GolfHitController</a> : MonoBehaviour
{
    [SerializeField] protected <a href="/animancer/v4-0/api/Animancer/AnimancerComponent">AnimancerComponent</a> _Animancer;
    [SerializeField] protected <a href="/animancer/v4-0/api/Animancer/Transition">ClipState.Transition</a> _Ready;
    [SerializeField] protected <a href="/animancer/v4-0/api/Animancer/Transition">ClipState.Transition</a> _Swing;
    [SerializeField] protected <a href="/animancer/v4-0/api/Animancer/Transition">ClipState.Transition</a> _Idle;
    [SerializeField] private Rigidbody _Ball;
    [SerializeField] private Vector3 _HitVelocity;
    [SerializeField] private AudioSource _HitSound;

    public enum State { Ready, Swing, Idle, }

    private State _State;
    private Vector3 _BallStartPosition;

    protected virtual void Awake()
    {
        _BallStartPosition = _Ball.position;
        _Ball.isKinematic = true;
    }

    protected void OnEnable()
    {
        ReturnToReady();
    }

    protected void Update()
    {
        if (Input.GetMouseButtonDown(0))
        {
            switch (_State)
            {
                case State.Ready: StartSwing(); break;
                case State.Swing: TryCancelSwing(); break;
                case State.Idle: ReturnToReady(); break;
                default: throw new ArgumentException("Unhandled State: " + _State);
            }
        }
    }

    protected virtual void StartSwing()
    {
        _State = State.Swing;
        _Animancer.Play(_Swing);
    }

    private void TryCancelSwing()
    {
        if (_Ball.isKinematic)
        {
            _State = State.Ready;
            _Animancer.Play(_Ready);
        }
    }

    private void ReturnToReady()
    {
        _State = State.Ready;
        _Animancer.Play(_Ready);

        _Ball.isKinematic = true;
        _Ball.position = _BallStartPosition;
    }

    public void HitBall()
    {
        _Ball.isKinematic = false;
        _Ball.velocity = _HitVelocity;

        _HitSound.Play();
    }

    public void EndSwing()
    {
        _State = State.Idle;

        var fadeDuration = AnimancerPlayable.GetFadeOutDuration();
        _Animancer.Play(_Idle, fadeDuration);
    }

    protected void Reset()
    {
        AnimancerUtilities.IfMultiComponentThenChangeType(this);
    }
}
</code></pre>
<p></p></details><p></p>
<p>To demonstrate the differences between the available event systems, this example consists of 4 other scripts which <a href="../../../introduction/cs/inheritance">Inherit</a> from <code><a href="/animancer/v4-0/api/Animancer.Examples.Events/GolfHitController">GolfHitController</a></code> so they can all share the same general logic but implement their own events for hitting the ball and determining when the next animation should start:</p>
<table class="table">
<thead>
<tr>
<th>#</th>
<th>Script</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><code><a href="/animancer/v4-0/api/Animancer.Examples.Events/GolfHitControllerAnimationSimple">GolfHitControllerAnimationSimple</a></code></td>
<td>Uses a <a href="../../../manual/events/animation#simple-events">Simple Animation Event</a> and <a href="../../../manual/events/animation#end-animation-events">End Animation Event</a>.</td>
</tr>
<tr>
<td>2</td>
<td><code><a href="/animancer/v4-0/api/Animancer.Examples.Events/GolfHitControllerAnimation">GolfHitControllerAnimation</a></code></td>
<td>Uses a regular <a href="../../../manual/events/animation">Animation Event</a> and <a href="../../../manual/events/animation#end-animation-events">End Animation Event</a>.</td>
</tr>
<tr>
<td>3</td>
<td><code><a href="/animancer/v4-0/api/Animancer.Examples.Events/GolfHitControllerAnimancer">GolfHitControllerAnimancer</a></code></td>
<td>Uses <a href="../../../manual/events/animancer">Animancer Events</a> configured in the Inspector.</td>
</tr>
<tr>
<td>4</td>
<td><code><a href="/animancer/v4-0/api/Animancer.Examples.Events/GolfHitControllerAnimancerHybrid">GolfHitControllerAnimancerHybrid</a></code></td>
<td>Uses <a href="../../../manual/events/animancer">Animancer Events</a> which have their times configured in the Inspector but their callbacks are left blank so that they can be assigned using code (without needing to hard-code the times).</td>
</tr>
</tbody>
</table>
<h1 id="base-script">Base Script</h1>
<p>The base <code><a href="/animancer/v4-0/api/Animancer.Examples.Events/GolfHitController">GolfHitController</a></code> script is fairly simple so you may want to simply skip ahead to the <a href="#hit-events">Hit Events</a> section where it starts explaining the setup of the actual events.</p>
<h2 id="fields">Fields</h2>
<pre><code class="language-cs">[SerializeField] protected <a href="/animancer/v4-0/api/Animancer/AnimancerComponent">AnimancerComponent</a> _Animancer;
[SerializeField] protected <a href="/animancer/v4-0/api/Animancer/Transition">ClipState.Transition</a> _Ready;
[SerializeField] protected <a href="/animancer/v4-0/api/Animancer/Transition">ClipState.Transition</a> _Swing;
[SerializeField] protected <a href="/animancer/v4-0/api/Animancer/Transition">ClipState.Transition</a> _Idle;
[SerializeField] private Rigidbody _Ball;
[SerializeField] private Vector3 _HitVelocity;
[SerializeField] private AudioSource _HitSound;
</code></pre>
<p>Normally it would be good to make <a href="../../../introduction/cs/methods#properties">Read-Only Properties</a> to wrap fields you want other classes to access so that those classes do not accidentally change any of the fields this script does not expect to change. But for this example, it is easier to just let the <a href="../../../introduction/cs/inheritance">Inheriting</a> classes access <a href="../../../introduction/cs/organisation#access-modifiers"><code>protected</code></a> fields directly.</p>
<p>The fields are given mostly the same values for each of the characters except for the <code>_Swing</code> <a href="../../../manual/transitions">Transition</a> where the ones using <a href="../../../manual/events/animation">Animation Events</a> need to use a duplicate of the original <em>Humanoid-GolfSwing</em> animation with the events added to it:</p>
<table class="table">
  <thead>
    <tr><th style="width:50%">Animation Events</th>
    <th style="width:50%">Animancer Events</th>
  </tr></thead>
  <tbody>
    <tr>
      <td><p><strong>1. Animation Simple</strong>: uses the <em>Humanoid-GolfSwing-WithEvents</em> animation with an additional reference to a <code><a href="/animancer/v4-0/api/Animancer/SimpleEventReceiver">SimpleEventReceiver</a></code> for the <a href="#hit-events">Hit Event</a>.</p><img src="animation-simple-inspector.png" class="img-responsive"></td>
      <td><p><strong>3. Animancer</strong>: uses the <a href="../../../manual/events/animancer">Animancer Events</a> in the <a href="../../../manual/transitions">Transition</a> configured in the Inspector to trigger the <a href="#hit-events">Hit Event</a> and <a href="#end-events">End Event</a>.</p><img src="animancer-inspector.png" class="img-responsive"></td>
    </tr>
    <tr>
      <td><p><strong>2. Animation</strong>: uses the same <em>Humanoid-GolfSwing-WithEvents</em> animation as above.</p><img src="animation-inspector.png" class="img-responsive"></td>
      <td><p><strong>4. Animancer Hybrid</strong>: uses <a href="../../../manual/events/animancer">Animancer Events</a> with the same times as above but the callbacks left blank.</p><img src="animancer-hybrid-inspector.png" class="img-responsive"></td>
    </tr>
  </tbody>
</table>
<p>We also have a simple <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/enum">Enum</a> to represent the character's current state and another field to store the initial position of the ball:</p>
<pre><code class="language-cs">public enum State { Ready, Swing, Idle, }

private State _State;
private Vector3 _BallStartPosition;
</code></pre>
<h2 id="startup">Startup</h2>
<p>When the scene starts, we store the position of the ball so we can teleport it back there later and make sure its <code>Rigidbody</code> is <a href="https://docs.unity3d.com/ScriptReference/Rigidbody-isKinematic">Kinematic</a> so that it does not roll away before the character hits it. The <code>Awake</code> method is <a href="../../../introduction/cs/inheritance#keywords"><code>virtual</code></a> in case any inheriting scripts need to do anything else on startup.</p>
<pre><code class="language-cs">protected virtual void Awake()
{
    _BallStartPosition = _Ball.position;
    _Ball.isKinematic = true;
}
</code></pre>
<p>We also want to make sure the character is in the <code>Ready</code> state on startup. It would be fine to do that in <code>Awake</code> for this example, but the <a href="../../animator-controllers/hybrid">Hybrid Mini Game</a> example reuses this script and deactivates it while the Mini Game is not being played so we want to always enter the ready state when the Mini Game starts:</p>
<pre><code class="language-cs">protected void OnEnable()
{
    ReturnToReady();
}
</code></pre>
<p>The contents of the <code>ReturnToReady</code> method could simply be here instead of needing a separate method, but when other methods (like <code>Update</code>) call it we would rather be clear that we specifically want to "return to the ready state" instead of some arbitrary "do what we did on startup".</p>
<p>Also note that this method is <a href="../../../introduction/cs/organisation#access-modifiers"><code>protected</code></a> instead of <a href="../../../introduction/cs/organisation#access-modifiers"><code>private</code></a>. Being <a href="../../../introduction/cs/organisation#access-modifiers"><code>protected</code></a> allows <a href="../../../introduction/cs/inheritance">Inheriting</a> classes to call it which we do not want, but it also means that if such a class tries to declare its own <code>OnEnable</code> method the compiler will give them a warning that this method already exists so they can come and make this method <a href="../../../introduction/cs/inheritance#keywords"><code>virtual</code></a> if necessary. Otherwise Unity would call the <code>OnEnable</code> method in the derived class but not this one, which would very likely lead to errors that can be annoying to track down.</p>
<h2 id="input">Input</h2>
<p>Using an <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/enum">Enum</a> to represent the character's current state means we can easily have them go to the next state whenever the player clicks the mouse using a <a href="../../../introduction/cs/methods#flow-control"><code>switch</code></a> statement:</p>
<pre><code class="language-cs">protected void Update()
{
    if (Input.GetMouseButtonDown(0))
    {
        switch (_State)
        {
            case State.Ready: StartSwing(); break;
            case State.Swing: TryCancelSwing(); break;
            case State.Idle: ReturnToReady(); break;
            default: throw new ArgumentException("Unhandled State: " + _State);
        }
    }
}
</code></pre>
<p>To start the swing we simply set the state and play the appropriate animation:</p>
<pre><code class="language-cs">protected virtual void StartSwing()
{
    _State = State.Swing;
    _Animancer.Play(_Swing);
}
</code></pre>
<p>If the player clicks while swinging and the ball has not been hit yet, the swing can be cancelled to immediately return to the ready state. But after the ball has been hit, the character must fully complete the swing animation:</p>
<pre><code class="language-cs">private void TryCancelSwing()
{
    if (_Ball.isKinematic)
    {
        _State = State.Ready;
        _Animancer.Play(_Ready);
    }
}
</code></pre>
<p>Each of the <a href="#events">Events</a> will be triggered at some point during the swing by whichever event system is being used:</p>
<ul>
<li><code>HitBall</code> sends the ball flying.</li>
<li><code>EndSwing</code> puts the character in the <code>Idle</code> state so they can relax after they hit the ball.</li>
</ul>
<p>If the player clicks the mouse again while <code>Idle</code>, we return to the <code>Ready</code> state, teleport the ball back to its starting position, and make it <a href="https://docs.unity3d.com/ScriptReference/Rigidbody-isKinematic">Kinematic</a> again so it does not roll away:</p>
<pre><code class="language-cs">private void ReturnToReady()
{
    _State = State.Ready;
    _Animancer.Play(_Ready);

    _Ball.isKinematic = true;
    _Ball.position = _BallStartPosition;
}
</code></pre>
<h2 id="events">Events</h2>
<p>The following two methods are called by whichever event system is being used by each character.</p>
<p>The <a href="#hit-events">Hit Event</a> makes the ball <a href="https://docs.unity3d.com/ScriptReference/Rigidbody-isKinematic">Non-Kinematic</a> so that it will act according to physics, gives it an initial velocity, and plays a hit sound:</p>
<pre><code class="language-cs">public void HitBall()
{
    _Ball.isKinematic = false;
    _Ball.velocity = _HitVelocity;

    _HitSound.Play();
}
</code></pre>
<p>In a real golf game you would probably calculate the hit velocity based on player input.</p>
<p>The <a href="#end-events">End Event</a> transitions the character into the <code>Idle</code> state. The events are set up to call this method before the <code>_Swing</code> animation actually finishes so that it can <a href="../../../manual/blending/fading">Fade</a> into the new animation more smoothly. This is done by using the remaining duration of the current animation as the fade duration:</p>
<pre><code class="language-cs">public void EndSwing()
{
    _State = State.Idle;

    var fadeDuration = AnimancerPlayable.GetFadeOutDuration();
    _Animancer.Play(_Idle, fadeDuration);
}
</code></pre>
<p>For this example we are just using the regular <em>Humanoid-Idle</em> animation, which does not account for the golf club and ends up sticking it through the ground.</p>
<h2 id="changing-scripts">Changing Scripts</h2>
<p>Since we want all of the characters to use basically the same values for their <a href="../../../introduction/cs/variables#serialized-fields">Serialized Fields</a> and Unity does not give us a way of copying values between different component types, we can use a serialization trick when we add a second component that inherits from <code><a href="/animancer/v4-0/api/Animancer.Examples.Events/GolfHitController">GolfHitController</a></code> to have Unity change the type of the existing script and immediately destroy the newly added script:</p>
<pre><code class="language-cs">protected void Reset()
{
    AnimancerUtilities.IfMultiComponentThenChangeType(this);
}
</code></pre>
<p>That allows us to set up one character, copy it, and change the controller script on each of the copies without losing their serialized values.</p>
<h1 id="hit-events">Hit Events</h1>
<p>The <code>HitBall</code> method <a href="#events">explained above</a> is called at some point during the <code>_Swing</code> animation in a different way for each event system.</p>
<h2 id="simple-animation-events">1. Simple Animation Events</h2>
<p>The <code><a href="/animancer/v4-0/api/Animancer/SimpleEventReceiver">SimpleEventReceiver</a></code> script is set up to receive <a href="../../../manual/events/animation#simple-events">Animation Events with the Function Name "Event"</a> and invoke a <a href="../../../introduction/cs/methods#delegates">Delegate</a> in response, allowing you to use that same Function Name for every animation and register any method you want instead of needing to have your method on a script attached to the same <code>GameObject</code> as the <code>Animator</code> component. So the character is set up as follows:</p>
<ol>
<li>The <code><a href="/animancer/v4-0/api/Animancer/SimpleEventReceiver">SimpleEventReceiver</a></code> component is attached to the same <code>GameObject</code> as the <code>Animator</code> component so it can receive the event, but the <code><a href="/animancer/v4-0/api/Animancer.Examples.Events/GolfHitControllerAnimationSimple">GolfHitControllerAnimationSimple</a></code> component does not need to be.</li>
<li>The <code><a href="/animancer/v4-0/api/Animancer.Examples.Events/GolfHitControllerAnimationSimple">GolfHitControllerAnimationSimple</a></code> script overrides its <code>StartSwing</code> method to register its <code>HitBall</code> method as the receiver delegate in the <code><a href="/animancer/v4-0/api/Animancer/SimpleEventReceiver">SimpleEventReceiver</a></code> component:</li>
</ol>
<pre><code class="language-cs">protected override void StartSwing()
{
    base.StartSwing();

    var state = _Animancer.States.Current;
    _EventReceiver.onEvent.Set(state, (animationEvent) =&gt; HitBall());
}
</code></pre>
<p>Since we are using the <code>Set</code> method to specify which <code>state</code> we expect the event to come from, any events with the same name that come from other animations will be ignored. Likewise, if anything starts another animation, this callback will no longer be triggered. If we had set the <code>_EventReceiver.onEvent.Callback</code> directly, it would still get invoked if something interrupts this state and the event occurs while it was fading out. This could mean that a cancelled animation triggers a callback which was registered for a new animation, likely far earlier than desired.</p>
<ol start="3">
<li>The <em>Humanoid-GolfSwing-WithEvents</em> animation has an event with the Function Name "Event".</li>
</ol>
<p><img src="simple-event-window.png" class="img-responsive"></p>
<p><img src="simple-event-inspector.png" class="img-responsive"></p>
<ol start="4">
<li>When that event occurs, the <code><a href="/animancer/v4-0/api/Animancer/SimpleEventReceiver">SimpleEventReceiver</a></code> component receives it and invoked the registered delegate (which is the <code>HitBall</code> method from step 2).</li>
</ol>
<h2 id="animation-events">2. Animation Events</h2>
<p>The setup of the second character is very similar to the first, except that it does not have a <code><a href="/animancer/v4-0/api/Animancer/SimpleEventReceiver">SimpleEventReceiver</a></code> so it instead has to receive the <code>"Event"</code> function directly by declaring a method with that name and being attached to the same <code>GameObject</code> as the <code>Animator</code> component:</p>
<pre><code class="language-cs">private void Event()
{
    HitBall();
}
</code></pre>
<p>We could have avoided the need for that method by making another copy of the <em>Humanoid-GolfSwing</em> animation to use <code>"HitBall"</code> as the Function Name instead of <code>"Event"</code>. But that only demonstrates one of the weaknesses of <a href="../../../manual/events/animation">Animation Events</a>, which is that everything using an animation shares the same events so if you want different ones you need to duplicate the entire animation which is a waste of memory if nothing else.</p>
<h2 id="animancer-events">3. Animancer Events</h2>
<p>The <code><a href="/animancer/v4-0/api/Animancer.Examples.Events/GolfHitControllerAnimancer">GolfHitControllerAnimancer</a></code> script is actually empty because the base <code><a href="/animancer/v4-0/api/Animancer.Examples.Events/GolfHitController">GolfHitController</a></code> already has everything we need to be able to set up <a href="../../../manual/events/animancer">Animancer Events</a> in the Inspector. The event callback is set up using a <a href="../../../introduction/cs/methods#unity-events"><code>UnityEvent</code></a> just like a <a href="../../basics/scene-setup#buttons">UI Button</a>:</p>
<p><img src="animancer-hit-event.png" class="img-responsive"></p>
<h2 id="hybrid-animancer-events">4. Hybrid Animancer Events</h2>
<p>The last character also uses <a href="../../../manual/events/animancer">Animancer Events</a>, but the event only has its time set in the Inspector with its callback left blank:</p>
<p><img src="animancer-hybrid-hit-event.png" class="img-responsive"></p>
<p>This allows the <code><a href="/animancer/v4-0/api/Animancer.Examples.Events/GolfHitControllerAnimancerHybrid">GolfHitControllerAnimancerHybrid</a></code> script to verify that the expected number of events actually exist and then assign the callback on startup:</p>
<pre><code class="language-cs">protected override void Awake()
{
    base.Awake();

    Debug.Assert(_Swing.Events.Sequence.Count == 1,
        "Expected one event for hitting the ball", this);
    _Swing.Events.Sequence.Set(0, HitBall);

    // ... Initialise the End Event as well.
}
</code></pre>
<p>Note how <code>this</code> is used as the last parameter in the <code>Debug.Assert</code> call to specify the <code>context</code> so that if the condition is false and it logs the message, clicking on that message in the Console window will highlight the object this script is attached to in the Hierarchy window. Other <code>Debug</code> methods like <code>Debug.Log</code> also have the same optional <code>context</code> parameter.</p>
<p>If we did not create the event in the Inspector, we could create it from scratch like so:</p>
<pre><code class="language-cs">    _Swing.Events.Sequence.Add(new AnimancerEvent(0.375f, OnHitBall));
</code></pre>
<p>But that would hard-code the event time into the script instead of allowing us to use the <a href="../../../manual/transitions#previews">Transition Preview Window</a> to see what the animated model looks like while we adjust the event time.</p>
<h1 id="end-events">End Events</h1>
<table class="table">
  <thead>
    <tr><th style="width:50%">Standard End</th>
    <th style="width:50%">Early End</th>
  </tr></thead>
  <tbody>
    <tr>
      <td><img src="standard-end.gif" class="img-responsive"></td>
      <td><img src="early-end.gif" class="img-responsive"></td>
    </tr>
    <tr>
      <td><img src="standard-end.gif" class="img-responsive"></td>
      <td><img src="early-end.gif" class="img-responsive"></td>
    </tr>
  </tbody>
</table>
<p>If we wait for the actual end of the swing animation before we start transitioning to idle (the video on the left), we can observe an unnatural change in the motion when the transition begins. The swing animation goes up to the top of the arc and begins to relax, then when that animation actually finishes it starts transitioning from that pose to <em>Idle</em>. It's fairly smooth, but it's clearly a different motion from the end of the swing. This is made worse by the fact that the <em>Swing</em> animation ends in a pose similar to the one it started in which isn't the <em>Idle</em> pose we want to be in, so the character relaxes towards one pose then suddenly decides to go to a different pose.</p>
<p>This can be improved by simply starting the transition early (the video on the right) and having it last for the entire remaining duration of the swing animation so that the "relaxation" of the character's pose consistently comes from both the end of the swing animation and from the <a href="../../../manual/blending/fading">Fade</a> towards <em>Idle</em> at the same time. This is done by having the <code>EndSwing</code> method call <code>AnimancerPlayable.GetFadeOutDuration</code> to get the remaining duration instead of using the regular duration of the <code>_Idle</code> transition:</p>
<pre><code class="language-cs">public void EndSwing()
{
    _State = State.Idle;

    var fadeDuration = AnimancerPlayable.GetFadeOutDuration();
    _Animancer.Play(_Idle, fadeDuration);
}
</code></pre>
<h2 id="simple-animation-events-and-2.animation-events">1. Simple Animation Events and 2. Animation Events</h2>
<p>The <code><a href="/animancer/v4-0/api/Animancer.Examples.Events/GolfHitControllerAnimation">GolfHitControllerAnimation</a></code> and <code><a href="/animancer/v4-0/api/Animancer.Examples.Events/GolfHitControllerAnimationSimple">GolfHitControllerAnimationSimple</a></code> scripts both have the exact same <code>Awake</code> method to assign <code>EndSwing</code> as the <code>OnEnd</code> callback of the <code>_Swing</code> animation:</p>
<pre><code class="language-cs">protected override void Awake()
{
    base.Awake();
    _Swing.Events.Sequence.OnEnd = EndSwing;
}
</code></pre>
<p>That on its own would still only trigger <code>EndSwing</code> at the very end of the animation, but the <em>Humanoid-GolfSwing-WithEvents</em> animation they use also has another event with the Function Name <code>"End"</code> which will trigger that callback early:</p>
<p><img src="end-event-window.png" class="img-responsive"></p>
<p><img src="end-event-inspector.png" class="img-responsive"></p>
<h2 id="animancer-events-1">3. Animancer Events</h2>
<p>As with the <a href="#hit-events">Hit Event</a>, the <code><a href="/animancer/v4-0/api/Animancer.Examples.Events/GolfHitControllerAnimancer">GolfHitControllerAnimancer</a></code> script is empty and has its events defined entirely in the Inspector:</p>
<p><img src="animancer-end-event.png" class="img-responsive"></p>
<h2 id="hybrid-animancer-events-1">4. Hybrid Animancer Events</h2>
<p>As with the <a href="#hit-events">Hit Event</a>, the <code><a href="/animancer/v4-0/api/Animancer.Examples.Events/GolfHitControllerAnimancerHybrid">GolfHitControllerAnimancerHybrid</a></code> script has its time set in the Inspector with the callback left blank:</p>
<p><img src="animancer-hybrid-end-event.png" class="img-responsive"></p>
<p>Then it assigns <code>EndSwing</code> as the callback just like the first two characters did above:</p>
<pre><code class="language-cs">protected override void Awake()
{
    base.Awake();

    // ... Initialise the Hit Event as shown above.

    _Swing.Events.Sequence.OnEnd = EndSwing;
}
</code></pre>

	</section>
                
            </div>           
            
            <!-- Footer -->
            <footer class="main-footer">
            </footer>
            
        </div>
        <div class="wrapper bottom-wrapper">
            <footer class="bottom-footer">
                Generated by <a href="https://wyam.io">Wyam</a>
            </footer>
        </div>
        <a href="javascript:" id="return-to-top"><i class="fa fa-chevron-up"></i></a>
        
        <script>           
            // Close the sidebar if we select an anchor link
            $(".main-sidebar a[href^='#']:not('.expand')").click(function(){
                $(document.body).removeClass('sidebar-open');
            });
            
            $(document).ready(function() {
                mermaid.initialize(
                {
                    flowchart:
                    {
                        useMaxWidth: false
                    },
					startOnLoad: false,
					cloneCssStyles: false
                });     
                mermaid.init(undefined, ".mermaid");

                // Remove the max-width setting that Mermaid sets
                var mermaidSvg = $('.mermaid svg');
                mermaidSvg.addClass('img-responsive');
                mermaidSvg.css('max-width', '');

                // Make it scrollable
				var target = document.querySelector(".mermaid svg");
				if(target !== null)
				{
					var panZoom = window.panZoom = svgPanZoom(target, {
						zoomEnabled: true,
						controlIconsEnabled: true,
						fit: true,
						center: true,
                        maxZoom: 20,
                        zoomScaleSensitivity: 0.6
					});			                          

                    // Do the reset once right away to fit the diagram
                    panZoom.resize();
                    panZoom.fit();
                    panZoom.center();
                    
                    $(window).resize(function(){
                        panZoom.resize();
                        panZoom.fit();
                        panZoom.center();
                    });
				}
                
                $('pre code').each(function(i, block) {
                    hljs.highlightBlock(block);
                });  
            });

            hljs.initHighlightingOnLoad();

            // Back to top
            $(window).scroll(function() {
                if ($(this).scrollTop() >= 200) {        // If page is scrolled more than 50px
                    $('#return-to-top').fadeIn(1000);    // Fade in the arrow
                } else {
                    $('#return-to-top').fadeOut(1000);   // Else fade out the arrow
                }
            });
            $('#return-to-top').click(function() {      // When arrow is clicked
                $('body,html').animate({
                    scrollTop : 0                       // Scroll to top of body
                }, 500);
            });
        </script>
    
</body></html>