<!DOCTYPE html><html><head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
        <meta name="description">
        <meta name="keywords" content="static content generator,static site generator,static site,HTML,web development,.NET,C#,Razor,Markdown,YAML">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="/animancer/assets/img/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/animancer/assets/img/favicon.ico" type="image/x-icon">
        <title>Animancer - 07 Layers</title>
        <link href="/animancer/assets/css/highlight.css" rel="stylesheet">
        <link href="/animancer/assets/css/bootstrap/bootstrap.css" rel="stylesheet">
        <link href="/animancer/assets/css/adminlte/AdminLTE.css" rel="stylesheet">
        <link href="/animancer/assets/css/theme/theme.css" rel="stylesheet">
        <link href="//fonts.googleapis.com/css?family=Roboto+Mono:400,700|Roboto:400,400i,700,700i" rel="stylesheet">
        <link href="/animancer/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href="/animancer/assets/css/override.css" rel="stylesheet">
        <script src="/animancer/assets/js/jquery-2.2.3.min.js"></script>
        <script src="/animancer/assets/js/bootstrap.min.js"></script>        
        <script src="/animancer/assets/js/app.min.js"></script>         
        <script src="/animancer/assets/js/highlight.pack.js"></script>   
        <script src="/animancer/assets/js/jquery.slimscroll.min.js"></script>
        <script src="/animancer/assets/js/jquery.sticky-kit.min.js"></script>
        <script src="/animancer/assets/js/mermaid.min.js"></script>
        <script src="/animancer/assets/js/svg-pan-zoom.min.js"></script>
        <!--[if lt IE 9]>
        <script src="/animancer/assets/js/html5shiv.min.js"></script>
        <script src="/animancer/assets/js/respond.min.js"></script>
        <![endif]-->  

        
    </head>
    <body class="hold-transition wyam layout-boxed  ">    
        <div class="top-banner"></div>
        <div class="wrapper with-container">
            <!-- Header -->
            <header class="main-header">   
                     
                <a href="/animancer/" class="logo">
                            <span>Animancer</span>
                </a>   
                         
                <nav class="navbar navbar-static-top" role="navigation">
                    <!-- Sidebar toggle button-->
                        <a href="#" class="sidebar-toggle visible-xs-block" data-toggle="offcanvas" role="button">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-right"></i>
                        </a>
                                        
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-down"></i>
                        </button>
                    </div>
            
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                        <ul class="nav navbar-nav">                            
                                    <li class="active"><a href="/animancer/docs"><img src="/animancer/images/docs.png" height="20" style="position:relative; left:-5px; top:-1px;"> Docs</a></li>
        <li><a href="/animancer/faq"><img src="/animancer/images/faq.png" height="20" style="position:relative; left:-4px; top:-1px;"> FAQ</a></li>
        <li><a href="/animancer/api/Animancer/AnimancerComponent"><img src="/animancer/images/api.png" height="20" style="position:relative; left:-3px; top:-1px;"> API v3.1</a></li>
        <li><a href="https://forum.unity.com/threads/566452"><img src="/animancer/images/forum.png" height="20" style="position:relative; left:-4px; top:-1px;"> Forum</a></li>
        <li><a href="mailto:AnimancerUnityPlugin@gmail.com?subject=Animancer"><img src="/animancer/images/contact.png" height="20" style="position:relative; left:-4px; top:-1px;"> Contact</a></li>
        <li><a href="https://assetstore.unity.com/packages/tools/animation/animancer-lite-116516?aid=1100l8ah5"><img src="/animancer/images/unity-logo.png" height="20" style="position:relative; left:-4px; top:-1px;"> Try</a></li>
        <li><a href="https://assetstore.unity.com/packages/tools/animation/animancer-pro-116514?aid=1100l8ah5"><img src="/animancer/images/unity-logo.png" height="20" style="position:relative; left:-4px; top:-1px;"> Buy</a></li>
        <li><a href="https://kybernetikgames.github.io/kailas-dierk/unity-assets"><img src="/animancer/images/kybernetik.png" height="20" style="position:relative; left:-2px; top:-1px;"> Other Assets</a></li>
 
                        </ul>       
                    </div>
                    <!-- /.navbar-collapse -->
                
                    <!-- Navbar Right Menu -->
                </nav>
            </header>
            
            <!-- Left side column. contains the logo and sidebar -->
            <aside class="main-sidebar ">
                <section class="infobar" data-spy="affix" data-offset-top="60" data-offset-bottom="200"> 
                    	
    <div id="infobar-headings"><h6>On This Page</h6><p><a href="#basic-implementation">Basic Implementation</a></p>
<p><a href="#playing-with-layers">Playing With Layers</a></p>
<p><a href="#avatar-mask">Avatar Mask</a></p>
<p><a href="#layer-changing">Layer Changing</a></p>
<hr class="infobar-hidden">
</div>

                </section>
                <section class="sidebar">    
                                     
                    

                    <ul class="sidebar-menu">
                        

                <li class="treeview">
                    <a href="/animancer/docs/introduction">Introduction</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/introduction/feature-comparison">Feature Comparison</a></li>
                <li class="treeview">
                    <a href="/animancer/docs/introduction/mecanim-vs-animancer">Mecanim vs. Animancer</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/introduction/mecanim-vs-animancer/why-replace-mecanim">Why Replace Mecanim?</a></li>
                <li><a href="/animancer/docs/introduction/mecanim-vs-animancer/playing">Playing</a></li>
                <li><a href="/animancer/docs/introduction/mecanim-vs-animancer/waiting">Waiting</a></li>
                <li><a href="/animancer/docs/introduction/mecanim-vs-animancer/speed-and-time">Speed and Time</a></li>
                <li><a href="/animancer/docs/introduction/mecanim-vs-animancer/weapon-animations">Weapon Animations</a></li>
                <li><a href="/animancer/docs/introduction/mecanim-vs-animancer/performance">Performance</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/docs/introduction/glossary">Glossary</a></li>

                    </ul>
                </li>
                <li class="treeview active">
                    <a href="/animancer/docs/examples">Examples</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li class="treeview">
                    <a href="/animancer/docs/examples/basics">01 Basics</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/basics/basic-scene-setup">Basic Scene Setup</a></li>
                <li><a href="/animancer/docs/examples/basics/simple-playing">01 Simple Playing</a></li>
                <li><a href="/animancer/docs/examples/basics/playing-and-fading">02 Playing and Fading</a></li>
                <li><a href="/animancer/docs/examples/basics/sequence-coroutine">03 Sequence Coroutine</a></li>
                <li><a href="/animancer/docs/examples/basics/named-animations">04 Named Animations</a></li>
                <li><a href="/animancer/docs/examples/basics/hybrid-system">05 Hybrid System</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/fine-control">02 Fine Control</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/fine-control/spider-bot">01 Spider Bot</a></li>
                <li><a href="/animancer/docs/examples/fine-control/doors">02 Doors</a></li>
                <li><a href="/animancer/docs/examples/fine-control/solo-animation">03 Solo Animation</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/locomotion">03 Locomotion</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/locomotion/walk-and-run">01 Walk and Run</a></li>
                <li><a href="/animancer/docs/examples/locomotion/root-motion">02 Root Motion</a></li>
                <li><a href="/animancer/docs/examples/locomotion/linear-blending">03 Linear Blending</a></li>
                <li><a href="/animancer/docs/examples/locomotion/directional-blending">04 Directional Blending</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/directional-sprites">04 Directional Sprites</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/directional-sprites/basic-movement">01 Basic Movement</a></li>
                <li><a href="/animancer/docs/examples/directional-sprites/character-controller">02 Character Controller</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/animation-events">05 Animation Events</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/animation-events/simple-and-end-events">01 Simple and End Events</a></li>
                <li><a href="/animancer/docs/examples/animation-events/other-events">02 Other Events</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/state-machines">06 State Machines</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/state-machines/creatures">01 Creatures</a></li>
                <li><a href="/animancer/docs/examples/state-machines/interrupt-management">02 Interrupt Management</a></li>
                <li><a href="/animancer/docs/examples/state-machines/brains">03 Brains</a></li>
                <li><a href="/animancer/docs/examples/state-machines/more-brains">04 More Brains</a></li>
                <li><a href="/animancer/docs/examples/state-machines/platformer">05 Platformer</a></li>

                    </ul>
                </li>
                <li class="selected"><a href="/animancer/docs/examples/layers">07 Layers</a></li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/inverse-kinematics">08 Inverse Kinematics</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/inverse-kinematics/puppet">01 Puppet</a></li>
                <li><a href="/animancer/docs/examples/inverse-kinematics/uneven-ground">02 Uneven Ground</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/animator-controllers">09 Animator Controllers</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/animator-controllers/hybrid">01 Hybrid</a></li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/animator-controllers/3d-game-kit">02 3D Game Kit</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/problems">Problems with the Original</a></li>
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/respawn">Respawn</a></li>
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/idle">Idle</a></li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/animator-controllers/3d-game-kit/locomotion">Locomotion</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/locomotion/movement">Movement</a></li>
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/locomotion/turning">Turning</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/airborne">Airborne</a></li>
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/landing">Landing</a></li>
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/attack">Attack</a></li>

                    </ul>
                </li>

                    </ul>
                </li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/manual">User Manual</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/manual/playing-animations">Playing Animations</a></li>
                <li><a href="/animancer/docs/manual/states">States</a></li>
                <li><a href="/animancer/docs/manual/inspector">Inspector</a></li>
                <li><a href="/animancer/docs/manual/component-types">Component Types</a></li>
                <li class="treeview">
                    <a href="/animancer/docs/manual/blending">Blending</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/manual/blending/fading">Fading</a></li>
                <li><a href="/animancer/docs/manual/blending/layers">Layers</a></li>
                <li><a href="/animancer/docs/manual/blending/mixers">Mixers</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/docs/manual/finite-state-machines">Finite State Machines</a></li>
                <li><a href="/animancer/docs/manual/state-serializables">State Serializables</a></li>
                <li><a href="/animancer/docs/manual/animator-controllers">Animator Controllers</a></li>
                <li><a href="/animancer/docs/manual/animation-events">Animation Events</a></li>
                <li><a href="/animancer/docs/manual/inverse-kinematics">Inverse Kinematics</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/bugs">Unity Bugs</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/bugs/inconsistent-timing">Inconsistent Timing</a></li>
                <li><a href="/animancer/docs/bugs/paused-skinned-mesh-update">Paused Skinned Mesh Update</a></li>
                <li><a href="/animancer/docs/bugs/resetting-animated-values">Resetting Animated Values</a></li>
                <li><a href="/animancer/docs/bugs/root-motion-interpolation">Root Motion Interpolation</a></li>
                <li><a href="/animancer/docs/bugs/unused-graph-destroy-warning">Unused Graph Destroy Warning</a></li>
                <li><a href="/animancer/docs/bugs/update-modes">Update Modes</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/source">Source Code</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/source/creating-custom-states">Creating Custom States</a></li>
                <li><a href="/animancer/docs/source/graph-structure">Graph Structure</a></li>
                <li><a href="/animancer/docs/source/asset-sources">Asset Sources</a></li>
                <li><a href="/animancer/docs/source/coding-standard">Coding Standard</a></li>
                <li><a href="/animancer/docs/source/default-script-template">Default Script Template</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/changes">Change Log</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/changes/ideas">Ideas</a></li>
                <li><a href="/animancer/docs/changes/animancer-v4-0">Plans for v4.0</a></li>
                <li><a href="/animancer/docs/changes/animancer-v3-1">Animancer v3.1</a></li>
                <li><a href="/animancer/docs/changes/animancer-v3-0">Animancer v3.0</a></li>
                <li><a href="/animancer/docs/changes/animancer-v2-0">Animancer v2.0</a></li>
                <li><a href="/animancer/docs/changes/animancer-v1-3">Animancer v1.3</a></li>
                <li><a href="/animancer/docs/changes/animancer-v1-2">Animancer v1.2</a></li>
                <li><a href="/animancer/docs/changes/animancer-v1-1">Animancer v1.1</a></li>
                <li><a href="/animancer/docs/changes/animancer-v1-0">Animancer v1.0</a></li>

                    </ul>
                </li>

                    </ul>
                            
                </section>                
            </aside>
            
            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                



		<section class="content-header">
			<h1>07 Layers</h1>
		</section>
	<section class="content">
		<blockquote class="blockquote">
<p><strong>Location</strong>: <em>Assets/Plugins/Animancer/Examples/07 Layers</em></p>
<p><strong>Namespace</strong>: <a href="../../../../api/Animancer.Examples.Layers"><code>Animancer.Examples.Layers</code></a></p>
</blockquote>
<p>This example demonstrates how you can use <a href="../../manual/blending/layers">Layers</a> and masks to play multiple animations at the same time on different body parts. If the <em>Action</em> (a tennis swing) is performed while the character is <em>Idle</em>, it is played on the default layer so that it controls the full body. But if it is performed while the <em>Run</em> animation is playing, the <em>Action</em> is played on another layer which is masked to only affect the upper body, so the legs continue running while the upper body acts independantly.</p>
<p><em><a href="https://assetstore.unity.com/packages/tools/animation/animancer-pro-116514?aid=1100l8ah5"><strong>Pro-Only</strong></a> features are used in this example: <a href="../../manual/blending/layers">Layers</a>. Animancer Lite allows you to try out these features in the Unity Editor, but they are not available in runtime builds. See the <a href="../../introduction/feature-comparison">Feature Comparison</a> for more information.</em></p>
<p><img src="layers.gif" class="img-responsive"></p>
<p></p><details><summary>The <code><a href="/animancer/api/Animancer.Examples.Layers/LayerExample">LayerExample</a></code> script looks like this (with the comments removed since we're about to explain how it works):</summary><p>
</p><pre><code class="language-cs">using Animancer;
using UnityEngine;

public sealed class <a href="/animancer/api/Animancer.Examples.Layers/LayerExample">LayerExample</a> : MonoBehaviour
{
    [SerializeField] private <a href="/animancer/api/Animancer/AnimancerComponent">AnimancerComponent</a> _BasicAnimancer;
    [SerializeField] private <a href="/animancer/api/Animancer/AnimancerComponent">AnimancerComponent</a> _LayeredAnimancer;

    [SerializeField] private AnimationClip _Idle;
    [SerializeField] private AnimationClip _Run;
    [SerializeField] private AnimationClip _Action;

    [SerializeField] private AvatarMask _ActionMask;

    private const int BaseLayer = 0;
    private const int ActionLayer = 1;

    private void OnEnable()
    {
        _BasicAnimancer.Play(_Idle);
        _LayeredAnimancer.Play(_Idle);

        _LayeredAnimancer.SetLayerMask(ActionLayer, _ActionMask);
    }

    private bool _IsRunning;

    public void ToggleRunning()
    {
        _IsRunning = !_IsRunning;

        if (_IsRunning)
        {
            _BasicAnimancer.CrossFade(_Run);
            _LayeredAnimancer.CrossFade(_Run);
        }
        else
        {
            _BasicAnimancer.CrossFade(_Idle);
            _LayeredAnimancer.CrossFade(_Idle);
        }
    }

    public void PerformAction()
    {
        var state = _BasicAnimancer.CrossFade(_Action);
        state.OnEnd = () =&gt; _BasicAnimancer.CrossFade(_IsRunning ? _Run : _Idle);

        const float FadeDuration = AnimancerPlayable.DefaultFadeDuration;

        if (_IsRunning)
        {
            state = _LayeredAnimancer.CrossFade(_Action, FadeDuration, ActionLayer);
            state.OnEnd = () =&gt; _LayeredAnimancer.GetLayer(ActionLayer).StartFade(0);
        }
        else
        {
            state = _LayeredAnimancer.CrossFade(_Action, FadeDuration, BaseLayer);
            state.OnEnd = () =&gt; _LayeredAnimancer.CrossFade(_Idle);
        }
    }
}
</code></pre>
<p></p></details><p></p>
<h1 id="basic-implementation">Basic Implementation</h1>
<p>This example consists of characters that can <em>Idle</em>, <em>Run</em>, and perform an <em>Action</em>. Implementing this behaviour using a single-layer is done like many of the earlier examples:</p>
<p>Play the <em>Idle</em> on startup:</p>
<pre><code class="language-cs">private void OnEnable()
{
    _BasicAnimancer.Play(_Idle);
}
</code></pre>
<p>Make a method to switch between <em>Idle</em> and <em>Run</em>, and expose it as <code>public</code> so it can be called by a UI Button:</p>
<pre><code class="language-cs">private bool _IsRunning;

public void ToggleRunning()
{
    _IsRunning = !_IsRunning;

    if (_IsRunning)
    {
        _BasicAnimancer.CrossFade(_Run);
    }
    else
    {
        _BasicAnimancer.CrossFade(_Idle);
    }
}
</code></pre>
<p>And another <code>public</code> method to play the <em>Action</em> then return to whichever animation it was playing before:</p>
<pre><code class="language-cs">public void PerformAction()
{
    var state = _BasicAnimancer.CrossFade(_Action);
    state.OnEnd = () =&gt; _BasicAnimancer.CrossFade(_IsRunning ? _Run : _Idle);
}
</code></pre>
<h1 id="playing-with-layers">Playing With Layers</h1>
<p>For the layered character, we do the exact same things in <code>OnEnable</code> and <code>ToggleRunning</code>, the only difference is in <code>PerformAction</code>:</p>
<ul>
<li>We use the third parameter of <code>CrossFade</code> to specify that we want the <code>_Action</code> animation to play on layer 1. Since the layer was at 0 weight, you can see in the video below that this actually sets the animation's weight to 1 instantly and fades the layer over time instead.</li>
<li>Then when it ends we fade that layer out because we don't have anything else for it to do at the moment.</li>
</ul>
<pre><code class="language-cs">const float FadeDuration = AnimancerPlayable.DefaultFadeDuration;
state = _LayeredAnimancer.CrossFade(_Action, FadeDuration, 1);
state.OnEnd = () =&gt; _LayeredAnimancer.GetLayer(1).StartFade(0);
</code></pre>
<p>This achieves an almost identical result for both characters. The only difference is that the layered character's <em>Idle</em> or <em>Run</em> animation continues playing in the background during the <em>Action</em> so that when it ends we can just fade the layer out instead of needing to figure out which one to go back to.</p>
<p><img src="unmasked.gif" class="img-responsive"></p>
<h1 id="avatar-mask">Avatar Mask</h1>
<p>Layers that simply override each other can be useful, but one of their most powerful features is the ability to use <code>AvatarMask</code>s to determine which body parts each layer affects.</p>
<p><img src="upper-body-mask.png" class="img-responsive img-right"> You can create a mask via the <em>Assets/Create/Avatar Mask</em> menu function. The mask we are using in this example has its <code>Humanoid</code> values set to only include the upper body.</p>
<p>Once we have a mask, we can add a serialized field (to assign it in the Inspector) and assign it to the layer on startup. Since we are now using the layer in more than just a single method, it is a good practice to use a constant to refer to its index instead of using the <code>1</code> literal all the time without any explanation of why we are using that value.</p>
<pre><code class="language-cs">[SerializeField] private AvatarMask _ActionMask;

private const int ActionLayer = 1;

private void OnEnable()
{
    _BasicAnimancer.Play(_Idle);
    _LayeredAnimancer.Play(_Idle);

    _LayeredAnimancer.SetLayerMask(ActionLayer, _ActionMask);
}
</code></pre>
<p>Now we have a character that can perform an action with their upper body while their lower body continues doing whatever it was previously doing.</p>
<p><img src="masked.gif" class="img-responsive"></p>
<p>Note that in the script we are referring to the <code>ActionLayer</code> and <code>_ActionMask</code> instead of calling them <code>UpperBodyLayer</code> and <code>_UpperBodyMask</code>. There is nothing in the script that is actually specific to the "upper body" or even to the particular <code>_Action</code> animation we are using, it could work just as well with any other mask or animation so we use general names just in case we ever want to reuse the script in another situation.</p>
<h1 id="layer-changing">Layer Changing</h1>
<p>The <em>Action</em> animation already has the character standing still, so when the character is <em>Idle</em>, we might want to allow it to affect the whole body instead of only ever the upper body. To do this, we can simply change the layer we want to play it on depending on the current state. This also means that when it ends we need to return to <em>Idle</em> rather than fading the layer out.</p>
<pre><code class="language-cs">private const int BaseLayer = 0;

public void PerformAction()
{
    ...

    const float FadeDuration = AnimancerPlayable.DefaultFadeDuration;

    if (_IsRunning)
    {
        state = _LayeredAnimancer.CrossFade(_Action, FadeDuration, ActionLayer);
        state.OnEnd = () =&gt; _LayeredAnimancer.GetLayer(ActionLayer).StartFade(0);
    }
    else
    {
        state = _LayeredAnimancer.CrossFade(_Action, FadeDuration, BaseLayer);
        state.OnEnd = () =&gt; _LayeredAnimancer.CrossFade(_Idle);
    }
}
</code></pre>
<p>You can also change the layer of an animation at any time by setting its <code><a href="/animancer/api/Animancer/AnimancerState/CE927121">AnimancerState.LayerIndex</a></code>.</p>
<p></p><details><summary>The full <code><a href="/animancer/api/Animancer.Examples.Layers/LayerExample">LayerExample</a></code> script now looks like this:</summary><p>
</p><pre><code class="language-cs">using Animancer;
using UnityEngine;

public sealed class <a href="/animancer/api/Animancer.Examples.Layers/LayerExample">LayerExample</a> : MonoBehaviour
{
    [SerializeField] private <a href="/animancer/api/Animancer/AnimancerComponent">AnimancerComponent</a> _BasicAnimancer;
    [SerializeField] private <a href="/animancer/api/Animancer/AnimancerComponent">AnimancerComponent</a> _LayeredAnimancer;

    [SerializeField] private AnimationClip _Idle;
    [SerializeField] private AnimationClip _Run;
    [SerializeField] private AnimationClip _Action;

    [SerializeField] private AvatarMask _ActionMask;

    private const int BaseLayer = 0;
    private const int ActionLayer = 1;

    private void OnEnable()
    {
        _BasicAnimancer.Play(_Idle);
        _LayeredAnimancer.Play(_Idle);

        _LayeredAnimancer.SetLayerMask(ActionLayer, _ActionMask);
    }

    private bool _IsRunning;

    public void ToggleRunning()
    {
        _IsRunning = !_IsRunning;

        if (_IsRunning)
        {
            _BasicAnimancer.CrossFade(_Run);
            _LayeredAnimancer.CrossFade(_Run);
        }
        else
        {
            _BasicAnimancer.CrossFade(_Idle);
            _LayeredAnimancer.CrossFade(_Idle);
        }
    }

    public void PerformAction()
    {
        var state = _BasicAnimancer.CrossFade(_Action);
        state.OnEnd = () =&gt; _BasicAnimancer.CrossFade(_IsRunning ? _Run : _Idle);

        const float FadeDuration = AnimancerPlayable.DefaultFadeDuration;

        if (_IsRunning)
        {
            state = _LayeredAnimancer.CrossFade(_Action, FadeDuration, ActionLayer);
            state.OnEnd = () =&gt; _LayeredAnimancer.GetLayer(ActionLayer).StartFade(0);
        }
        else
        {
            state = _LayeredAnimancer.CrossFade(_Action, FadeDuration, BaseLayer);
            state.OnEnd = () =&gt; _LayeredAnimancer.CrossFade(_Idle);
        }
    }
}
</code></pre>
<p></p></details><p></p>
<p>So now the character plays the <em>Action</em> animation normally if they were <em>Idle</em> or plays it on the upper body only if they were <em>Running</em>.</p>
<p><img src="layers.gif" class="img-responsive"></p>

	</section>
                
            </div>           
            
            <!-- Footer -->
            <footer class="main-footer">
            </footer>
            
        </div>
        <div class="wrapper bottom-wrapper">
            <footer class="bottom-footer">
                Generated by <a href="https://wyam.io">Wyam</a>
            </footer>
        </div>
        <a href="javascript:" id="return-to-top"><i class="fa fa-chevron-up"></i></a>
        
        <script>           
            // Close the sidebar if we select an anchor link
            $(".main-sidebar a[href^='#']:not('.expand')").click(function(){
                $(document.body).removeClass('sidebar-open');
            });
            
            $(document).ready(function() {
                mermaid.initialize(
                {
                    flowchart:
                    {
                        useMaxWidth: false
                    },
					startOnLoad: false,
					cloneCssStyles: false
                });     
                mermaid.init(undefined, ".mermaid");

                // Remove the max-width setting that Mermaid sets
                var mermaidSvg = $('.mermaid svg');
                mermaidSvg.addClass('img-responsive');
                mermaidSvg.css('max-width', '');

                // Make it scrollable
				var target = document.querySelector(".mermaid svg");
				if(target !== null)
				{
					var panZoom = window.panZoom = svgPanZoom(target, {
						zoomEnabled: true,
						controlIconsEnabled: true,
						fit: true,
						center: true,
                        maxZoom: 20,
                        zoomScaleSensitivity: 0.6
					});			                          

                    // Do the reset once right away to fit the diagram
                    panZoom.resize();
                    panZoom.fit();
                    panZoom.center();
                    
                    $(window).resize(function(){
                        panZoom.resize();
                        panZoom.fit();
                        panZoom.center();
                    });
				}
                
                $('pre code').each(function(i, block) {
                    hljs.highlightBlock(block);
                });  
            });

            hljs.initHighlightingOnLoad();

            // Back to top
            $(window).scroll(function() {
                if ($(this).scrollTop() >= 200) {        // If page is scrolled more than 50px
                    $('#return-to-top').fadeIn(1000);    // Fade in the arrow
                } else {
                    $('#return-to-top').fadeOut(1000);   // Else fade out the arrow
                }
            });
            $('#return-to-top').click(function() {      // When arrow is clicked
                $('body,html').animate({
                    scrollTop : 0                       // Scroll to top of body
                }, 500);
            });
        </script>
    
</body></html>