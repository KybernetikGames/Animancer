<!DOCTYPE html><html><head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
        <meta name="description">
        <meta name="keywords" content="static content generator,static site generator,static site,HTML,web development,.NET,C#,Razor,Markdown,YAML">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="/animancer/assets/img/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/animancer/assets/img/favicon.ico" type="image/x-icon">
        <title>Animancer - Flinch</title>
        <link href="/animancer/assets/css/highlight.css" rel="stylesheet">
        <link href="/animancer/assets/css/bootstrap/bootstrap.css" rel="stylesheet">
        <link href="/animancer/assets/css/adminlte/AdminLTE.css" rel="stylesheet">
        <link href="/animancer/assets/css/theme/theme.css" rel="stylesheet">
        <link href="//fonts.googleapis.com/css?family=Roboto+Mono:400,700|Roboto:400,400i,700,700i" rel="stylesheet">
        <link href="/animancer/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href="/animancer/assets/css/override.css" rel="stylesheet">
        <script src="/animancer/assets/js/jquery-2.2.3.min.js"></script>
        <script src="/animancer/assets/js/bootstrap.min.js"></script>        
        <script src="/animancer/assets/js/app.min.js"></script>         
        <script src="/animancer/assets/js/highlight.pack.js"></script>   
        <script src="/animancer/assets/js/jquery.slimscroll.min.js"></script>
        <script src="/animancer/assets/js/jquery.sticky-kit.min.js"></script>
        <script src="/animancer/assets/js/mermaid.min.js"></script>
        <script src="/animancer/assets/js/svg-pan-zoom.min.js"></script>
        <!--[if lt IE 9]>
        <script src="/animancer/assets/js/html5shiv.min.js"></script>
        <script src="/animancer/assets/js/respond.min.js"></script>
        <![endif]-->  

        
    </head>
    <body class="hold-transition wyam layout-boxed  ">    
        <div class="top-banner"></div>
        <div class="wrapper with-container">
            <!-- Header -->
            <header class="main-header">   
                     
                <a href="/animancer/" class="logo">
                            <span>Animancer</span>
                </a>   
                         
                <nav class="navbar navbar-static-top" role="navigation">
                    <!-- Sidebar toggle button-->
                        <a href="#" class="sidebar-toggle visible-xs-block" data-toggle="offcanvas" role="button">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-right"></i>
                        </a>
                                        
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-down"></i>
                        </button>
                    </div>
            
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                        <ul class="nav navbar-nav">                            
                                    <li><a href="/animancer/docs/download"><img src="/animancer/images/download.png" height="20" style="position:relative; left:-7px; top:-1px;"> Download</a></li>
        <li class="active"><a href="/animancer/docs"><img src="/animancer/images/docs.png" height="20" style="position:relative; left:-5px; top:-1px;"> Docs</a></li>
        <li><a href="/animancer/docs/help"><img src="/animancer/images/help.png" height="20" style="position:relative; left:-4px; top:-1px;"> Help</a></li>
        <li><a href="/animancer/api/Animancer/AnimancerComponent"><img src="/animancer/images/api.png" height="20" style="position:relative; left:-3px; top:-1px;"> API v4.3</a></li>
        <li><a href="https://kybernetik.com.au/kailas-dierk/unity-assets"><img src="/animancer/images/kybernetik.png" height="20" style="position:relative; left:-2px; top:-1px;"> Other Assets</a></li>
 
                        </ul>       
                    </div>
                    <!-- /.navbar-collapse -->
                
                    <!-- Navbar Right Menu -->
                </nav>
            </header>
            
            <!-- Left side column. contains the logo and sidebar -->
            <aside class="main-sidebar ">
                <section class="infobar" data-spy="affix" data-offset-top="60" data-offset-bottom="200"> 
                    	
    <div id="infobar-headings"><h6>On This Page</h6><p><a href="#mecanim">Mecanim</a></p>
<p><a href="#player-controller">Player Controller</a></p>
<p><a href="#blend-tree">Blend Tree</a></p>
<p><a href="#animancer">Animancer</a></p>
<p><a href="#ai">AI</a></p>
<hr class="infobar-hidden">
</div>

                </section>
                <section class="sidebar">    
                                     
                    

                    <ul class="sidebar-menu">
                        

                <li><a href="/animancer/docs/download">Download</a></li>
                <li class="treeview">
                    <a href="/animancer/docs/introduction">Introduction</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/introduction/features">Features</a></li>
                <li class="treeview">
                    <a href="/animancer/docs/introduction/mecanim-vs-animancer">Mecanim vs. Animancer</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/introduction/mecanim-vs-animancer/why">Why Replace Mecanim?</a></li>
                <li><a href="/animancer/docs/introduction/mecanim-vs-animancer/playing">Playing</a></li>
                <li><a href="/animancer/docs/introduction/mecanim-vs-animancer/waiting">Waiting</a></li>
                <li><a href="/animancer/docs/introduction/mecanim-vs-animancer/speed-and-time">Speed and Time</a></li>
                <li><a href="/animancer/docs/introduction/mecanim-vs-animancer/weapon-animations">Weapon Animations</a></li>
                <li><a href="/animancer/docs/introduction/mecanim-vs-animancer/performance">Performance</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/docs/introduction/glossary">Glossary</a></li>
                <li class="treeview">
                    <a href="/animancer/docs/introduction/cs">C# in Unity</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/introduction/cs/overview">Scripting Overview</a></li>
                <li><a href="/animancer/docs/introduction/cs/organisation">Organisation</a></li>
                <li><a href="/animancer/docs/introduction/cs/variables">Variables</a></li>
                <li><a href="/animancer/docs/introduction/cs/methods">Methods</a></li>
                <li><a href="/animancer/docs/introduction/cs/inheritance">Inheritance</a></li>
                <li><a href="/animancer/docs/introduction/cs/vectors">Vectors</a></li>
                <li><a href="/animancer/docs/introduction/cs/other">Other Topics</a></li>

                    </ul>
                </li>

                    </ul>
                </li>
                <li class="treeview active">
                    <a href="/animancer/docs/examples">Examples</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li class="treeview">
                    <a href="/animancer/docs/examples/basics">01 Basics</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/basics/scene-setup">Basic Scene Setup</a></li>
                <li><a href="/animancer/docs/examples/basics/quick-play">01 Quick Play</a></li>
                <li><a href="/animancer/docs/examples/basics/playing-and-fading">02 Playing and Fading</a></li>
                <li><a href="/animancer/docs/examples/basics/sequence-coroutine">03 Sequence Coroutine</a></li>
                <li><a href="/animancer/docs/examples/basics/named-animations">04 Named Animations</a></li>
                <li><a href="/animancer/docs/examples/basics/hybrid">05 Hybrid Basics</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/fine-control">02 Fine Control</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/fine-control/spider-bot">01 Spider Bot</a></li>
                <li><a href="/animancer/docs/examples/fine-control/doors">02 Doors</a></li>
                <li><a href="/animancer/docs/examples/fine-control/solo-animation">03 Solo Animation</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/locomotion">03 Locomotion</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/locomotion/walk-and-run">01 Walk and Run</a></li>
                <li><a href="/animancer/docs/examples/locomotion/root-motion">02 Root Motion</a></li>
                <li><a href="/animancer/docs/examples/locomotion/linear-blending">03 Linear Blending</a></li>
                <li><a href="/animancer/docs/examples/locomotion/directional-blending">04 Directional Blending</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/directional-sprites">04 Directional Sprites</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/directional-sprites/basic-movement">01 Basic Movement</a></li>
                <li><a href="/animancer/docs/examples/directional-sprites/character-controller">02 Character Controller</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/events">05 Events</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/events/footsteps">01 Footstep Events</a></li>
                <li><a href="/animancer/docs/examples/events/golf">02 Golf Events</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/fsm">06 State Machines</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/fsm/creatures">01 Creatures</a></li>
                <li><a href="/animancer/docs/examples/fsm/interrupts">02 Interrupt Management</a></li>
                <li><a href="/animancer/docs/examples/fsm/brains">03 Brains</a></li>
                <li><a href="/animancer/docs/examples/fsm/more-brains">04 More Brains</a></li>
                <li><a href="/animancer/docs/examples/fsm/weapons">05 Weapons</a></li>
                <li><a href="/animancer/docs/examples/fsm/platformer">06 Platformer</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/docs/examples/layers">07 Layers</a></li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/ik">08 Inverse Kinematics</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/ik/puppet">01 Puppet</a></li>
                <li><a href="/animancer/docs/examples/ik/uneven-ground">02 Uneven Ground</a></li>

                    </ul>
                </li>
                <li class="treeview active">
                    <a href="/animancer/docs/examples/animator-controllers">09 Animator Controllers</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/animator-controllers/hybrid">01 Hybrid Mini Game</a></li>
                <li class="treeview active">
                    <a href="/animancer/docs/examples/animator-controllers/3d-game-kit">02 3D Game Kit</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/problems">Problems with the Mecanim Character</a></li>
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/respawn">Respawn</a></li>
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/idle">Idle</a></li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/animator-controllers/3d-game-kit/locomotion">Locomotion</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/locomotion/movement">Movement</a></li>
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/locomotion/turning">Turning</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/airborne">Airborne</a></li>
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/landing">Landing</a></li>
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/attack">Attack</a></li>
                <li class="selected"><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/flinch">Flinch</a></li>
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/die">Die</a></li>

                    </ul>
                </li>

                    </ul>
                </li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/manual">User Manual</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li class="treeview">
                    <a href="/animancer/docs/manual/getting">Getting Animations</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/manual/getting/mixamo">Mixamo</a></li>
                <li><a href="/animancer/docs/manual/getting/importing">Importing</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/manual/playing">Playing Animations</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/manual/playing/states">States</a></li>
                <li><a href="/animancer/docs/manual/playing/inspector">Inspector</a></li>
                <li><a href="/animancer/docs/manual/playing/component-types">Component Types</a></li>
                <li><a href="/animancer/docs/manual/playing/directional-sets">Directional Animation Sets</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/manual/transitions">Transitions</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/manual/transitions/types">Transition Types</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/manual/blending">Blending</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/manual/blending/fading">Fading</a></li>
                <li><a href="/animancer/docs/manual/blending/layers">Layers</a></li>
                <li><a href="/animancer/docs/manual/blending/mixers">Mixers</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/manual/events">Events</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/manual/events/animation">Animation Events</a></li>
                <li><a href="/animancer/docs/manual/events/animancer">Animancer Events</a></li>
                <li><a href="/animancer/docs/manual/events/end">End Events</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/docs/manual/fsm">Finite State Machines</a></li>
                <li><a href="/animancer/docs/manual/animator-controllers">Animator Controllers</a></li>
                <li><a href="/animancer/docs/manual/ik">Inverse Kinematics</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/bugs">Unity Bugs</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/bugs/inconsistent-timing">Inconsistent Timing</a></li>
                <li><a href="/animancer/docs/bugs/paused-skinned-mesh-update">Paused Skinned Mesh Update</a></li>
                <li><a href="/animancer/docs/bugs/update-modes">Update Modes</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/source">Source Code</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/source/dlls">DLLs</a></li>
                <li><a href="/animancer/docs/source/creating-custom-states">Creating Custom States</a></li>
                <li><a href="/animancer/docs/source/graph-structure">Graph Structure</a></li>
                <li><a href="/animancer/docs/source/asset-sources">Asset Sources</a></li>
                <li><a href="/animancer/docs/source/coding-standard">Coding Standard</a></li>
                <li><a href="/animancer/docs/source/default-script-template">Default Script Template</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/changes">Change Log</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/changes/animancer-v4-3">Animancer v4.3</a></li>
                <li><a href="/animancer/docs/changes/animancer-v4-2">Animancer v4.2</a></li>
                <li><a href="/animancer/docs/changes/animancer-v4-1">Animancer v4.1</a></li>
                <li class="treeview">
                    <a href="/animancer/docs/changes/animancer-v4-0">Animancer v4.0</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/changes/animancer-v4-0/test">Test Releases</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/docs/changes/animancer-v3-1">Animancer v3.1</a></li>
                <li><a href="/animancer/docs/changes/animancer-v3-0">Animancer v3.0</a></li>
                <li><a href="/animancer/docs/changes/animancer-v2-0">Animancer v2.0</a></li>
                <li><a href="/animancer/docs/changes/animancer-v1-3">Animancer v1.3</a></li>
                <li><a href="/animancer/docs/changes/animancer-v1-2">Animancer v1.2</a></li>
                <li><a href="/animancer/docs/changes/animancer-v1-1">Animancer v1.1</a></li>
                <li><a href="/animancer/docs/changes/animancer-v1-0">Animancer v1.0</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/docs/help">Help and FAQ</a></li>

                    </ul>
                            
                </section>                
            </aside>
            
            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                



		<section class="content-header">
			<h1>Flinch</h1>
		</section>
	<section class="content">
		<blockquote class="blockquote">
<p>This page is part of the <a href="../">3D Game Kit</a> example.</p>
</blockquote>
<p>Touching an enemy causes the player to flinch away from them and become invulnerable for several seconds:</p>
<p><img src="flinch.gif" class="img-responsive"></p>
<img src="damageable.png" class="img-responsive img-right">
<h1 id="mecanim">Mecanim</h1>
<p>Dealing damage to an object involves a fairly straightforward process:</p>
<ol>
<li>Call <code>target.GetComponent&lt;Damageable&gt;()</code> and if the returned component is null then that object cannot be damaged.</li>
<li>Build a <code>Damageable.DamageMessage</code> containing details such as the amount of damage and the direction it is coming from.</li>
<li>Pass that data into <code>Damageable.ApplyDamage</code>.</li>
</ol>
<p>The player's <code>Damageable</code> component has several events setup in the Inspector (pictured to the right):</p>
<ul>
<li>Update the UI health display when taking damage, dying, or being reset to full health.</li>
<li>Show the blue glowing shield effect after taking damage to indicate that the player is invulnerable.</li>
<li>Hide the shield after the <code>Invulnerability Time</code> passes or if the player's health is reset to full.</li>
</ul>
<p>The main <code>PlayerController</code> implements the <code>IMessageReceiver</code> interface:</p>
<pre><code class="language-cs">public enum MessageType
{
    DAMAGED,
    DEAD,
    RESPAWN,
}

public interface IMessageReceiver
{
    void OnReceiveMessage(MessageType type, object sender, object msg);
}
</code></pre>
<h1 id="player-controller">Player Controller</h1>
<p>This allows it to register itself in the <code>Damageable</code> to receive damage messages as well, allowing it to play the <code>Hurt</code> Blend Tree and set the <code>HurtFromX</code> and <code>HurtFromY</code> parameters to flinch away from whatever direction the damage came from:</p>
<pre><code class="language-cs">protected Damageable m_Damageable;

void OnEnable()
{
    m_Damageable = GetComponent&lt;Damageable&gt;();
    m_Damageable.onDamageMessageReceivers.Add(this);

    m_Damageable.isInvulnerable = true;

    ...
}

void OnDisable()
{
    m_Damageable.onDamageMessageReceivers.Remove(this);

    ...
}

// The Damageable will call this when taking damage.
public void OnReceiveMessage(MessageType type, object sender, object data)
{
    switch (type)
    {
        case MessageType.DAMAGED:
            {
                Damageable.DamageMessage damageData = (Damageable.DamageMessage)data;
                Damaged(damageData);
            }
            break;
        case MessageType.DEAD:
            {
                Damageable.DamageMessage damageData = (Damageable.DamageMessage)data;
                Die(damageData);
            }
            break;
    }
}

readonly int m_HashHurt = Animator.StringToHash("Hurt");

void Damaged(Damageable.DamageMessage damageMessage)
{
    // Set the Hurt parameter of the animator.
    m_Animator.SetTrigger(m_HashHurt);

    // Find the direction of the damage.
    Vector3 forward = damageMessage.damageSource - transform.position;
    forward.y = 0f;

    Vector3 localHurt = transform.InverseTransformDirection(forward);

    // Set the HurtFromX and HurtFromY parameters of the animator based on the direction of the damage.
    m_Animator.SetFloat(m_HashHurtFromX, localHurt.x);
    m_Animator.SetFloat(m_HashHurtFromY, localHurt.z);

    // Shake the camera.
    CameraShake.Shake(CameraShake.k_PlayerHitShakeAmount, CameraShake.k_PlayerHitShakeTime);

    // Play an audio clip of being hurt.
    if (hurtAudioPlayer != null)
    {
        hurtAudioPlayer.PlayRandomClip();
    }
}
</code></pre>
<h1 id="blend-tree">Blend Tree</h1>
<p>The <code>Hurt</code> state is simply a 2D Freeform Cartesian Blend Tree based on the <code>HurtFromX</code> and <code>HurtFromY</code> parameters:</p>
<p><img src="hurt-blend-tree.png" class="img-responsive"></p>
<h1 id="animancer">Animancer</h1>
<p></p><details><summary>The Animancer character has the same <code>Damageable</code> events but also has <code>On Damage Received</code> call <code>FlinchState.OnDamageReceived</code> in the following script, which uses <code>StateMachine.ForceSetState</code> to interrupt any other state and force it to enter this one:</summary><p>
</p><pre><code class="language-cs">using Animancer;
using UnityEngine;

public sealed class <a href="/animancer/api/Animancer.Examples.AnimatorControllers.GameKit/FlinchState">FlinchState</a> : CreatureState
{
    [SerializeField] private <a href="/animancer/api/Animancer/Transition2D">MixerState.Transition2D</a> _Animation;
    [SerializeField] private LayerMask _EnemyLayers;
    [SerializeField] private float _EnemyCheckRadius = 1;

    private void Awake()
    {
        _Animation.Events.Sequence.OnEnd = Creature.ForceEnterIdleState;
    }

    public void OnDamageReceived()
    {
        Creature.StateMachine.ForceSetState(this);
    }

    private void OnEnable()
    {
        <a href="/animancer/api/Animancer.Examples.AnimatorControllers.GameKit/Creature/224320DD">Creature.ForwardSpeed</a> = 0;
        Creature.Animancer.Play(_Animation);

        var direction = DetermineHitDirection();

        _Animation.State.Parameter = new Vector2(
            Vector3.Dot(Creature.Animancer.transform.right, direction),
            Vector3.Dot(Creature.Animancer.transform.forward, direction));
    }

    private Vector3 DetermineHitDirection()
    {
        var position = Creature.transform.position;
        var closestEnemySquaredDistance = float.PositiveInfinity;
        var closestEnemyDirection = Vector3.zero;

        var enemies = Physics.OverlapSphere(position, _EnemyCheckRadius, _EnemyLayers);
        for (int i = 0; i &lt; enemies.Length; i++)
        {
            var direction = enemies[i].transform.position - position;
            var squaredDistance = direction.magnitude;
            if (closestEnemySquaredDistance &gt; squaredDistance)
            {
                closestEnemySquaredDistance = squaredDistance;
                closestEnemyDirection = direction;
            }
        }

        return closestEnemyDirection.normalized;
    }

    public override bool FullMovementControl { get { return false; } }

    public override bool CanExitState(CreatureState nextState)
    {
        return false;
    }
}
</code></pre>
<p></p></details><p></p>
<p>The <code>_Animation</code> field is a <a href="../../../../manual/blending/mixers">Mixer</a> which serves the same purpose as the Mecanim Blend Tree:</p>
<p><img src="flinch-state.png" class="img-responsive"></p>
<p>Unfortunately, the <a href="../problems#script-referencing">Script Referencing</a> issue means that we cannot implement the <code>IMessageReceiver</code> interface to receive the proper hit details to determine which direction it came from, so instead we just use <code>Physics.OverlapSphere</code> to get all the enemies near the player and select the closest one:</p>
<pre><code class="language-cs">[SerializeField] private LayerMask _EnemyLayers;
[SerializeField] private float _EnemyCheckRadius = 1;

private Vector3 DetermineHitDirection()
{
    var position = Creature.transform.position;
    var closestEnemySquaredDistance = float.PositiveInfinity;
    var closestEnemyDirection = Vector3.zero;

    var enemies = Physics.OverlapSphere(position, _EnemyCheckRadius, _EnemyLayers);
    for (int i = 0; i &lt; enemies.Length; i++)
    {
        var direction = enemies[i].transform.position - position;
        var squaredDistance = direction.magnitude;
        if (closestEnemySquaredDistance &gt; squaredDistance)
        {
            closestEnemySquaredDistance = squaredDistance;
            closestEnemyDirection = direction;
        }
    }

    return closestEnemyDirection.normalized;
}
</code></pre>
<p>So when we enter this state we can get that direction and use some <a href="../../../../introduction/cs/vectors#dot-product">Dot Products</a> to determine how much of it lies along the <code>right</code> and <code>forward</code> axes of the character's model:</p>
<pre><code class="language-cs">private void OnEnable()
{
    <a href="/animancer/api/Animancer.Examples.AnimatorControllers.GameKit/Creature/224320DD">Creature.ForwardSpeed</a> = 0;
    Creature.Animancer.Play(_Animation);

    var direction = DetermineHitDirection();

    _Animation.State.Parameter = new Vector2(
        Vector3.Dot(Creature.Animancer.transform.right, direction),
        Vector3.Dot(Creature.Animancer.transform.forward, direction));
}
</code></pre>
<p>We could have used <code>InverseTransformDirection</code> to convert the direction into local space like the Mecanim character did. Both approaches would achieve the same thing and have similar performance costs, so it is simply a matter of choosing which method you find easiest to understand.</p>
<h1 id="ai">AI</h1>
<p>Unfortunately, the enemy AI is too tightly coupled to the <code>PlayerController</code> script for us to be able to get enemies to attack the player so they will simply stand still at all times. So in order to actually demonstrate the ability to take damage from any direction, the example scene has a red capsule that moves back and forth and will damage the player on contact just like an enemy:</p>
<p><img src="damage-dummy.gif" class="img-responsive"></p>

	</section>
                
            </div>           
            
            <!-- Footer -->
            <footer class="main-footer">
            </footer>
            
        </div>
        <div class="wrapper bottom-wrapper">
            <footer class="bottom-footer">
                Generated by <a href="https://wyam.io">Wyam</a>
            </footer>
        </div>
        <a href="javascript:" id="return-to-top"><i class="fa fa-chevron-up"></i></a>
        
        <script>           
            // Close the sidebar if we select an anchor link
            $(".main-sidebar a[href^='#']:not('.expand')").click(function(){
                $(document.body).removeClass('sidebar-open');
            });
            
            $(document).ready(function() {
                mermaid.initialize(
                {
                    flowchart:
                    {
                        useMaxWidth: false
                    },
					startOnLoad: false,
					cloneCssStyles: false
                });     
                mermaid.init(undefined, ".mermaid");

                // Remove the max-width setting that Mermaid sets
                var mermaidSvg = $('.mermaid svg');
                mermaidSvg.addClass('img-responsive');
                mermaidSvg.css('max-width', '');

                // Make it scrollable
				var target = document.querySelector(".mermaid svg");
				if(target !== null)
				{
					var panZoom = window.panZoom = svgPanZoom(target, {
						zoomEnabled: true,
						controlIconsEnabled: true,
						fit: true,
						center: true,
                        maxZoom: 20,
                        zoomScaleSensitivity: 0.6
					});			                          

                    // Do the reset once right away to fit the diagram
                    panZoom.resize();
                    panZoom.fit();
                    panZoom.center();
                    
                    $(window).resize(function(){
                        panZoom.resize();
                        panZoom.fit();
                        panZoom.center();
                    });
				}
                
                $('pre code').each(function(i, block) {
                    hljs.highlightBlock(block);
                });  
            });

            hljs.initHighlightingOnLoad();

            // Back to top
            $(window).scroll(function() {
                if ($(this).scrollTop() >= 200) {        // If page is scrolled more than 50px
                    $('#return-to-top').fadeIn(1000);    // Fade in the arrow
                } else {
                    $('#return-to-top').fadeOut(1000);   // Else fade out the arrow
                }
            });
            $('#return-to-top').click(function() {      // When arrow is clicked
                $('body,html').animate({
                    scrollTop : 0                       // Scroll to top of body
                }, 500);
            });
        </script>
    
</body></html>