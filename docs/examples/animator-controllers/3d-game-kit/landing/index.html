<!DOCTYPE html><html><head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
        <meta name="description">
        <meta name="keywords" content="static content generator,static site generator,static site,HTML,web development,.NET,C#,Razor,Markdown,YAML">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="/animancer/assets/img/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/animancer/assets/img/favicon.ico" type="image/x-icon">
        <title>Animancer - Landing</title>
        <link href="/animancer/assets/css/highlight.css" rel="stylesheet">
        <link href="/animancer/assets/css/bootstrap/bootstrap.css" rel="stylesheet">
        <link href="/animancer/assets/css/adminlte/AdminLTE.css" rel="stylesheet">
        <link href="/animancer/assets/css/theme/theme.css" rel="stylesheet">
        <link href="//fonts.googleapis.com/css?family=Roboto+Mono:400,700|Roboto:400,400i,700,700i" rel="stylesheet">
        <link href="/animancer/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href="/animancer/assets/css/override.css" rel="stylesheet">
        <script src="/animancer/assets/js/jquery-2.2.3.min.js"></script>
        <script src="/animancer/assets/js/bootstrap.min.js"></script>        
        <script src="/animancer/assets/js/app.min.js"></script>         
        <script src="/animancer/assets/js/highlight.pack.js"></script>   
        <script src="/animancer/assets/js/jquery.slimscroll.min.js"></script>
        <script src="/animancer/assets/js/jquery.sticky-kit.min.js"></script>
        <script src="/animancer/assets/js/mermaid.min.js"></script>
        <script src="/animancer/assets/js/svg-pan-zoom.min.js"></script>
        <!--[if lt IE 9]>
        <script src="/animancer/assets/js/html5shiv.min.js"></script>
        <script src="/animancer/assets/js/respond.min.js"></script>
        <![endif]-->  

        
    </head>
    <body class="hold-transition wyam layout-boxed  ">    
        <div class="top-banner"></div>
        <div class="wrapper with-container">
            <!-- Header -->
            <header class="main-header">   
                     
                <a href="/animancer/" class="logo">
                            <span>Animancer</span>
                </a>   
                         
                <nav class="navbar navbar-static-top" role="navigation">
                    <!-- Sidebar toggle button-->
                        <a href="#" class="sidebar-toggle visible-xs-block" data-toggle="offcanvas" role="button">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-right"></i>
                        </a>
                                        
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-down"></i>
                        </button>
                    </div>
            
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                        <ul class="nav navbar-nav">                            
                                    <li class="active"><a href="/animancer/docs"><img src="/animancer/images/docs.png" height="20" style="position:relative; left:-5px; top:-1px;"> Docs</a></li>
        <li><a href="/animancer/faq"><img src="/animancer/images/faq.png" height="20" style="position:relative; left:-4px; top:-1px;"> FAQ</a></li>
        <li><a href="/animancer/api/Animancer/AnimancerComponent"><img src="/animancer/images/api.png" height="20" style="position:relative; left:-3px; top:-1px;"> API v3.1</a></li>
        <li><a href="https://forum.unity.com/threads/566452"><img src="/animancer/images/forum.png" height="20" style="position:relative; left:-4px; top:-1px;"> Forum</a></li>
        <li><a href="mailto:AnimancerUnityPlugin@gmail.com?subject=Animancer"><img src="/animancer/images/contact.png" height="20" style="position:relative; left:-4px; top:-1px;"> Contact</a></li>
        <li><a href="/animancer/lite"><img src="/animancer/images/unity-logo.png" height="20" style="position:relative; left:-4px; top:-1px;"> Try</a></li>
        <li><a href="/animancer/pro"><img src="/animancer/images/unity-logo.png" height="20" style="position:relative; left:-4px; top:-1px;"> Buy</a></li>
        <li><a href="https://kybernetik.com.au/kailas-dierk/unity-assets"><img src="/animancer/images/kybernetik.png" height="20" style="position:relative; left:-2px; top:-1px;"> Other Assets</a></li>
 
                        </ul>       
                    </div>
                    <!-- /.navbar-collapse -->
                
                    <!-- Navbar Right Menu -->
                </nav>
            </header>
            
            <!-- Left side column. contains the logo and sidebar -->
            <aside class="main-sidebar ">
                <section class="infobar" data-spy="affix" data-offset-top="60" data-offset-bottom="200"> 
                    	
    <div id="infobar-headings"><h6>On This Page</h6><p><a href="#original">Original</a></p>
<p><a href="#animancer">Animancer</a></p>
<p><a href="#state-entry">State Entry</a></p>
<p><a href="#updates">Updates</a></p>
<hr class="infobar-hidden">
</div>

                </section>
                <section class="sidebar">    
                                     
                    

                    <ul class="sidebar-menu">
                        

                <li class="treeview">
                    <a href="/animancer/docs/introduction">Introduction</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/introduction/feature-comparison">Feature Comparison</a></li>
                <li class="treeview">
                    <a href="/animancer/docs/introduction/mecanim-vs-animancer">Mecanim vs. Animancer</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/introduction/mecanim-vs-animancer/why-replace-mecanim">Why Replace Mecanim?</a></li>
                <li><a href="/animancer/docs/introduction/mecanim-vs-animancer/playing">Playing</a></li>
                <li><a href="/animancer/docs/introduction/mecanim-vs-animancer/waiting">Waiting</a></li>
                <li><a href="/animancer/docs/introduction/mecanim-vs-animancer/speed-and-time">Speed and Time</a></li>
                <li><a href="/animancer/docs/introduction/mecanim-vs-animancer/weapon-animations">Weapon Animations</a></li>
                <li><a href="/animancer/docs/introduction/mecanim-vs-animancer/performance">Performance</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/docs/introduction/glossary">Glossary</a></li>

                    </ul>
                </li>
                <li class="treeview active">
                    <a href="/animancer/docs/examples">Examples</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li class="treeview">
                    <a href="/animancer/docs/examples/basics">01 Basics</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/basics/basic-scene-setup">Basic Scene Setup</a></li>
                <li><a href="/animancer/docs/examples/basics/simple-playing">01 Simple Playing</a></li>
                <li><a href="/animancer/docs/examples/basics/playing-and-fading">02 Playing and Fading</a></li>
                <li><a href="/animancer/docs/examples/basics/sequence-coroutine">03 Sequence Coroutine</a></li>
                <li><a href="/animancer/docs/examples/basics/named-animations">04 Named Animations</a></li>
                <li><a href="/animancer/docs/examples/basics/hybrid-system">05 Hybrid System</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/fine-control">02 Fine Control</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/fine-control/spider-bot">01 Spider Bot</a></li>
                <li><a href="/animancer/docs/examples/fine-control/doors">02 Doors</a></li>
                <li><a href="/animancer/docs/examples/fine-control/solo-animation">03 Solo Animation</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/locomotion">03 Locomotion</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/locomotion/walk-and-run">01 Walk and Run</a></li>
                <li><a href="/animancer/docs/examples/locomotion/root-motion">02 Root Motion</a></li>
                <li><a href="/animancer/docs/examples/locomotion/linear-blending">03 Linear Blending</a></li>
                <li><a href="/animancer/docs/examples/locomotion/directional-blending">04 Directional Blending</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/directional-sprites">04 Directional Sprites</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/directional-sprites/basic-movement">01 Basic Movement</a></li>
                <li><a href="/animancer/docs/examples/directional-sprites/character-controller">02 Character Controller</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/animation-events">05 Animation Events</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/animation-events/simple-and-end-events">01 Simple and End Events</a></li>
                <li><a href="/animancer/docs/examples/animation-events/other-events">02 Other Events</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/state-machines">06 State Machines</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/state-machines/creatures">01 Creatures</a></li>
                <li><a href="/animancer/docs/examples/state-machines/interrupt-management">02 Interrupt Management</a></li>
                <li><a href="/animancer/docs/examples/state-machines/brains">03 Brains</a></li>
                <li><a href="/animancer/docs/examples/state-machines/more-brains">04 More Brains</a></li>
                <li><a href="/animancer/docs/examples/state-machines/platformer">05 Platformer</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/docs/examples/layers">07 Layers</a></li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/inverse-kinematics">08 Inverse Kinematics</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/inverse-kinematics/puppet">01 Puppet</a></li>
                <li><a href="/animancer/docs/examples/inverse-kinematics/uneven-ground">02 Uneven Ground</a></li>

                    </ul>
                </li>
                <li class="treeview active">
                    <a href="/animancer/docs/examples/animator-controllers">09 Animator Controllers</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/animator-controllers/hybrid">01 Hybrid</a></li>
                <li class="treeview active">
                    <a href="/animancer/docs/examples/animator-controllers/3d-game-kit">02 3D Game Kit</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/problems">Problems with the Original</a></li>
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/respawn">Respawn</a></li>
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/idle">Idle</a></li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/animator-controllers/3d-game-kit/locomotion">Locomotion</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/locomotion/movement">Movement</a></li>
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/locomotion/turning">Turning</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/airborne">Airborne</a></li>
                <li class="selected"><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/landing">Landing</a></li>
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/attack">Attack</a></li>

                    </ul>
                </li>

                    </ul>
                </li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/manual">User Manual</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/manual/playing-animations">Playing Animations</a></li>
                <li><a href="/animancer/docs/manual/states">States</a></li>
                <li><a href="/animancer/docs/manual/inspector">Inspector</a></li>
                <li><a href="/animancer/docs/manual/component-types">Component Types</a></li>
                <li class="treeview">
                    <a href="/animancer/docs/manual/blending">Blending</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/manual/blending/fading">Fading</a></li>
                <li><a href="/animancer/docs/manual/blending/layers">Layers</a></li>
                <li><a href="/animancer/docs/manual/blending/mixers">Mixers</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/docs/manual/finite-state-machines">Finite State Machines</a></li>
                <li><a href="/animancer/docs/manual/state-serializables">State Serializables</a></li>
                <li><a href="/animancer/docs/manual/animator-controllers">Animator Controllers</a></li>
                <li><a href="/animancer/docs/manual/animation-events">Animation Events</a></li>
                <li><a href="/animancer/docs/manual/inverse-kinematics">Inverse Kinematics</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/bugs">Unity Bugs</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/bugs/inconsistent-timing">Inconsistent Timing</a></li>
                <li><a href="/animancer/docs/bugs/paused-skinned-mesh-update">Paused Skinned Mesh Update</a></li>
                <li><a href="/animancer/docs/bugs/resetting-animated-values">Resetting Animated Values</a></li>
                <li><a href="/animancer/docs/bugs/root-motion-interpolation">Root Motion Interpolation</a></li>
                <li><a href="/animancer/docs/bugs/unused-graph-destroy-warning">Unused Graph Destroy Warning</a></li>
                <li><a href="/animancer/docs/bugs/update-modes">Update Modes</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/source">Source Code</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/source/creating-custom-states">Creating Custom States</a></li>
                <li><a href="/animancer/docs/source/graph-structure">Graph Structure</a></li>
                <li><a href="/animancer/docs/source/asset-sources">Asset Sources</a></li>
                <li><a href="/animancer/docs/source/coding-standard">Coding Standard</a></li>
                <li><a href="/animancer/docs/source/default-script-template">Default Script Template</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/changes">Change Log</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/changes/ideas">Ideas</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v4-0">Progress of v4.0</a></li>
                <li><a href="/animancer/docs/changes/animancer-v3-1">Animancer v3.1</a></li>
                <li><a href="/animancer/docs/changes/animancer-v3-0">Animancer v3.0</a></li>
                <li><a href="/animancer/docs/changes/animancer-v2-0">Animancer v2.0</a></li>
                <li><a href="/animancer/docs/changes/animancer-v1-3">Animancer v1.3</a></li>
                <li><a href="/animancer/docs/changes/animancer-v1-2">Animancer v1.2</a></li>
                <li><a href="/animancer/docs/changes/animancer-v1-1">Animancer v1.1</a></li>
                <li><a href="/animancer/docs/changes/animancer-v1-0">Animancer v1.0</a></li>

                    </ul>
                </li>

                    </ul>
                            
                </section>                
            </aside>
            
            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                



		<section class="content-header">
			<h1>Landing</h1>
		</section>
	<section class="content">
		<blockquote class="blockquote">
<p>This page is part of the <a href="../">3D Game Kit</a> example.</p>
</blockquote>
<p>The character has several different animations to play when you land on the ground which it blends between based on your horizontal and vertical speeds.</p>
<p>The vertical speed difference essentially determines how long the landing animation takes:</p>
<p><img src="stop-landing.gif" class="img-responsive"></p>
<p>While the horizontal speed difference affects the movement of the hands and when both speeds are fast enough it uses an entirely different animation to have the character roll instead:</p>
<p><img src="move-landing.gif" class="img-responsive"></p>
<h1 id="original">Original</h1>
<p>The original character's <code>LandingSM</code> state is a <a href="https://docs.unity3d.com/Manual/NestedStateMachines.html">Sub State Machine</a>:</p>
<p><img src="landing-sub-state.png" class="img-responsive"></p>
<p><code>EllenRunForwardLandingFast</code> is a regular state which plays the <em>Roll</em> animation when the speeds are fast enough while the <code>Landing</code> state is a Blend Tree:</p>
<p><img src="landing-blend-tree.png" class="img-responsive"></p>
<p>The logic for this state is <em>almost</em> entirely managed within the Animator Controller by the transitions and Blend Tree based on the speed parameters that have already been set for the <a href="../locomotion">Locomotion</a> and <a href="../airborne">Airborne</a> states, with a few exceptions in the <code>PlayerController</code> script:</p>
<ul>
<li><code>IsOrientationUpdated</code> checks if the Animator Controller is in the <code>Landing</code> state to allow scripted turning. This means that simply looking at the Animator Controller will not tell you that the player is able to turn normally during the <code>Landing</code> state but not during the <code>EllenRunForwardLandingFast</code> state.</li>
<li><code>PlayAudio</code> checks if the character just landed in order to play sounds.</li>
<li><code>OnAnimatorMove</code> makes sure the character isn't grounded before telling the Animator Controller the new vertical speed so it can blend correctly based on the impact speed. Otherwise the actual vertical speed while grounded is always a constant value which the Blend Tree doesn't need to know about.</li>
</ul>
<h1 id="animancer">Animancer</h1>
<p></p><details><summary>With Animancer, all the above logic is defined by the <code><a href="/animancer/api/Animancer.Examples.AnimatorControllers.GameKit/LandingState">LandingState</a></code> script. As usual, this means less configuration in the Unity Editor in exchange for more code and it is significantly easier to understand the logic:</summary><p>
</p><pre><code class="language-cs">using Animancer;
using Animancer.FSM;
using System;
using UnityEngine;

public sealed class <a href="/animancer/api/Animancer.Examples.AnimatorControllers.GameKit/LandingState">LandingState</a> : CreatureState
{
    [SerializeField] private <a href="/animancer/api/Animancer/Serializable">Vector2ControllerState.Serializable</a> _SoftLanding;
    [SerializeField] private <a href="/animancer/api/Animancer/Serializable">ClipState.Serializable</a> _HardLanding;
    [SerializeField] private float _HardLandingForwardSpeed = 5;
    [SerializeField] private float _HardLandingVerticalSpeed = -10;
    [SerializeField] private float _ExitNormalizedTime = 0.75f;
    [SerializeField] private <a href="/animancer/api/Animancer.Examples.AnimatorControllers.GameKit/RandomAudioPlayer">RandomAudioPlayer</a> _ImpactAudio;
    [SerializeField] private <a href="/animancer/api/Animancer.Examples.AnimatorControllers.GameKit/RandomAudioPlayer">RandomAudioPlayer</a> _EmoteAudio;

    private bool _IsHardLanding;

    public override bool CanEnterState(CreatureState previousState)
    {
        return Creature.CharacterController.isGrounded;
    }

    private void OnEnable()
    {
        <a href="/animancer/api/Animancer.Examples.AnimatorControllers.GameKit/Creature/224320DD">Creature.ForwardSpeed</a> = Creature.DesiredForwardSpeed;

        if (Creature.VerticalSpeed &lt;= _HardLandingVerticalSpeed &amp;&amp;
            <a href="/animancer/api/Animancer.Examples.AnimatorControllers.GameKit/Creature/224320DD">Creature.ForwardSpeed</a> &gt;= _HardLandingForwardSpeed)
        {
            _IsHardLanding = true;
            Animancer.Transition(_HardLanding);
        }
        else
        {
            _IsHardLanding = false;
            Animancer.Transition(_SoftLanding);
            _SoftLanding.State.Parameter = new Vector2(Creature.ForwardSpeed, Creature.VerticalSpeed);
        }

        _ImpactAudio.PlayRandomClip(Creature.GroundMaterial, bankId: <a href="/animancer/api/Animancer.Examples.AnimatorControllers.GameKit/Creature/224320DD">Creature.ForwardSpeed</a> &lt; 4 ? 0 : 1);
        _EmoteAudio.PlayRandomClip();
    }

    public override bool FullMovementControl { get { return !_IsHardLanding; } }

    private void FixedUpdate()
    {
        if (!Creature.CharacterController.isGrounded &amp;&amp;
            Creature.StateMachine.TrySetState(Creature.Airborne))
            return;

        Creature.UpdateSpeedControl();

        float normalizedTime;
        if (_IsHardLanding)
        {
            normalizedTime = _HardLanding.State.NormalizedTime;
        }
        else
        {
            normalizedTime = _SoftLanding.State.Playable.GetCurrentAnimatorStateInfo(0).normalizedTime;
            _SoftLanding.State.ParameterX = Creature.ForwardSpeed;
        }

        if (normalizedTime &gt;= _ExitNormalizedTime)
            Creature.CheckMotionState();
    }
}
</code></pre>
<p></p></details><p></p>
<p>We start with some serialized fields to show in the Inspector:</p>
<pre><code class="language-cs">[SerializeField] private <a href="/animancer/api/Animancer/Serializable">Vector2ControllerState.Serializable</a> _SoftLanding;
[SerializeField] private <a href="/animancer/api/Animancer/Serializable">ClipState.Serializable</a> _HardLanding;
[SerializeField] private float _HardLandingForwardSpeed = 5;
[SerializeField] private float _HardLandingVerticalSpeed = -10;
[SerializeField] private float _LandingExitNormalizedTime = 0.75f;
[SerializeField] private <a href="/animancer/api/Animancer.Examples.AnimatorControllers.GameKit/RandomAudioPlayer">RandomAudioPlayer</a> _ImpactAudio;
[SerializeField] private <a href="/animancer/api/Animancer.Examples.AnimatorControllers.GameKit/RandomAudioPlayer">RandomAudioPlayer</a> _EmoteAudio;

private bool _IsHardLanding;
</code></pre>
<p>Much like the <a href="../locomotion">Locomotion</a> state, we are using a <code><a href="/animancer/api/Animancer/ControllerState">ControllerState</a></code> to play an Animator Controller containing the same Blend Tree the original character used, except that this time we are using a <code><a href="/animancer/api/Animancer/Vector2ControllerState">Vector2ControllerState</a></code> instead of a <code><a href="/animancer/api/Animancer/FloatControllerState">FloatControllerState</a></code> because we have two parameters to control (horizontal and vertical speed).</p>
<p>As was explained in the <a href="../airborne#update">Airborne</a> state, we override this state's <code>CanEnterState</code> to only allow it to be entered when the <code>CharacterController</code> is on the ground:</p>
<pre><code class="language-cs">public override bool CanEnterState(CreatureState previousState)
{
    return Creature.CharacterController.isGrounded;
}
</code></pre>
<h1 id="state-entry">State Entry</h1>
<p>The original character was implemented such that if you were <em>Airborne</em> at full speed and tried to stop moving right before landing then you would still move forward a bit after touching the ground, which made it harder to control precisely. So instead, the first thing we do when entering this state is snap the <code><a href="/animancer/api/Animancer.Examples.AnimatorControllers.GameKit/Creature/224320DD">Creature.ForwardSpeed</a></code> to be exactly the speed you are trying to move:</p>
<pre><code class="language-cs">private void OnEnable()
{
    <a href="/animancer/api/Animancer.Examples.AnimatorControllers.GameKit/Creature/224320DD">Creature.ForwardSpeed</a> = Creature.DesiredForwardSpeed;
</code></pre>
<p>Then we check the speeds to determine whether to use the <code>_HardLanding</code> animation or the <code>_SoftLanding</code> Blend Tree. Note that the <code>VerticalSpeed</code> uses <code>&lt;=</code> because we are dealing with downward speeds so a more negative value means falling faster:</p>
<pre><code class="language-cs">    if (Creature.VerticalSpeed &lt;= _HardLandingVerticalSpeed &amp;&amp;
        <a href="/animancer/api/Animancer.Examples.AnimatorControllers.GameKit/Creature/224320DD">Creature.ForwardSpeed</a> &gt;= _HardLandingForwardSpeed)
    {
        _IsHardLanding = true;
        Animancer.Transition(_HardLanding);
    }
    else
    {
        _IsHardLanding = false;
        Animancer.Transition(_SoftLanding);
</code></pre>
<p>When using the <code>_SoftLanding</code>, we also set the Blend Tree parameters:</p>
<pre><code class="language-cs">        _SoftLanding.State.Parameter = new Vector2(Creature.ForwardSpeed, Creature.VerticalSpeed);
    }
</code></pre>
<p>And finally, we play some sounds:</p>
<ul>
<li><code>_ImpactAudio</code> is the physical impact with the ground which is based on the material of the ground and also has different sounds when moving quickly.</li>
<li><code>_EmoteAudio</code> is the character's vocal grunt.</li>
<li>The forward speed threshold should really be an Inspector field somewhere, but audio is not a focus of this example so we just used the same line as the original character.</li>
</ul>
<pre><code class="language-cs">    _ImpactAudio.PlayRandomClip(Creature.GroundMaterial, bankId: <a href="/animancer/api/Animancer.Examples.AnimatorControllers.GameKit/Creature/224320DD">Creature.ForwardSpeed</a> &lt; 4 ? 0 : 1);
    _EmoteAudio.PlayRandomClip();
}
</code></pre>
<h1 id="updates">Updates</h1>
<p>We override the <code>FullMovementControl</code> property so that the soft landing will give the player full control over their movements while the hard landing will use the raw root motion from the <em>Roll</em> animation instead. See the <a href="../locomotion#full-movement-control">Locomotion</a> page for more details.</p>
<pre><code class="language-cs">public override bool FullMovementControl { get { return !_IsHardLanding; } }
</code></pre>
<p>In the <code>FixedUpdate</code> method we start by checking if the character has left the ground, in which case it needs to be <a href="../airborne">Airborne</a> again:</p>
<pre><code class="language-cs">private void FixedUpdate()
{
    if (!Creature.CharacterController.isGrounded &amp;&amp;
        Creature.StateMachine.TrySetState(Creature.Airborne))
        return;
</code></pre>
<p>Then we update the <code>Creature</code>'s control over its speed as explained on the <a href="../idle#update-speed-control">Idle</a> page:</p>
<pre><code class="language-cs">    Creature.UpdateSpeedControl();
</code></pre>
<p>We want to exit this state and start transitioning to the next animation before the <em>Landing</em> animation actually finishes, so we have a <code>_ExitNormalizedTime</code> field in the Inspector which we check against the <code>normalizedTime</code> of the current animation every frame.</p>
<p>Since the hard landing uses a single animation, we can get its time directly from the <code><a href="/animancer/api/Animancer/AnimancerState">AnimancerState</a></code>:</p>
<pre><code class="language-cs">    float normalizedTime;
    if (_IsHardLanding)
    {
        normalizedTime = _HardLanding.State.NormalizedTime;
    }
</code></pre>
<p>But since the soft landing uses an Animator Controller, we need to get the time from its internal state:</p>
<pre><code class="language-cs">    else
    {
        normalizedTime = _SoftLanding.State.Playable.GetCurrentAnimatorStateInfo(0).normalizedTime;
</code></pre>
<p>We can also take this opportunity to let the Animator Controller know about the character's new forward speed. Like with the original, we don't want to inform it of any changes to the vertical speed because we want it to continue based on the vertical speed it had on impact when first entering this state:</p>
<pre><code class="language-cs">        _SoftLanding.State.ParameterX = Creature.ForwardSpeed;
    }
</code></pre>
<p>And now that we have the <code>normalizedTime</code> of the current state, we can check if it has passed the <code>_ExitNormalizedTime</code> in order to check the regular transitions as explained on the <a href="../idle#check-motion-state">Idle</a> page, which will go to either <em>Idle</em> or <em>Locomotion</em>, but not <em>Airborne</em> (because we already checked that at the start of <code>FixedUpdate</code>):</p>
<pre><code class="language-cs">    if (normalizedTime &gt;= _ExitNormalizedTime)
        Creature.CheckMotionState();
}
</code></pre>

	</section>
                
            </div>           
            
            <!-- Footer -->
            <footer class="main-footer">
            </footer>
            
        </div>
        <div class="wrapper bottom-wrapper">
            <footer class="bottom-footer">
                Generated by <a href="https://wyam.io">Wyam</a>
            </footer>
        </div>
        <a href="javascript:" id="return-to-top"><i class="fa fa-chevron-up"></i></a>
        
        <script>           
            // Close the sidebar if we select an anchor link
            $(".main-sidebar a[href^='#']:not('.expand')").click(function(){
                $(document.body).removeClass('sidebar-open');
            });
            
            $(document).ready(function() {
                mermaid.initialize(
                {
                    flowchart:
                    {
                        useMaxWidth: false
                    },
					startOnLoad: false,
					cloneCssStyles: false
                });     
                mermaid.init(undefined, ".mermaid");

                // Remove the max-width setting that Mermaid sets
                var mermaidSvg = $('.mermaid svg');
                mermaidSvg.addClass('img-responsive');
                mermaidSvg.css('max-width', '');

                // Make it scrollable
				var target = document.querySelector(".mermaid svg");
				if(target !== null)
				{
					var panZoom = window.panZoom = svgPanZoom(target, {
						zoomEnabled: true,
						controlIconsEnabled: true,
						fit: true,
						center: true,
                        maxZoom: 20,
                        zoomScaleSensitivity: 0.6
					});			                          

                    // Do the reset once right away to fit the diagram
                    panZoom.resize();
                    panZoom.fit();
                    panZoom.center();
                    
                    $(window).resize(function(){
                        panZoom.resize();
                        panZoom.fit();
                        panZoom.center();
                    });
				}
                
                $('pre code').each(function(i, block) {
                    hljs.highlightBlock(block);
                });  
            });

            hljs.initHighlightingOnLoad();

            // Back to top
            $(window).scroll(function() {
                if ($(this).scrollTop() >= 200) {        // If page is scrolled more than 50px
                    $('#return-to-top').fadeIn(1000);    // Fade in the arrow
                } else {
                    $('#return-to-top').fadeOut(1000);   // Else fade out the arrow
                }
            });
            $('#return-to-top').click(function() {      // When arrow is clicked
                $('body,html').animate({
                    scrollTop : 0                       // Scroll to top of body
                }, 500);
            });
        </script>
    
</body></html>