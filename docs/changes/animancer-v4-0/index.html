<!DOCTYPE html><html><head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
        <meta name="description">
        <meta name="keywords" content="static content generator,static site generator,static site,HTML,web development,.NET,C#,Razor,Markdown,YAML">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="/animancer/assets/img/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/animancer/assets/img/favicon.ico" type="image/x-icon">
        <title>Animancer - Progress of v4.0</title>
        <link href="/animancer/assets/css/highlight.css" rel="stylesheet">
        <link href="/animancer/assets/css/bootstrap/bootstrap.css" rel="stylesheet">
        <link href="/animancer/assets/css/adminlte/AdminLTE.css" rel="stylesheet">
        <link href="/animancer/assets/css/theme/theme.css" rel="stylesheet">
        <link href="//fonts.googleapis.com/css?family=Roboto+Mono:400,700|Roboto:400,400i,700,700i" rel="stylesheet">
        <link href="/animancer/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href="/animancer/assets/css/override.css" rel="stylesheet">
        <script src="/animancer/assets/js/jquery-2.2.3.min.js"></script>
        <script src="/animancer/assets/js/bootstrap.min.js"></script>        
        <script src="/animancer/assets/js/app.min.js"></script>         
        <script src="/animancer/assets/js/highlight.pack.js"></script>   
        <script src="/animancer/assets/js/jquery.slimscroll.min.js"></script>
        <script src="/animancer/assets/js/jquery.sticky-kit.min.js"></script>
        <script src="/animancer/assets/js/mermaid.min.js"></script>
        <script src="/animancer/assets/js/svg-pan-zoom.min.js"></script>
        <!--[if lt IE 9]>
        <script src="/animancer/assets/js/html5shiv.min.js"></script>
        <script src="/animancer/assets/js/respond.min.js"></script>
        <![endif]-->  

        
    </head>
    <body class="hold-transition wyam layout-boxed  ">    
        <div class="top-banner"></div>
        <div class="wrapper with-container">
            <!-- Header -->
            <header class="main-header">   
                     
                <a href="/animancer/" class="logo">
                            <span>Animancer</span>
                </a>   
                         
                <nav class="navbar navbar-static-top" role="navigation">
                    <!-- Sidebar toggle button-->
                        <a href="#" class="sidebar-toggle visible-xs-block" data-toggle="offcanvas" role="button">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-right"></i>
                        </a>
                                        
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-down"></i>
                        </button>
                    </div>
            
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                        <ul class="nav navbar-nav">                            
                                    <li class="active"><a href="/animancer/docs"><img src="/animancer/images/docs.png" height="20" style="position:relative; left:-5px; top:-1px;"> Docs</a></li>
        <li><a href="/animancer/faq"><img src="/animancer/images/faq.png" height="20" style="position:relative; left:-4px; top:-1px;"> FAQ</a></li>
        <li><a href="/animancer/api/Animancer/AnimancerComponent"><img src="/animancer/images/api.png" height="20" style="position:relative; left:-3px; top:-1px;"> API v3.1</a></li>
        <li><a href="/animancer/forum"><img src="/animancer/images/forum.png" height="20" style="position:relative; left:-4px; top:-1px;"> Forum</a></li>
        <li><a href="mailto:AnimancerUnityPlugin@gmail.com?subject=Animancer"><img src="/animancer/images/contact.png" height="20" style="position:relative; left:-4px; top:-1px;"> Contact</a></li>
        <li><a href="/animancer/lite"><img src="/animancer/images/unity-logo.png" height="20" style="position:relative; left:-4px; top:-1px;"> Try</a></li>
        <li><a href="/animancer/pro"><img src="/animancer/images/unity-logo.png" height="20" style="position:relative; left:-4px; top:-1px;"> Buy</a></li>
        <li><a href="https://kybernetikgames.github.io/kailas-dierk/unity-assets"><img src="/animancer/images/kybernetik.png" height="20" style="position:relative; left:-2px; top:-1px;"> Other Assets</a></li>
 
                        </ul>       
                    </div>
                    <!-- /.navbar-collapse -->
                
                    <!-- Navbar Right Menu -->
                </nav>
            </header>
            
            <!-- Left side column. contains the logo and sidebar -->
            <aside class="main-sidebar ">
                <section class="infobar" data-spy="affix" data-offset-top="60" data-offset-bottom="200"> 
                    	
    <div id="infobar-headings"><h6>On This Page</h6><p><a href="#highlights">Highlights</a></p>
<p><a href="#upgrade-guide">Upgrade Guide</a></p>
<p><a href="#features">Features</a></p>
<p><a href="#changes">Changes</a></p>
<p><a href="#improvements">Improvements</a></p>
<p><a href="#fixes">Fixes</a></p>
<p><a href="#examples">Examples</a></p>
<p><a href="#internal">Internal</a></p>
<hr class="infobar-hidden">
</div>

                </section>
                <section class="sidebar">    
                                     
                    

                    <ul class="sidebar-menu">
                        

                <li class="treeview">
                    <a href="/animancer/docs/introduction">Introduction</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li class="treeview">
                    <a href="/animancer/docs/introduction/mecanim-vs-animancer">Mecanim vs. Animancer</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/introduction/mecanim-vs-animancer/why-replace-mecanim">Why Replace Mecanim?</a></li>
                <li><a href="/animancer/docs/introduction/mecanim-vs-animancer/playing">Playing</a></li>
                <li><a href="/animancer/docs/introduction/mecanim-vs-animancer/waiting">Waiting</a></li>
                <li><a href="/animancer/docs/introduction/mecanim-vs-animancer/speed-and-time">Speed and Time</a></li>
                <li><a href="/animancer/docs/introduction/mecanim-vs-animancer/weapon-animations">Weapon Animations</a></li>
                <li><a href="/animancer/docs/introduction/mecanim-vs-animancer/performance">Performance</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/docs/introduction/features">Features</a></li>
                <li><a href="/animancer/docs/introduction/glossary">Glossary</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/examples">Examples</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li class="treeview">
                    <a href="/animancer/docs/examples/basics">01 Basics</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/basics/basic-scene-setup">Basic Scene Setup</a></li>
                <li><a href="/animancer/docs/examples/basics/simple-playing">01 Simple Playing</a></li>
                <li><a href="/animancer/docs/examples/basics/playing-and-fading">02 Playing and Fading</a></li>
                <li><a href="/animancer/docs/examples/basics/sequence-coroutine">03 Sequence Coroutine</a></li>
                <li><a href="/animancer/docs/examples/basics/named-animations">04 Named Animations</a></li>
                <li><a href="/animancer/docs/examples/basics/hybrid-system">05 Hybrid System</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/fine-control">02 Fine Control</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/fine-control/spider-bot">01 Spider Bot</a></li>
                <li><a href="/animancer/docs/examples/fine-control/doors">02 Doors</a></li>
                <li><a href="/animancer/docs/examples/fine-control/solo-animation">03 Solo Animation</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/locomotion">03 Locomotion</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/locomotion/walk-and-run">01 Walk and Run</a></li>
                <li><a href="/animancer/docs/examples/locomotion/root-motion">02 Root Motion</a></li>
                <li><a href="/animancer/docs/examples/locomotion/linear-blending">03 Linear Blending</a></li>
                <li><a href="/animancer/docs/examples/locomotion/directional-blending">04 Directional Blending</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/directional-sprites">04 Directional Sprites</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/directional-sprites/basic-movement">01 Basic Movement</a></li>
                <li><a href="/animancer/docs/examples/directional-sprites/character-controller">02 Character Controller</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/animation-events">05 Animation Events</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/animation-events/simple-and-end-events">01 Simple and End Events</a></li>
                <li><a href="/animancer/docs/examples/animation-events/other-events">02 Other Events</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/state-machines">06 State Machines</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/state-machines/creatures">01 Creatures</a></li>
                <li><a href="/animancer/docs/examples/state-machines/interrupt-management">02 Interrupt Management</a></li>
                <li><a href="/animancer/docs/examples/state-machines/brains">03 Brains</a></li>
                <li><a href="/animancer/docs/examples/state-machines/more-brains">04 More Brains</a></li>
                <li><a href="/animancer/docs/examples/state-machines/platformer">05 Platformer</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/docs/examples/layers">07 Layers</a></li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/inverse-kinematics">08 Inverse Kinematics</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/inverse-kinematics/puppet">01 Puppet</a></li>
                <li><a href="/animancer/docs/examples/inverse-kinematics/uneven-ground">02 Uneven Ground</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/animator-controllers">09 Animator Controllers</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/animator-controllers/hybrid">01 Hybrid</a></li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/animator-controllers/3d-game-kit">02 3D Game Kit</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/problems">Problems with the Original</a></li>
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/respawn">Respawn</a></li>
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/idle">Idle</a></li>
                <li class="treeview">
                    <a href="/animancer/docs/examples/animator-controllers/3d-game-kit/locomotion">Locomotion</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/locomotion/movement">Movement</a></li>
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/locomotion/turning">Turning</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/airborne">Airborne</a></li>
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/landing">Landing</a></li>
                <li><a href="/animancer/docs/examples/animator-controllers/3d-game-kit/attack">Attack</a></li>

                    </ul>
                </li>

                    </ul>
                </li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/manual">User Manual</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/manual/playing-animations">Playing Animations</a></li>
                <li><a href="/animancer/docs/manual/states">States</a></li>
                <li><a href="/animancer/docs/manual/inspector">Inspector</a></li>
                <li><a href="/animancer/docs/manual/component-types">Component Types</a></li>
                <li class="treeview">
                    <a href="/animancer/docs/manual/blending">Blending</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/manual/blending/fading">Fading</a></li>
                <li><a href="/animancer/docs/manual/blending/layers">Layers</a></li>
                <li><a href="/animancer/docs/manual/blending/mixers">Mixers</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/docs/manual/finite-state-machines">Finite State Machines</a></li>
                <li><a href="/animancer/docs/manual/transitions">Transitions</a></li>
                <li><a href="/animancer/docs/manual/animator-controllers">Animator Controllers</a></li>
                <li><a href="/animancer/docs/manual/animation-events">Animation Events</a></li>
                <li><a href="/animancer/docs/manual/inverse-kinematics">Inverse Kinematics</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/bugs">Unity Bugs</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/bugs/inconsistent-timing">Inconsistent Timing</a></li>
                <li><a href="/animancer/docs/bugs/paused-skinned-mesh-update">Paused Skinned Mesh Update</a></li>
                <li><a href="/animancer/docs/bugs/resetting-animated-values">Resetting Animated Values</a></li>
                <li><a href="/animancer/docs/bugs/root-motion-interpolation">Root Motion Interpolation</a></li>
                <li><a href="/animancer/docs/bugs/unused-graph-destroy-warning">Unused Graph Destroy Warning</a></li>
                <li><a href="/animancer/docs/bugs/update-modes">Update Modes</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/docs/source">Source Code</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/source/creating-custom-states">Creating Custom States</a></li>
                <li><a href="/animancer/docs/source/graph-structure">Graph Structure</a></li>
                <li><a href="/animancer/docs/source/asset-sources">Asset Sources</a></li>
                <li><a href="/animancer/docs/source/coding-standard">Coding Standard</a></li>
                <li><a href="/animancer/docs/source/default-script-template">Default Script Template</a></li>

                    </ul>
                </li>
                <li class="treeview active">
                    <a href="/animancer/docs/changes">Change Log</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/docs/changes/ideas">Ideas</a></li>
                <li><a href="/animancer/docs/changes/animancer-v4-0-beta">Beta Test v4.0</a></li>
                <li class="selected"><a href="/animancer/docs/changes/animancer-v4-0">Progress of v4.0</a></li>
                <li><a href="/animancer/docs/changes/animancer-v3-1">Animancer v3.1</a></li>
                <li><a href="/animancer/docs/changes/animancer-v3-0">Animancer v3.0</a></li>
                <li><a href="/animancer/docs/changes/animancer-v2-0">Animancer v2.0</a></li>
                <li><a href="/animancer/docs/changes/animancer-v1-3">Animancer v1.3</a></li>
                <li><a href="/animancer/docs/changes/animancer-v1-2">Animancer v1.2</a></li>
                <li><a href="/animancer/docs/changes/animancer-v1-1">Animancer v1.1</a></li>
                <li><a href="/animancer/docs/changes/animancer-v1-0">Animancer v1.0</a></li>

                    </ul>
                </li>

                    </ul>
                            
                </section>                
            </aside>
            
            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                



		<section class="content-header">
			<h1>Progress of v4.0</h1>
		</section>
	<section class="content">
		<blockquote class="blockquote">
<p>Planned Release 2020-01-??</p>
</blockquote>
<ul>
<li>Animancer v4.0 is currently in development and has reached the Beta phase (feature complete, but the examples and documentation are not ready yet).</li>
<li><strong>Upgrading from earlier versions will be free as always</strong>.</li>
<li>Check out the <a href="../animancer-v4-0-beta">Beta Test</a> page if you would like to help test it.</li>
<li>This page was last updated on 2019-12-09 (it will not be updated regularly).</li>
</ul>
<h1 id="highlights">Highlights</h1>
<ul>
<li>The main public API has been significantly restructured:
<ul>
<li>The <code>Play</code>, <code>CrossFade</code>, <code>CrossFadeFromStart</code>, and <code>Transition</code> methods have all been unified as <code>Play</code> with fewer overall parameter combinations.</li>
<li>Layers are now treated as a proper collection. So instead of <code>animancer.LayerCount</code>, <code>animancer.GetLayer(...)</code>, or <code>animancer.SetLayerAdditive(...)</code>, you now use <code>animancer.Layers.Count</code>, <code>animancer.Layers[...]</code>, or <code>animancer.Layers.SetAdditive(...)</code>.</li>
<li>Same for states. So instead of <code>animancer.GetState(...)</code> you now use <code>animancer.States[...]</code> and <code>animancer.CurrentState</code> is now <code>animancer.States.Current</code>.</li>
<li>Serializables are now called Transitions (i.e. you now use <code><a href="/animancer/api/Animancer/Transition">ClipState.Transition</a></code> instead of <code>ClipState.Serializable</code>).</li>
</ul>
</li>
<li>[Pro-Only] New <a href="#animancer-events">Animancer Event</a> system for general events without needing to use Unity's <a href="../../manual/animation-events#end-events">Animation Events</a>:
<ul>
<li>You can specify events per-state instead of per-clip.</li>
<li>You can add events and set callback delegates directly in code without needing to hook up magic strings to public methods.</li>
<li>The <code>AnimancerState.OnEnd</code> callback has moved to <code>AnimancerState.Events.OnEnd</code> and you can optionally specify a time for it instead of always being at the end of the clip.</li>
</ul>
</li>
<li>New <a href="#transition-previews">Transition Preview Window</a> allows you to preview your transitions on your character without entering Play Mode.</li>
<li>Implemented <a href="#mixer-time-synchronisation">Mixer Time Synchronisation</a>.</li>
<li>New <code><a href="/animancer/api/Animancer/PlayableAssetState">PlayableAssetState</a></code> allows you to play Timeline assets in Animancer.</li>
<li>Added support for Unity 2019.3.</li>
</ul>
<h1 id="upgrade-guide">Upgrade Guide</h1>
<p>The main public API has been significantly restructured in several ways which are likely to affect most users, so if you upgrade a project from an earlier version you will likely get some compiler errors which this section will help you fix.</p>
<blockquote class="blockquote">
<p>Remember to always <strong>delete any older version of Animancer</strong> before upgrading.</p>
</blockquote>
<h2 id="playing-and-fading">Playing and Fading</h2>
<p>In <a href="../animancer-v3-1">v3.1</a>, <code><a href="/animancer/api/Animancer/AnimancerComponent">AnimancerComponent</a></code> had several overloads each of <code>Play</code>/<code>CrossFade</code>/<code>Transition</code> which were made even more complicated by the presence of default parameters for <code>fadeDuration</code> and <code>layerIndex</code>:</p>
<pre><code class="language-cs">Play(AnimationClip clip, int layerIndex = 0)
Play(AnimancerState state)
Play(object key)

// Note: replaced DefaultFadeDuration with just DefaultDuration to fit everything on one line.
CrossFade(AnimationClip clip,            float fadeDuration = DefaultDuration, int layerIndex = 0)
CrossFade(AnimancerState state,          float fadeDuration = DefaultDuration)
CrossFade(object key,                    float fadeDuration = DefaultDuration)
CrossFadeFromStart(AnimationClip clip,   float fadeDuration = DefaultDuration, int layerIndex = 0)
CrossFadeFromStart(AnimancerState state, float fadeDuration = DefaultDuration, int layerIndex = 0)
CrossFadeFromStart(object key,           float fadeDuration = DefaultDuration, int layerIndex = 0)

Transition(IAnimancerTransition transition, int layerIndex = 0)
</code></pre>
<p>The various default parameters meant that those methods had a total of 22 parameter combinations, making them rather unwieldy and confusing for new users.</p>
<p>This has been improved in several ways by v4.0:</p>
<ul>
<li>All of those methods are now called <code>Play</code>.</li>
<li>The <a href="#collections">Collections</a> change allowed the <code>layerIndex</code> parameter to be removed (so <code>Play(clip, 1)</code> is now <code>Layers[1].Play(clip)</code>).</li>
<li>The new <code><a href="/animancer/api/Animancer/FadeMode">FadeMode</a></code> enum controls how a fade actually works, which includes the old <code>CrossFadeFromStart</code> functionality and the ability to use the specified <code>fadeDuration</code> as a portion of the clip length rather than raw seconds. See the <code><a href="/animancer/api/Animancer/FadeMode">FadeMode</a></code> API documentation for the details of each value.</li>
<li>This takes it down to only 12 parameter combinations:</li>
</ul>
<pre><code class="language-cs">// Play.
Play(AnimationClip clip)
Play(AnimancerState state)
Play(object key)

// CrossFade and CrossFadeFromStart.
Play(AnimationClip clip,              float fadeDuration, <a href="/animancer/api/Animancer/FadeMode">FadeMode</a> mode = FadeMode.FixedSpeed)
Play(AnimancerState state,            float fadeDuration, <a href="/animancer/api/Animancer/FadeMode">FadeMode</a> mode = FadeMode.FixedSpeed)
Play(object key,                      float fadeDuration, <a href="/animancer/api/Animancer/FadeMode">FadeMode</a> mode = FadeMode.FixedSpeed)

// Transition.
Play(IAnimancerTransition transition)
// New method allows you to override the fade details of the transition.
Play(IAnimancerTransition transition, float fadeDuration, <a href="/animancer/api/Animancer/FadeMode">FadeMode</a> mode = FadeMode.FixedSpeed)
</code></pre>
<p>Unfortunately this means it is no longer possible to have a default value for the <code>fadeDuration</code> parameter because skipping that parameter would just use the instant <code>Play(clip)</code> method instead of <code>Play(clip, defaultFadeDuration)</code>. The <code>AnimancerPlayable.DefaultFadeDuration</code> constant still exists though, since it is used in several places such as the default value to use for a <code><a href="/animancer/api/Animancer/Transition">ClipState.Transition</a></code>. Also note that the value is now <code>0.25</code> seconds to match the default Mecanim transition settings (it used to be <code>0.3</code> as the default used by the Legacy animation system).</p>
<h2 id="collections">Collections</h2>
<p>Layers are now treated as a proper collection via the new <code><a href="/animancer/api/Animancer/LayerList">AnimancerPlayable.LayerList</a></code> class which can be accessed via the <code><a href="/animancer/api/Animancer/AnimancerComponent/5A1697AB">AnimancerComponent.Layers</a></code> property. All layer related members have been moved into <code>LayerList</code>, for example:</p>
<table class="table">
<thead>
<tr>
<th>Old (v3.1)</th>
<th>New (v4.0)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>animancer.Play(clip, 1)</code></td>
<td><code>animancer.Layers[1].Play(clip)</code></td>
</tr>
<tr>
<td><code>animancer.LayerCount</code></td>
<td><code>animancer.Layers.Count</code></td>
</tr>
<tr>
<td><code>animancer.GetLayer(1)</code></td>
<td><code>animancer.Layers[1]</code></td>
</tr>
<tr>
<td><code>animancer.SetLayerAdditive(1, true)</code></td>
<td><code>animancer.Layers.SetAdditive(1, true)</code><br><code>animancer.Layers[1].IsAdditive = true</code></td>
</tr>
<tr>
<td><code>animancer.SetLayerMask(1, mask)</code></td>
<td><code>animancer.Layers.SetMask(mask)</code><br><code>animancer.Layers[1].SetMask(mask)</code></td>
</tr>
</tbody>
</table>
<p>In earlier versions the <code><a href="/animancer/api/Animancer/AnimancerComponent">AnimancerComponent</a></code> class was the only one with access to its <code>GetKey(AnimationClip)</code> method, meaning that it could have a <code>Play(AnimationClip)</code> method where other classes (<code><a href="/animancer/api/Animancer/AnimancerPlayable">AnimancerPlayable</a></code> and <code><a href="/animancer/api/Animancer/AnimancerLayer">AnimancerLayer</a></code>) could not because they would not be able to determine what key to look up the state with in the internal dictionary (usually the clip is its own key, but <code><a href="/animancer/api/Animancer/NamedAnimancerComponent">NamedAnimancerComponent</a></code> uses the clip's name so you can call <code>Play("Name")</code>). But Animancer v4.0 gives the <code><a href="/animancer/api/Animancer/AnimancerPlayable">AnimancerPlayable</a></code> a reference to its component, so now you can call <code>animancer.Layers[1].Play(clip)</code> as shown above. Also note that this changes the meaning of the default <code>animancer.Play(clip)</code> so that instead of playing the animation on layer 0 it will now leave it on whatever layer it is currently on.</p>
<p>The same has been done for states via the new <code><a href="/animancer/api/Animancer/StateDictionary">AnimancerPlayable.StateDictionary</a></code> class which can be accessed via the <code><a href="/animancer/api/Animancer/AnimancerComponent/478CDD7C">AnimancerComponent.States</a></code> property:</p>
<table class="table">
<thead>
<tr>
<th>Old (v3.1)</th>
<th>New (v4.0)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>animancer.StateCount</code></td>
<td><code>animancer.States.Count</code></td>
</tr>
<tr>
<td><code>animancer.CreateState(clip)</code></td>
<td><code>animancer.Layers[0].CreateState(clip)</code></td>
</tr>
<tr>
<td><code>animancer.GetState(clip)</code><br><code>animancer.GetState("Name")</code></td>
<td><code>animancer.States[clip]</code><br><code>animancer.States["Name"]</code></td>
</tr>
<tr>
<td><code>animancer.GetOrCreateState(clip)</code></td>
<td><code>animancer.States.GetOrCreate(clip)</code></td>
</tr>
<tr>
<td><code>animancer.Dispose(clip)</code></td>
<td><code>animancer.States.Destroy(clip)</code></td>
</tr>
<tr>
<td><code>AnimancerPlayable.maxLayerCount = 8</code></td>
<td><code>AnimancerPlayable.LayerList.defaultCapacity = 8</code></td>
</tr>
</tbody>
</table>
<h2 id="renaming">Renaming</h2>
<ul>
<li>Renamed <code>AnimancerState.Serializable</code> and all its derived classes to <code>Transition</code>.</li>
<li>Renamed <code>Vector2ControllerState</code> to <code><a href="/animancer/api/Animancer/Float2ControllerState">Float2ControllerState</a></code> since it wraps two separate <code>float</code> parameters, even if it allows them to be accessed as a single <code>Vector2</code>.
<ul>
<li>Renamed <code>Vector3ControllerState</code> to <code><a href="/animancer/api/Animancer/Float3ControllerState">Float3ControllerState</a></code> for the same reason.</li>
<li>Renamed <code>FloatControllerState</code> to <code><a href="/animancer/api/Animancer/Float1ControllerState">Float1ControllerState</a></code> for consistency (and so it sorts before the other two).</li>
</ul>
</li>
<li>Renamed <code>Dispose</code> to <code>Destroy</code> and removed <code>IDisposable</code> from everything since they didn't follow regular disposal patterns. It doesn't make sense to put an <code><a href="/animancer/api/Animancer/AnimancerState">AnimancerState</a></code> in a <code>using</code> statement and if you declare a <code>new <a href="/animancer/api/Animancer/ClipState">ClipState</a></code> locally, you don't need to dispose it because it will be cleaned up when the graph is destroyed.</li>
<li>Renamed <code>AnimancerNode.PortIndex</code> to <code>Index</code>.</li>
<li>Renamed <code>AnimancerLayer.CurrentStateID</code> to <code>CommandCount</code> (same in <code><a href="/animancer/api/Animancer/AnimancerPlayable">AnimancerPlayable</a></code>).</li>
<li>Renamed <code>IEarlyUpdate</code> to <code><a href="/animancer/api/Animancer/IAnimancerUpdatable">IAnimancerUpdatable</a></code>.</li>
</ul>
<h1 id="features">Features</h1>
<h2 id="improved-transition-inspector">Improved Transition Inspector</h2>
<p>As mentioned above, <code>AnimancerState.Serializable</code> and all its derived classes have been renamed to <code>Transition</code>. But that's not all, they have also received a major upgrade to their Inspector interface:</p>
<table class="table">
<thead>
<tr>
<th>Old (v3.1)</th>
<th>New (v4.0)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>[SerializeField]</code><br><code>private ClipState.Serializable _Walk;</code></td>
<td><code>[SerializeField]</code><br><code>private <a href="/animancer/api/Animancer/Transition">ClipState.Transition</a> _Walk;</code></td>
</tr>
<tr>
<td><img src="old-serializable-inspector.png" class="img-responsive"></td>
<td><img src="new-transition-inspector.gif" class="img-responsive"></td>
</tr>
</tbody>
</table>
<p>There are quite a few improvements here:</p>
<ul>
<li>The "eye" button in the top right opens a new window for <a href="#transition-previews">previewing the transition</a>.</li>
<li>Rather than giving the <code>Start Time</code> a <code>Normalized</code> toggle to swap between normalized time and raw seconds, it now simply shows both values side by side so you can edit whichever one you want. This has been applied to the other fields as well.</li>
<li>All relevant fields now display an appropriate suffix to indicate the units ("x" indicates normalized time while "s" indicates raw seconds).</li>
<li><code>Speed</code> now has a toggle to determine if it is actually applied (otherwise the state simply retains whatever speed it had previously).</li>
<li>The new <a href="#animancer-events">Animancer Event</a> system allows the <code>OnEnd</code> callback to have a custom time instead of always being at the exact end of the animation, so that value is made available in the Inspector with a toggle to show a <code>UnityEvent</code> that lets you configure the callback as well (see <a href="#animancer-events">Animancer Events</a> for more details).
<ul>
<li>Note that when the <code>End Time</code> toggle is disabled, the value will actually be calculated based on the <code>Speed</code>. When playing forwards the animation will end at <code>NormalizedTime == 1</code>, but when playing backwards it will end at <code>NormalizedTime == 0</code>.</li>
</ul>
</li>
<li>Down the bottom is a visual timeline display of the main parameters:
<ul>
<li>The blue highlighted area represents the fading in and out.</li>
<li>The grey bar down the bottom represents the actual length of the animation.</li>
<li>The lines labels are the start, end, and fade times.</li>
<li>The button on the right adds an <a href="#animancer-events">Animancer Event</a> which will also be shown in this area.</li>
</ul>
</li>
</ul>
<p>There are also a few changes on the code side:</p>
<ul>
<li>Removed <code>StartTimeIsNormalized</code> and renamed <code>StartTime</code> to <code>NormalizedStartTime</code>. It always saves the normalized time value regardless of which one you set.</li>
<li><code>Speed</code> can now be set to <code>NaN</code> to prevent it from changing the existing value (this is what disabling the Inspector toggle does to any of the fields).</li>
</ul>
<h2 id="transition-previews">Transition Previews</h2>
<p>The Transition Preview Window is still a work in progress. It will allow you to fine tune your transition details and see what your model looks like without needing to enter Play Mode.</p>
<p><img src="transition-preview.gif" class="img-responsive"></p>
<p>Note that this feature requires Unity 2018.3+ since earlier versions couldn't properly play animations in Edit Mode.</p>
<h2 id="animancer-events">Animancer Events</h2>
<p>Unity has an inbuilt <a href="https://docs.unity3d.com/Manual/script-AnimationWindowEvent.html">Animation Event</a> system which allows you to trigger script functions when an animation passes a specific time. Animancer supports this system and it is very useful, but it has several notable drawbacks:</p>
<ul>
<li>It can only call public methods with certain parameter types and they must be on a component attached to the same <code>GameObject</code> as the <code>Animator</code> playing the animation.</li>
<li>It is not very efficient because it uses a mechanism similar to <code>GameObject.SendMessage</code> and some parameter types create garbage each time an event is triggered (<code>string</code> and <code>Object</code>).</li>
<li>It relies on <a href="../../introduction/mecanim-vs-animancer/why-replace-mecanim#magic-strings">Magic Strings</a>, so if you pick a function then rename it or don't have the right component attached, you will only find out that it has stopped working when you next test the event.</li>
<li>The events are associated with the <code>AnimationClip</code>, meaning that every character using that animation will have the same events. Most of the time this is a perfectly reasonable limitation since each animation generally only has one purpose, but it is worth noting because Animancer Events work differently.</li>
</ul>
<p>Animancer v4.0 adds its own event system which greatly expands upon the old <code>OnEnd</code> callback:</p>
<ul>
<li>This is a <strong>Pro-Only</strong> feature. Animancer Lite allows you to try it out in the Unity Editor, but you will need to purchase Animancer Pro to use it in runtime builds.
<ul>
<li>End events are an exception to this. The newly added ability to specify a custom time is Pro-Only, but the callback itself is still fully available in the Lite version.</li>
</ul>
</li>
<li>An <code><a href="/animancer/api/Animancer/AnimancerEvent">AnimancerEvent</a></code> is a simple struct containing a <code>float normalizedTime</code> to determine when the event will occur and a <code>System.Action callback</code> to determine what it does.</li>
<li>An <code><a href="/animancer/api/Animancer/Sequence">AnimancerEvent.Sequence</a></code> is a list of <code><a href="/animancer/api/Animancer/AnimancerEvent">AnimancerEvent</a></code>s which is always automatically sorted by <code>normalizedTime</code> as well as an additional <code>endEvent</code>.</li>
<li>The <code><a href="/animancer/api/Animancer/AnimancerState/11AD60E8">AnimancerState.Events</a></code> property is an <code><a href="/animancer/api/Animancer/Sequence">AnimancerEvent.Sequence</a></code> which it clears whenever a new animation is played. These sequences are created on demand and kept in an <code><a href="/animancer/api/Animancer/ObjectPool">ObjectPool</a></code> so they can be efficiently reused.</li>
<li>As with End Events prior to v4.0, all events are cleared (and returned to the pool) whenever a new animation is played. This ensures that the code playing an animation does not have to worry about whether or not that same animation has been used for something else with a different set of events.
<ul>
<li>You can always construct your own <code><a href="/animancer/api/Animancer/Sequence">AnimancerEvent.Sequence</a></code> and assign it directly to the <code><a href="/animancer/api/Animancer/AnimancerState/11AD60E8">AnimancerState.Events</a></code>, in which case it will be removed from the state when a new animation is played but it will not be cleared or added to the <code><a href="/animancer/api/Animancer/ObjectPool">ObjectPool</a></code>.</li>
<li>You can also use Transitions to define events in the Inspector (see below).</li>
<li>This means that Animancer Events are defined per-state rather than per-clip. You can have any number of Transitions using the same <code>AnimationClip</code> and they can each have different events. If you want to share a Transition in multiple places, you can Right Click in the Project window and use the <em>Create -&gt; Animancer -&gt; Transition</em> function to create an <code><a href="/animancer/api/Animancer/AnimancerTransition">AnimancerTransition</a></code> (which is a type of <code>ScriptableObject</code> asset).</li>
</ul>
</li>
</ul>
<h3 id="event-types">Event Types</h3>
<p><code><a href="/animancer/api/Animancer/AnimancerEvent">AnimancerEvent</a></code>s behave differently depending on where they are used:</p>
<ul>
<li><strong>End Events</strong>: an event assigned to the <code>AnimancerEvent.Sequence.endEvent</code> will be triggered once per frame while the animation is past the specified time.
<ul>
<li>For example, if an animation is already playing and has passed its end then you tell it to play again without resetting it to the start and register an End Event, this ensures that your event will definitely be called in the next frame rather than not getting called at all and likely leaving the character stuck in a state it will never exit.</li>
<li><code><a href="/animancer/api/Animancer/Sequence/9FF5A569">AnimancerEvent.Sequence.OnEnd</a></code> and <code><a href="/animancer/api/Animancer/Sequence/467FFF3E">AnimancerEvent.Sequence.NormalizedEndTime</a></code> wrap the individual fields of that event in case you only want to set one of them. So any old code that set <code>state.OnEnd = callback</code> can now just use <code>state.Events.OnEnd = callback</code> instead of needing to write the full <code>state.Events.endEvent = new AnimancerEvent(normalizedTime, callback)</code>.</li>
<li>Despite the name, End Events do not inherently do anything to end the animation. You can do anything you want using the callback.</li>
<li>The default End Event time is <code>NaN</code>, which means that it determines which time to actually use based on the play direction (forwards ends at 1 while backwards ends at 0).</li>
<li><code>AnimancerState.IsPlayingAndNotEnding</code> now properly respects the end event time (for when you use an <code><a href="/animancer/api/Animancer/AnimancerState">AnimancerState</a></code> as a <code>yield</code> instruction).</li>
</ul>
</li>
<li>The other two types are for general events added to the main list of the sequence (for example, <code>state.Events.Add(0.5f, callback)</code>).</li>
<li><strong>Non-Looping Events</strong>: a general event on a non-looping animation will be triggered once on the frame when it passes the specified time.</li>
<li><strong>Looping Events</strong>: a general event on a looping animation will be triggered every loop on the frame when it passes the specified time.
<ul>
<li>If the animation is playing fast enough that multiple loops pass in a single frame, the event will be triggered the appropriate number of times. If you want to ensure that your callback only gets triggered once per frame, you can store the <code><a href="/animancer/api/Animancer/AnimancerPlayable/EA98B55C">AnimancerPlayable.FrameID</a></code> and check if it has changed each time your method is called.</li>
<li>Unlike the other event types, Looping Events must be within the range of <code>0 &lt;= normalizedTime &lt; 1</code> in order to function correctly (supporting times outside that range would waste performance). Events outside that range will cause an <code>ArgumentOutOfRangeException</code> during the next update.</li>
<li><code>AnimationEvent.AlmostOne</code> is a constant containing the largest possible float value less than 1.</li>
</ul>
</li>
</ul>
<h3 id="events-in-transitions">Events in Transitions</h3>
<p>Instead of setting up events using code, you can also use Transitions and do it in the Inspector:</p>
<p><img src="animancer-event-inspector.gif" class="img-responsive"></p>
<ul>
<li>You can select and edit events one at a time, or you can click the foldout arrow next to the timeline to instead show all of the events at once.</li>
<li>Note that each transition defines how it fades in but not how it fades out (because that gets determined by the next transition), so the timeline simply uses a default value. If the end time is less than the animation length, it shows the fade out ending at the end of the animation. Or if the end time is greater than the length, it shows the default 0.25 second fade.</li>
<li><code>ClipState.SerializableWithEndEvent</code> no longer exists since all transitions now have events.</li>
</ul>
<h3 id="ultevents">UltEvents</h3>
<p>By default, this system uses <code>UnityEvent</code>s to define the event callbacks. However, it can be modified to use any other similar type of events. In particular, if you want to use <a href="https://kybernetikgames.github.io/ultevents">UltEvents</a> you can do the following (this requires Animancer Pro):</p>
<ol>
<li>Select the <em>Assets/Plugins/Animancer/Animancer.asmdef</em> and add a Reference to the <code>UltEvents</code> Assembly Definition.</li>
</ol>
<p><img src="reference-ultevents.gif" class="img-responsive"></p>
<ol start="2">
<li>Go into the Player Settings of your project and add <code>ANIMANCER_ULT_EVENTS</code> as a Scripting Define Symbol. Or you can simply edit the <code>AnimancerEvent.Sequence.Serializable.cs</code> script to change the event type.</li>
</ol>
<p><img src="animancer-ultevents.gif" class="img-responsive"></p>
<p>Note that since the serialized data structure of <code>UnityEvent</code>s and <code>UltEvent</code>s is entirely different, swapping between them will cause all existing events to lose their data. If you can think of a better way to implement it so that both systems can be used separately, please <a href="/animancer/forum">post in the Unity forums</a> or email <a href="mailto:AnimancerUnityPlugin@gmail.com?subject=Animancer">AnimancerUnityPlugin@gmail.com</a>.</p>
<h3 id="other-details">Other Details</h3>
<p>This system has several other details worth mentioning:</p>
<ul>
<li>Events are triggered using the <code>AnimancerEvent.Invoke</code> method which sets the static <code>CurrentEvent</code> and <code>CurrentState</code>, allowing anything to access the details of the event and the state that triggered it before being cleared immediately afterwards.</li>
<li>Changing the <code><a href="/animancer/api/Animancer/AnimancerState/840B3EB1">AnimancerState.Time</a></code> prevents that state from triggering any more events during that frame.</li>
<li>Animancer Events work with <a href="../../manual/fading/mixers">Mixers</a>. Blend Trees will trigger Animation Events on all of the <code>AnimationClip</code>s they contain, but this allows events to be placed on the <code><a href="/animancer/api/Animancer/MixerState">MixerState</a></code> itself so they get triggered according to the weighted average normalized time of the mixed states.
<ul>
<li>They also technically work with <a href="../../manual/animator-controllers">Controller States</a>, though this is not necessarily very useful because they do not check what the Animator Controller is doing internally.</li>
</ul>
</li>
<li>The old <code>IEarlyUpdate</code> interface is now <code><a href="/animancer/api/Animancer/IAnimancerUpdatable">IAnimancerUpdatable</a></code> which contains <code>EarlyUpdate</code> and <code>LateUpdate</code> methods (and <code>OnDestroy</code>).
<ul>
<li><code>EarlyUpdate</code> is called before the other playables update so it can store the target state's previous time then <code>LateUpdate</code> is called afterwards to use the target state's previous and current time to determine which events need to be triggered.</li>
<li>If you want to run your own code as part of the animation update, you can implement <code><a href="/animancer/api/Animancer/IAnimancerUpdatable">IAnimancerUpdatable</a></code> yourself and use it with <code>AnimancerPlayable.RequireUpdate(updatable)</code> and <code>AnimancerPlayable.CancelUpdate(updatable)</code>.</li>
<li>Any exceptions thrown by the <code><a href="/animancer/api/Animancer/IAnimancerUpdatable">IAnimancerUpdatable</a></code> update loops are automatically caught and logged so that the rest of the updatables can still be updated properly.</li>
</ul>
</li>
<li>The system for receiving Animation Events called "End" and other standard event names has been cleaned up.
<ul>
<li>"CrossFade" events can now use their Float Parameter to specify the fade duration.</li>
</ul>
</li>
<li>Added <code><a href="/animancer/api/Animancer/AnimancerState/58114E95">AnimancerState.HasEvents</a></code> to check if there are any events without accessing the <code>Events</code> property (because that would retrieve a new sequence from the <code><a href="/animancer/api/Animancer/ObjectPool">ObjectPool</a></code>).</li>
</ul>
<h1 id="changes">Changes</h1>
<ul>
<li>Replaced <code>AnimancerComponent.StopOnDisable</code> with <code>ActionOnDisable</code> which is an enum with several new values:
<ul>
<li><code>Stop</code> - The default value still stops all animations (same as <code>StopOnDisable = true</code> did).</li>
<li><code>Pause</code> - Pauses the graph so animations can resume from their current state afterwards (same as <code>StopOnDisable = false</code> did).</li>
<li><code>Continue</code> - Keeps playing while inactive.</li>
<li><code>Reset</code> - Resets the object to its bind pose. An Inspector message explains that <code>Reset</code> will only work if the <code><a href="/animancer/api/Animancer/AnimancerComponent">AnimancerComponent</a></code> is above the <code>Animator</code> and it shows a button to fix it.</li>
<li><code>Destroy</code> - Destroys the graph.</li>
</ul>
</li>
<li><code>AnimancerState.Transition.State</code> is now the state most recently passed into <code>Apply</code> (backed by the un-cast <code>BaseState</code>) so they can be more easily used on multiple objects.
<ul>
<li>Overrides of <code>CreateState</code> no longer need to manually set the <code>State</code>.</li>
</ul>
</li>
<li>Changed <code>HybridAnimancerController.PlayController</code> to return its <code><a href="/animancer/api/Animancer/ControllerState">ControllerState</a></code>.</li>
<li><code><a href="/animancer/api/Animancer/Transition">ControllerState.Transition</a></code> now uses itself as the key instead of the controller in case something else happens to use the same controller with a different set of parameters.</li>
<li>Added a <code><a href="/animancer/api/Animancer/Validate">Validate</a></code> class for all the validation methods and Lite restrictions.
<ul>
<li><code>Validate.FadeDuration</code> now allows 0 in Animancer Lite.</li>
<li>All general validation is now conditional based on the <code>UNITY_ASSERTIONS</code> symbol (in the Unity Editor, Development Builds, and Animancer Lite).</li>
</ul>
</li>
<li>Changed <code>AnimancerState.IsPlayingAndNotEnding</code> to not try to look ahead one frame because it was only using the delta time from the previous frame so it was unreliable at best and wouldn't even be using the right type of delta time for <code>AnimatePhysics</code> or <code>UnscaledTime</code>. But it does now account for the new End Event time.</li>
<li>Changed the Inspector display of <code>"Dirty Early Nodes"</code> to <code>"Updatables"</code>.</li>
<li>Moved <code>AnimancerNode.IsPlaying</code> to <code><a href="/animancer/api/Animancer/AnimancerState">AnimancerState</a></code> since layers don't need it.</li>
<li>Added <code><a href="/animancer/api/Animancer/AnimancerState/11CDCE47">AnimancerState.NewTime</a></code> which only gets called when the <code>Time</code> is actually changed and is virtual.
<ul>
<li>Added a minor optimisation in the setter to only cast the value to <code>double</code> once.</li>
<li>Moved time caching from <code><a href="/animancer/api/Animancer/ClipState">ClipState</a></code> to the base <code><a href="/animancer/api/Animancer/AnimancerState">AnimancerState</a></code> so it can be used by all states.</li>
<li>Added a non-NaN assertion to the <code><a href="/animancer/api/Animancer/AnimancerState/840B3EB1">AnimancerState.Time</a></code> setter.</li>
<li><code><a href="/animancer/api/Animancer/ManualMixerState">ManualMixerState</a></code> now overrides <code>NewTime</code> to access the weighted average <code>Time</code> of all child states.</li>
<li><code><a href="/animancer/api/Animancer/ControllerState">ControllerState</a></code> now overrides <code>NewTime</code> to access the <code>StateInfo.normalizedTime</code>.</li>
</ul>
</li>
<li>Removed <code>AnimancerState.NormalizedSpeed</code> because it was not really that useful and got in the way of auto-correct suggesting <code>NormalizedTime</code>. The getter was simply <code>Speed / Length</code> and the setter <code>Speed = value * Length</code>.</li>
<li>Refactored the system for checking if an <code>AnimationClip</code> has an Animation Event with a particular name:
<ul>
<li>Moved the static <code>ClipState.HasEvent</code> to <code><a href="/animancer/api/Animancer/AnimancerUtilities">AnimancerUtilities</a></code>.</li>
<li>Added an overload that takes an <code><a href="/animancer/api/Animancer/IAnimationClipCollection">IAnimationClipCollection</a></code>.</li>
<li>Removed the abstract <code>AnimancerState.HasEvent</code>.</li>
<li><code><a href="/animancer/api/Animancer/AnimationEventReceiver">AnimationEventReceiver</a></code> now uses <code><a href="/animancer/api/Animancer/AnimancerUtilities/9FBCB86A">AnimancerUtilities.HasEvent(IAnimationClipCollection, string)</a></code> so that each state doesn't need to manually iterate through all its clips.</li>
</ul>
</li>
</ul>
<h1 id="improvements">Improvements</h1>
<ul>
<li>Added <code>Restore Bind Pose</code> context menu function to <code>Animator</code> components.</li>
<li>Adding a <code><a href="/animancer/api/Animancer/HybridAnimancerComponent">HybridAnimancerComponent</a></code> to an object with an <code>AnimatorController</code> assigned to its <code>Animator</code> will now assign that controller to the animancer instead of only clearing it.</li>
<li>Removed unnecessary calls to <code>SetInputCount</code> and <code>SetInputWeight</code> during <code>AnimancerPlayable.OnPlayableCreate</code>.</li>
<li>Minor optimisation in <code>AnimancerNode.ApplyWeight</code>.</li>
<li>Added Asset Labels to most assets.</li>
<li>Added <code><a href="/animancer/api/Animancer/IAnimationClipCollection">IAnimationClipCollection</a></code> which takes an <code>ICollection</code> instead of a <code>List</code> so it can use <code>HashSet</code>s to efficiently avoid duplicates.
<ul>
<li>All <code>Transition</code>s now implement <code><a href="/animancer/api/Animancer/IAnimationClipCollection">IAnimationClipCollection</a></code>.</li>
<li>Added various <code>Gather</code> methods to <code><a href="/animancer/api/Animancer/AnimancerUtilities">AnimancerUtilities</a></code>.</li>
<li>Moved the reflection based clip gathering system from <code><a href="/animancer/api/Animancer.Editor/AnimancerEditorUtilities">AnimancerEditorUtilities</a></code> into a dedicated <code><a href="/animancer/api/Animancer.Editor/AnimationGatherer">AnimationGatherer</a></code> class and improved its reliability.</li>
</ul>
</li>
<li>Added <code>AnimancerStateDictionary.Destroy</code> methods for collections and <code><a href="/animancer/api/Animancer/IAnimationClipSource">IAnimationClipSource</a></code>.</li>
<li>Added <code>AnimancerUtilities.Wrap01</code> extension method as a more efficient implementation of <code>Mathf.Repeat(value, 1)</code>.</li>
<li>Reorganised the Inspector context menus.</li>
<li>Removed <code>AnimancerState.HasLength</code>. All states must now return a valid <code>Length</code> (even if it is 0).
<ul>
<li>Added <code><a href="/animancer/api/Animancer/ManualMixerState/A15266AF">ManualMixerState.Length</a></code> which is calculated as the weighted average of the lengths of each of its children.</li>
</ul>
</li>
<li>Added <code><a href="/animancer/api/Animancer/ControllerState/C9CAD0EB">ControllerState.StateInfo</a></code> to return either the current or next state depending on whether a transition is active.
<ul>
<li><code>Length</code> and <code>IsLooping</code> now use the <code>StateInfo</code>.</li>
<li>Removed <code>ControllerState.Drawer.DisplayStateInfo</code>, <code>DisplayTime</code>, <code>DisplayLength</code>, and <code>SetTime</code> since they are now unnecessary.</li>
</ul>
</li>
<li>Added <code>[&lt;see cref="SerializeField"/&gt;]</code> tags to the start of comments for all properties that directly wrap serialized fields.</li>
</ul>
<h1 id="fixes">Fixes</h1>
<ul>
<li>Fixed <code>FadeMode.FromStart</code> to work properly with the <code>fadeDuration</code> set to 0.</li>
<li>Fading now accounts for the speed of the parent nodes.</li>
<li>Fixed <code>ControllerState.GatherDefaultStates</code> to properly gather the state for layer 0.</li>
<li>Fixed transitions to use the correct label for the main property in Unity 2018.3+.</li>
<li>Fixed <code>ManualMixerState.Transition.CreateState</code> to properly call <code>Initialise</code> to create its states.</li>
<li>Removed the functionality to update animations in Edit Mode from Unity 2018.3+ because Unity now does it automatically.</li>
<li>Fixed the Edit Mode update loop to not throw exceptions when an object is destroyed.</li>
<li>Calling <code>AnimancerState.SetParent</code> with an already occupied port will now leave the state properly disconnected as it fails.</li>
<li>Fixed <code><a href="/animancer/api/Animancer/AnimancerPlayable/FEFD6C35">AnimancerPlayable.KeepChildrenConnected</a> = true</code> to work properly.</li>
<li>Fixed the <code>AnimancerStateDrawer</code> progress bars to be properly visible in the Dark Theme and changed the colors to be a bit stronger overall.</li>
<li>The <code><a href="/animancer/api/Animancer/AnimancerPlayable">AnimancerPlayable</a></code> finalizer will no longer destroy the graph automatically while in Play Mode since that would mean a runtime warning anyway.</li>
<li><code><a href="/animancer/api/Animancer/AnimancerState/BAA47882">AnimancerState.Duration</a></code> now returns <code>PositiveInfinity</code> from the getter if <code>Speed</code> is 0 and throws an <code>ArgumentException</code> is setting the value to 0.</li>
<li><code><a href="/animancer/api/Animancer/AnimancerState/87E41C92">AnimancerState.RemainingDuration</a></code> now respects looping/not and custom end times.</li>
<li>Fixed the 2D mixer states to round children with <code>weight &lt; 0.01f</code> to 0. Otherwise they often get very small weights and still trigger Animation Events.</li>
<li>Added comments explaining that when <code>OnAnimatorIK</code> is called the layer index parameter will always be zero (a limitation of the Playables API).</li>
<li>Replaced all usage of <code>EditorStyles.label</code> with <code>GUI.skin.label</code> since they are slightly different in some Unity versions and the latter is the default used by <code>GUI.Label</code>.</li>
</ul>
<h1 id="examples">Examples</h1>
<ul>
<li>Added <a href="../../examples/basics/hybrid-system">Basics/Hybrid System</a> example to demonstrate the <code><a href="/animancer/api/Animancer/HybridAnimancerComponent">HybridAnimancerComponent</a></code> in a simple situation without the complexity of a full state machine in <a href="../../examples/animator-controllers/hybrid">Animator Controllers/Hybrid</a>.</li>
<li>Cleaned up the <code>Spider Bot</code> example animation names to match the same convention as others.</li>
<li>Improved the <code><a href="/animancer/api/Animancer.Examples.InverseKinematics/RaycastFootIK">RaycastFootIK</a></code> example script to account for the foot rotation when calculating the raycast diration.</li>
<li>The <code>ReadMe</code> now lists all example scenes for easy navigation.</li>
</ul>
<h1 id="internal">Internal</h1>
<ul>
<li>Added 150+ unit tests using the <a href="https://docs.unity3d.com/Packages/com.unity.test-framework@1.1/manual/index.html">Unity Test Framework</a>. The tests are not planned for release so they will not directly matter to users, but they will help reduce the possibility of bugs making it to release.</li>
<li>Changed <code>AnimancerNode.Stop</code> from <code>abstract</code> to <code>virtual</code> so it can set <code>Weight = 0</code> by default since both <code><a href="/animancer/api/Animancer/AnimancerLayer">AnimancerLayer</a></code> and <code><a href="/animancer/api/Animancer/AnimancerState">AnimancerState</a></code> did so.</li>
<li>Moved the functionality to constantly repaint in Edit Mode from the manual update loop to <code>AnimancerPlayableEditor.RequiresConstantRepaint</code>.</li>
<li>Split <code>AnimancerPlayableEditor</code> into <code><a href="/animancer/api/Animancer.Editor/BaseAnimancerComponentEditor">BaseAnimancerComponentEditor</a></code> and <code><a href="/animancer/api/Animancer.Editor/AnimancerPlayableDrawer">AnimancerPlayableDrawer</a></code> to the preview window can draw its <code><a href="/animancer/api/Animancer/AnimancerPlayable">AnimancerPlayable</a></code> without actually having an <code><a href="/animancer/api/Animancer/AnimancerComponent">AnimancerComponent</a></code>.</li>
<li>Moved <code><a href="/animancer/api/Animancer/FastComparer">FastComparer</a></code> out of <code><a href="/animancer/api/Animancer/AnimancerPlayable">AnimancerPlayable</a></code>.</li>
<li>Changed <code>AnimancerLayer.DestroyStates</code> and <code>ManualMixerState.DestroyChildren</code> to iterate in reverse order.</li>
<li>Moved <code>AnimancerEditorUtilities.GUIStyles</code> out to <code><a href="/animancer/api/Animancer.Editor/AnimancerGUI">AnimancerGUI</a></code> and moved the GUI utilities there.
<ul>
<li>Renamed <code>GetLayoutRect</code> to <code>LayoutSingleLineRect</code>.</li>
<li>Added <code>padding</code> parameter to <code>StealFromLeft</code> and <code>StealFromRight</code>.</li>
</ul>
</li>
<li>Changed parameter references in comments to use the `grave accent` instead of 'single quotes'.</li>
<li>Added <code>ConversionCache</code> to replace various other caching systems throughout Animancer.</li>
<li>Added <code>TemporarySettings</code> for storing information between assembly reloads without needing to save it when Unity closes.
<ul>
<li>Currently it is used to store details about which Animancer Events are selected in the Inspector.</li>
<li>Added <code><a href="/animancer/api/Animancer/IAnimancerTransitionDetailed">IAnimancerTransitionDetailed</a> : <a href="/animancer/api/Animancer/IAnimancerTransition">IAnimancerTransition</a></code> to expose additional details for previewing.</li>
</ul>
</li>
<li>Added <code><a href="/animancer/api/Animancer/Key">Key</a></code> and <code>Key.KeyedList</code>:
<ul>
<li>Changed <code><a href="/animancer/api/Animancer/AnimancerNode">AnimancerNode</a></code> to inherit from <code><a href="/animancer/api/Animancer/Key">Key</a></code> and replaced the dirty node update list with a keyed list which greatly cleans up that part of the system.</li>
<li>Changed <code>IEarlyUpdate</code> into <code><a href="/animancer/api/Animancer/IAnimancerUpdatable">IAnimancerUpdatable</a></code> which implements <code><a href="/animancer/api/Animancer/IKeyHolder">IKeyHolder</a></code> and replaced its list with a keyed list as well.</li>
<li>Removed the <code>needsMoreUpdates</code> parameter from <code>IAnimancerUpdatable.Update</code> since they can be immediately removed at any time by <code>AnimancerPlayable.CancelUpdate</code>.</li>
</ul>
</li>
<li>Added a simple <code><a href="/animancer/api/Animancer/ObjectPool">ObjectPool</a></code> system to allow easy reuse of objects. If you want a more powerful general purpose system, check out <a href="https://kybernetikgames.github.io/weaver">Weaver</a>.</li>
<li>Refactored the <code>AppendDescription</code> system in the core classes to be cleaner and produce better descriptions.</li>
<li>Added <code><a href="/animancer/api/Animancer.Editor/Serialization">Serialization</a></code> class which contains various utilities relating to serialization:
<ul>
<li><code><a href="/animancer/api/Animancer.Editor/PropertyAccessor">Serialization.PropertyAccessor</a></code> allows access to the underlying object of a <code>SerializedProperty</code>.</li>
<li><code><a href="/animancer/api/Animancer.Editor/ObjectReference">Serialization.ObjectReference</a></code> acts as a stronger serializable reference to a <code>UnityEngine.Object</code>. A simple <code>Object</code> field can lose its value under certain circumstances even if the referenced object still exists, for example when entering Play Mode.</li>
<li><code><a href="/animancer/api/Animancer.Editor/PropertyReference">Serialization.PropertyReference</a></code> is a serializable reference to a <code>SerializedProperty</code>.</li>
</ul>
</li>
</ul>

	</section>
                
            </div>           
            
            <!-- Footer -->
            <footer class="main-footer">
            </footer>
            
        </div>
        <div class="wrapper bottom-wrapper">
            <footer class="bottom-footer">
                Generated by <a href="https://wyam.io">Wyam</a>
            </footer>
        </div>
        <a href="javascript:" id="return-to-top"><i class="fa fa-chevron-up"></i></a>
        
        <script>           
            // Close the sidebar if we select an anchor link
            $(".main-sidebar a[href^='#']:not('.expand')").click(function(){
                $(document.body).removeClass('sidebar-open');
            });
            
            $(document).ready(function() {
                mermaid.initialize(
                {
                    flowchart:
                    {
                        useMaxWidth: false
                    },
					startOnLoad: false,
					cloneCssStyles: false
                });     
                mermaid.init(undefined, ".mermaid");

                // Remove the max-width setting that Mermaid sets
                var mermaidSvg = $('.mermaid svg');
                mermaidSvg.addClass('img-responsive');
                mermaidSvg.css('max-width', '');

                // Make it scrollable
				var target = document.querySelector(".mermaid svg");
				if(target !== null)
				{
					var panZoom = window.panZoom = svgPanZoom(target, {
						zoomEnabled: true,
						controlIconsEnabled: true,
						fit: true,
						center: true,
                        maxZoom: 20,
                        zoomScaleSensitivity: 0.6
					});			                          

                    // Do the reset once right away to fit the diagram
                    panZoom.resize();
                    panZoom.fit();
                    panZoom.center();
                    
                    $(window).resize(function(){
                        panZoom.resize();
                        panZoom.fit();
                        panZoom.center();
                    });
				}
                
                $('pre code').each(function(i, block) {
                    hljs.highlightBlock(block);
                });  
            });

            hljs.initHighlightingOnLoad();

            // Back to top
            $(window).scroll(function() {
                if ($(this).scrollTop() >= 200) {        // If page is scrolled more than 50px
                    $('#return-to-top').fadeIn(1000);    // Fade in the arrow
                } else {
                    $('#return-to-top').fadeOut(1000);   // Else fade out the arrow
                }
            });
            $('#return-to-top').click(function() {      // When arrow is clicked
                $('body,html').animate({
                    scrollTop : 0                       // Scroll to top of body
                }, 500);
            });
        </script>
    
</body></html>